<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROJECT: MONK MODE | v5.7.0 (Premium)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700;800&family=Orbitron:wght@500;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gunmetal': '#0a0a0f',
                        'surface-card': '#111116',
                        'surface-raised': '#1a1a22',
                        'surface-hover': '#222230',
                        'neon-green': '#00ff41',
                        'neon-red': '#ff003c',
                        'accent-orange': '#ff6b35',
                        'text-muted': '#6b7280',
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        header: ['"Orbitron"', 'sans-serif'],
                    },
                    animation: {
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'scan': 'scan 2s linear infinite',
                        'pulse-urgent': 'pulseUrgent 1.5s infinite',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scan: {
                            '0%': { backgroundPosition: '0% 0%' },
                            '100%': { backgroundPosition: '0% 100%' }
                        },
                        pulseUrgent: {
                            '0%, 100%': { borderColor: '#ff003c', boxShadow: '0 0 5px #ff003c' },
                            '50%': { borderColor: 'transparent', boxShadow: 'none' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0a0a0f;
            color: #e5e7eb;
            overflow-x: hidden;
            font-size: 15px;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00ff41;
        }

        .cyber-border:hover {
            border-color: #00ff41;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
        }

        .custom-checkbox {
            appearance: none;
            width: 1.2em;
            height: 1.2em;
            border: 2px solid #444;
            background: #111;
            cursor: pointer;
            display: grid;
            place-content: center;
            transition: 0.2s;
        }

        .custom-checkbox::before {
            content: "";
            width: 0.6em;
            height: 0.6em;
            transform: scale(0);
            background: #00ff41;
            transition: 0.2s transform ease-in-out;
        }

        .custom-checkbox:checked {
            border-color: #00ff41;
        }

        .custom-checkbox:checked::before {
            transform: scale(1);
        }

        body.override-mode {
            filter: grayscale(80%) contrast(1.1);
        }

        body.override-mode * {
            animation-play-state: paused !important;
            transition: none !important;
        }

        body.override-mode .tab-btn:not(.active-override-tab) {
            opacity: 0.3;
            pointer-events: none;
        }

        body.override-mode .override-hide {
            display: none !important;
        }

        body.override-mode .override-highlight {
            border-color: #ff003c !important;
            box-shadow: 0 0 10px rgba(255, 0, 60, 0.5) !important;
        }

        #override-panel {
            display: none;
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 0, 0, 0.95);
            border: 2px solid #ff003c;
            padding: 1rem 2rem;
            z-index: 100;
            text-align: center;
            border-radius: 8px;
        }

        body.override-mode #override-panel {
            display: block;
        }

        #override-timer {
            font-size: 2rem;
            font-weight: bold;
            color: #ff003c;
            font-family: 'JetBrains Mono', monospace;
        }

        #override-mission {
            color: #fff;
            font-size: 0.75rem;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem;
            border-left: 4px solid;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(4px);
            z-index: 100;
            animation: slideUp 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal {
            transition: opacity 0.2s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .muscle-path {
            fill: #1a1a1a;
            stroke: #333;
            stroke-width: 1;
            transition: all 0.3s;
            cursor: pointer;
        }

        .muscle-path:hover {
            fill: #00ff41;
            stroke: #fff;
        }

        .muscle-path.active {
            fill: #00f3ff;
            stroke: #fff;
            filter: drop-shadow(0 0 5px rgba(0, 243, 255, 0.5));
        }

        .anatomy-grid {
            background-image: linear-gradient(rgba(0, 255, 65, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 65, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .alert-overlay {
            background: rgba(255, 0, 60, 0.1);
            border: 1px solid #ff003c;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background-color: #ff003c;
            border-radius: 50%;
            box-shadow: 0 0 5px #ff003c;
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes ping {

            75%,
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Radio Button Styling for Portions */
        .portion-radio:checked+div {
            background-color: rgba(0, 255, 65, 0.1);
            border-color: #00ff41;
            color: #fff;
        }

        .portion-radio:checked+div .radio-dot {
            background-color: #00ff41;
            box-shadow: 0 0 8px #00ff41;
        }

        /* Custom Scrollbar for containers */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 2px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #00ff41;
        }

        /* ============================================
           PHASE 1: PREMIUM UI ENHANCEMENTS
           Estetik: Endüstriyel/Taktiksel Premium
           ============================================ */

        /* Typography Enhancement */
        body {
            font-family: 'Inter', 'JetBrains Mono', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            letter-spacing: 0.01em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .font-mono,
        code,
        pre,
        input[type="number"] {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            letter-spacing: -0.02em;
        }

        /* Smooth Global Transitions */
        *,
        *::before,
        *::after {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Card Hover Lift Effect */
        .card-hover-lift {
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
        }

        .card-hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4), 0 0 1px rgba(0, 255, 65, 0.1);
        }

        /* Progress Bar Shimmer */
        .progress-shimmer {
            position: relative;
            overflow: hidden;
        }

        .progress-shimmer::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.15) 50%,
                    transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        /* Enhanced Checkbox Bounce */
        .custom-checkbox {
            transition: transform 0.15s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .custom-checkbox:hover {
            border-color: #00ff41;
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.2);
        }

        .custom-checkbox:checked {
            animation: checkBounce 0.25s ease-out;
        }

        @keyframes checkBounce {
            0% {
                transform: scale(1);
            }

            40% {
                transform: scale(1.15);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Tab Navigation Underline */
        .tab-btn {
            position: relative;
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #00ff41;
            transition: width 0.25s ease, left 0.25s ease;
        }

        .tab-btn:hover::after,
        .tab-btn.active-tab::after {
            width: 100%;
            left: 0;
        }

        .tab-btn:hover i,
        .tab-btn.active-tab i {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }

        /* Button Press Feedback */
        button,
        .btn-press {
            transition: transform 0.1s ease, background-color 0.2s ease, border-color 0.2s ease;
        }

        button:active,
        .btn-press:active {
            transform: scale(0.97);
        }

        /* Input Focus Glow */
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #00ff41 !important;
            box-shadow: 0 0 0 2px rgba(0, 255, 65, 0.15), 0 0 12px rgba(0, 255, 65, 0.1);
        }

        /* Toast Slide-In Animation */
        .toast {
            animation: toastSlideIn 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes toastSlideIn {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }

            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Modal Scale-In Animation */
        .modal.active .modal-content {
            animation: modalScaleIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalScaleIn {
            0% {
                transform: scale(0.95);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* View Container Smooth Transition */
        #view-container {
            transition: opacity 0.15s ease;
        }

        /* ============================================
           PHASE 3: VISUAL POLISH
           ============================================ */

        /* Exercise Card Hover */
        .exercise-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .exercise-card:hover {
            background: rgba(0, 255, 65, 0.03);
            border-color: rgba(0, 255, 65, 0.3) !important;
            transform: translateX(4px);
        }

        .exercise-card:hover i {
            color: #00ff41;
        }

        /* Meal Item Hover */
        .meal-item {
            transition: all 0.2s ease;
        }

        .meal-item:hover {
            background: rgba(0, 255, 65, 0.05);
            transform: translateX(3px);
        }

        /* Details/Summary Smooth Open */
        details {
            transition: all 0.25s ease;
        }

        details summary {
            cursor: pointer;
        }

        details[open] summary~* {
            animation: detailsOpen 0.25s ease-out;
        }

        @keyframes detailsOpen {
            0% {
                opacity: 0;
                transform: translateY(-8px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Touch Feedback */
        @media (hover: none) {
            .card-hover-lift:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }

            .exercise-card:active {
                background: rgba(0, 255, 65, 0.08);
                transform: scale(0.99);
            }

            .meal-item:active {
                background: rgba(0, 255, 65, 0.08);
            }

            button:active {
                transform: scale(0.95);
            }

            .tab-btn:active {
                background: rgba(0, 255, 65, 0.1);
            }
        }

        /* Scrollbar animation on scroll */
        .custom-scrollbar {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body class="text-base">

    <!-- NAV -->
    <nav class="fixed top-0 w-full bg-gunmetal/80 backdrop-blur-md z-40 border-b border-white/5 h-20">
        <div class="container mx-auto h-full px-6 flex justify-between items-center max-w-7xl">
            <div class="flex items-center gap-4">
                <i class="fas fa-biohazard text-neon-green text-2xl"></i>
                <div>
                    <h1 class="font-header font-bold text-white tracking-wider text-lg md:text-xl">PROTOCOL <span
                            class="text-sm text-text-muted">v5.7.0</span></h1>
                    <div class="text-[10px] text-neon-green font-bold tracking-[0.2em] uppercase">FIELD TEST APPROVED
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <div id="clock-display" class="hidden md:block font-mono text-text-muted font-bold text-sm">--:--:--
                </div>
                <button onclick="Actions.toggleOverride()" id="btn-override"
                    class="bg-neon-red/10 text-neon-red px-4 py-2 rounded-lg hover:bg-neon-red hover:text-white transition text-xs font-bold tracking-widest">
                    <i class="fas fa-power-off mr-2"></i> OVERRIDE
                </button>
            </div>
        </div>
    </nav>

    <!-- MAIN -->
    <main class="container mx-auto mt-24 px-6 pb-24 max-w-7xl">
        <div class="flex justify-center overflow-x-auto mb-8 gap-3 border-b border-white/5 pb-2 scrollbar-hide"
            id="nav-tabs"></div>
        <div id="view-container" class="min-h-[60vh] animate-slide-up"></div>
    </main>

    <!-- MODAL -->
    <div id="universal-modal"
        class="modal fixed inset-0 z-50 flex items-center justify-center p-6 bg-gunmetal/90 backdrop-blur-md">
        <div
            class="modal-content bg-surface-card w-full max-w-2xl rounded-2xl shadow-2xl relative max-h-[85vh] flex flex-col">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <h3 id="modal-title" class="font-header text-xl font-bold text-neon-green">INFO</h3>
                <button onclick="UI.modal.close()" class="text-text-muted hover:text-white transition p-2"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div id="modal-body" class="p-8 overflow-y-auto custom-scrollbar"></div>
        </div>
    </div>

    <!-- ALERT MODAL -->
    <div id="alert-modal"
        class="modal fixed inset-0 z-[60] flex items-center justify-center p-6 bg-gunmetal/95 backdrop-blur-lg">
        <div
            class="modal-content bg-surface-card border border-neon-red/30 w-full max-w-md rounded-2xl shadow-[0_0_60px_rgba(255,0,60,0.2)] relative p-8 text-center">
            <i class="fas fa-exclamation-triangle text-6xl text-neon-red mb-6"></i>
            <h2 class="text-3xl font-header font-bold text-white mb-3">SİSTEM UYARISI</h2>
            <p id="alert-message" class="text-gray-300 mb-8 text-base leading-relaxed"></p>
            <button onclick="UI.alert.close()"
                class="bg-neon-red text-white font-bold py-4 px-8 rounded-xl hover:bg-white hover:text-neon-red transition w-full text-lg">ANLAŞILDI
                KOMUTANIM</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <!-- OVERRIDE PANEL (Robot Mode) -->
    <div id="override-panel">
        <div id="override-timer">00:00</div>
        <div id="override-mission">GÖREV: TAMAMLANMAMIŞ İŞLER</div>
        <button onclick="Actions.exitOverride()"
            class="mt-3 text-xs text-gray-500 hover:text-white border border-gray-700 px-3 py-1 rounded">ÇIKIŞ
            (ESC)</button>
    </div>

    <script>
        // --- CONFIG & DATA ---
        const CONFIG = {
            VERSION: '5.7.0 Premium',
            KEYS: {
                WEIGHT: 'monk_weight',
                FUEL: 'monk_fuel_date',
                WORKOUT: 'monk_workout_log_',
                MEAL: 'monk_meal_log_',
                MEASURE: 'monk_body_stats',
                WEIGHT_HISTORY: 'monk_weight_history',
                CUSTOM_FOODS: 'monk_custom_foods',
                DAILY_PLAN: 'monk_daily_plan',
                STREAK: 'monk_streak_data'
            },
            TARGETS: { START: 45.0, GOAL: 60.0, CAL: 3000, PROT: 225, CARB: 375, FAT: 67 }
        };

        const THEME = {
            card: "bg-surface-card rounded-xl p-6 md:p-8 shadow-2xl transition-all card-hover-lift",
            btn: "bg-surface-raised hover:bg-neon-green hover:text-gunmetal text-white font-bold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2",
            input: "bg-surface-raised border-0 text-white rounded-lg p-3 focus:ring-2 focus:ring-neon-green/30 outline-none w-full transition-all",
            label: "text-xs uppercase tracking-[0.2em] text-text-muted font-bold mb-3 block"
        };

        const DB = {
            WEEKLY_PLAN: {
                1: { name: "PAZARTESİ", title: "FULL BODY START", tasks: ["squat", "pushup", "one_arm_row", "plank"] },
                2: { name: "SALI", title: "BESLENME & RECOVERY", tasks: ["eat_bulk", "stretch", "farmers_walk"] },
                3: { name: "ÇARŞAMBA", title: "CORE & KERNEL", tasks: ["lying_leg_raise", "mountain_climber", "stomach_vacuum", "kegel", "bottle_curl"] },
                4: { name: "PERŞEMBE", title: "LEG DAY", tasks: ["squat_heavy", "single_leg_raise", "stretch"] },
                5: { name: "CUMA", title: "STRESS TEST", tasks: ["goblet_squat", "one_arm_row", "pushup", "hammer_curl"] },
                6: { name: "CUMARTESİ", title: "ACTIVE REST", tasks: ["stomach_vacuum", "farmers_walk", "cool_down", "walk_outside"] },
                0: { name: "PAZAR", title: "SYSTEM REBOOT", tasks: ["weigh_in", "prep_food"] }
            },
            EXERCISES: {
                "stomach_vacuum": {
                    title: "Stomach Vacuum",
                    tags: ["Core", "İç Korse"],
                    desc: "Sabah aç karnına. Nefesinin tamamını dışarı üfle. Nefes almadan göbeğini omurgana yapıştır. 10-15 saniye bekle. İç korseyi (Transversus Abdominis) sıkılaştırır.<br><br><strong>HEDEF:</strong> 3 Set x 15-20 Saniye Bekle.",
                    steps: ["Nefesi boşalt.", "Vakumla.", "Bekle."]
                },
                "squat": {
                    title: "Squat (Warmup)",
                    tags: ["Bacak", "Kalça"],
                    desc: "Ayaklar omuz genişliğinde. İnerken 'Sandalyeye oturur gibi' geriye git. Dizlerin içeri çökmesin. Kalkarken TOPUKLARINA bas.<br><br><strong>HEDEF:</strong> 4 Set x 20 Tekrar.",
                    steps: ["Ayaklar omuz genişliğinde.", "Sırt dik.", "Topuklara bas."]
                },
                "goblet_squat": {
                    title: "Goblet Squat (Yüklü)",
                    tags: ["Bacak", "Güç"],
                    desc: "Ayaklar omuz genişliğinde. Ağırlığı göğsüne YAPIŞTIR (Goblet). İnerken 'Sandalyeye oturur gibi' geriye git. Dizlerin içeri çökmesin (Valgus Collapse). Kalkarken TOPUKLARINA bas. Titreme başladığında durma, orası gelişim bölgesidir.<br><br><strong>HEDEF:</strong> 4 Set x 20 Tekrar.",
                    steps: ["Ağırlığı kucakla.", "Kalça geriye.", "Topukla it."]
                },
                "pushup": {
                    title: "Incline/Standard Push-up",
                    tags: ["Göğüs", "Patlayıcı Güç"],
                    desc: "Eller koltuk/yatak kenarında (veya yerde). Vücut dümdüz (Plank formunda). İnerken 3 saniye (Yavaş/Negatif), kalkarken 1 saniye (Patlayıcı). Bileklerin ağrıyorsa YUMRUK üstünde veya tutamaçla yap. Göğsünü değdirmeden kalkma.<br><br><strong>HEDEF:</strong> 4 Set x MAKSİMUM Tekrar.",
                    steps: ["Vücut ok gibi düz.", "Yavaş in (3sn).", "Patlayıcı kalk (1sn)."]
                },
                "one_arm_row": {
                    title: "One Arm Row (Tek Kol Çekiş)",
                    tags: ["Sırt", "Kanat"],
                    desc: "Yatağın/Koltuğun kenarına geç. Bir elini ve dizini daya (Masa pozisyonu). Diğer elinle ağırlığı CEBİNE DOĞRU çek. Dirseğin vücuduna sürterek geriye gitsin. Tepede sırtını sıkıştır.<br><br><strong>HEDEF:</strong> 4 Set x 12 Tekrar (Her Kol).",
                    steps: ["Masa pozisyonu al.", "Dirseği sürt.", "Cebine çek."]
                },
                "plank": {
                    title: "RKC Plank",
                    tags: ["Core", "Stabilizasyon"],
                    desc: "Dirsekler omuz altında. Elleri birleştirme (Yumruk yap). Kalçanı sık (Posterior Tilt), karnını içeri vakumla. Sadece durma, dirseklerini ayaklarına doğru çekmeye çalış (RKC Plank). Titreme yoksa verim yoktur.<br><br><strong>HEDEF:</strong> 3 Set x 30-45 Saniye.",
                    steps: ["Dirsekler yerde.", "Götünü sık.", "Dirsekleri ayaklara çek."]
                },
                "farmers_walk": {
                    title: "Farmer's Walk",
                    tags: ["Bilek", "Pençe Kuvveti"],
                    desc: "Yükleri iki eline al. Omuzlar geride, göğüs ileride. Kollarını 'Ölü Ağırlık' gibi aşağı sal (Dirsek bükme). Küçük ve seri adımlarla yürü. Bileklerin kopana kadar bırakma.<br><br><strong>HEDEF:</strong> 3 Tur (Parmaklar açılana kadar).",
                    steps: ["Omuzlar geride.", "Kollar kilitli.", "Yürü."]
                },
                "hammer_curl": {
                    title: "Hammer Curl",
                    tags: ["Biceps", "Ön Kol"],
                    desc: "Ayakta dur. Ağırlığı çekiç tutar gibi (Avuç içi vücuda dönük) kavra. Dirseklerini vücuduna YAPIŞTIR ve kilitle. Ağırlığı omzuna doğru kaldır, yavaşça indir. Sallanma, belden güç alma.<br><br><strong>HEDEF:</strong> 4 Set x 12 Tekrar.",
                    steps: ["Dirsek yapışık.", "Çekiç tutuş.", "Yavaş indir."]
                },
                "kegel": {
                    title: "Kegel",
                    tags: ["Pelvis", "Cinsel Güç"],
                    desc: "Tuvaletini tutar gibi PC kasını sık. Kalçanı veya karnını sıkma, sadece o bölgeyi izole et. 3 saniye sık, 3 saniye bırak. Ereksiyon kalitesini artırır.<br><br><strong>HEDEF:</strong> 5 Set x 10 Tekrar.",
                    steps: ["İzole et.", "Sık (3sn).", "Bırak (3sn)."]
                },
                "mountain_climber": {
                    title: "Mountain Climber",
                    tags: ["Kardiyo"],
                    desc: "Yerde koşma.<br><br><strong>HEDEF:</strong> 3 x 45sn.",
                    steps: ["Şınav pozisyonu.", "Koş."]
                },
                "lying_leg_raise": {
                    title: "Lying Leg Raise",
                    tags: ["Alt Karın", "Core"],
                    desc: "Sırt üstü yat. ELLERİNİ KALÇANIN ALTINA KOY (Mekanik Destek). Belini yere mühürle (Boşluk kalmasın). Bacakları kaldır, indirirken BELİN KALKMADAN hemen önce dur. *Yanma hissi bacakta değil, alt karında olmalı. Belin kalkıyorsa hareket çöptür.*<br><br><strong>HEDEF:</strong> 4 Set x 12.",
                    steps: ["Eller popo altı.", "Belini bas.", "Kontrollü indir."]
                },
                "eat_bulk": { title: "BULK YE", tags: ["Yemek"], desc: "Kalori al.", steps: ["Öğün atlama."] },
                "stretch": { title: "ESNEME", tags: ["Recovery"], desc: "Rahatla.", steps: ["Ağrıyan yeri esnet."] },
                "walk_outside": { title: "YÜRÜYÜŞ", tags: ["Mental"], desc: "Hava al.", steps: ["Dışarı çık."] },
                "eat_home": { title: "EV YEMEĞİ", tags: ["Beslenme"], desc: "Dışarıdan yeme.", steps: [] },
                "weigh_in": { title: "TARTIL", tags: ["Analiz"], desc: "Aç karna.", steps: [] },
                "prep_food": { title: "STOK", tags: ["Lojistik"], desc: "Eksikleri al.", steps: [] },
                "single_leg_raise": { title: "Single Leg Raise", tags: ["Alt Karın"], desc: "Tek tek kaldır.<br><br><strong>HEDEF:</strong> 4 Set x 12.", steps: ["Tek bacak."] },
                "bottle_curl": { title: "Bottle Curl", tags: ["Pazı"], desc: "Ağırlık ile curl.<br><br><strong>HEDEF:</strong> 4 Set x 12.", steps: ["Kaldır."] },
                "squat_heavy": { title: "Bulgarian Split Squat", tags: ["Bacak"], desc: "Ayağını arkadaki koltuğa koy. Tek bacakla çök kalk.<br><br><strong>HEDEF:</strong> 4 Set x 12 (Her Bacak).", steps: ["Tek ayak koltukta.", "Dik dur.", "Çök."] },
                "cool_down": {
                    title: "Cool Down (Soğuma)",
                    tags: ["Recovery", "Esneklik"],
                    desc: "Serbest Stil Esneme & Rahatlama.<br><br><strong>HEDEF:</strong> 5-10 Dakika.",
                    steps: ["Derin nefes al.", "Kaslarını uzat.", "Gevşe."]
                },
                "superman": {
                    title: "Superman",
                    tags: ["Alt Sırt", "Core"],
                    desc: "Yüzüstü yat. Kollarını ve bacaklarını aynı anda kaldır. 2-3 saniye tepede tut.<br><br><strong>HEDEF:</strong> 3 Set x 12 Tekrar.",
                    steps: ["Yüzüstü yat.", "Kol ve bacakları kaldır.", "Tepede tut."]
                }
            },
            FOODS: [
                { id: 100, cat: "PROTOKOL", name: "GAINER SHAKE (Bizim Tarif)", type: "piece", vals: { cal: 850, prot: 35, carb: 100, fat: 35 }, unitName: "Adet" },
                { id: 101, cat: "PROTOKOL", name: "Zeytinyağı", type: "portion", vals: { cal: 884, prot: 0, carb: 0, fat: 100 }, options: [{ label: "1 Tatlı Kaşığı", ratio: 0.05 }, { label: "1 Yemek Kaşığı", ratio: 0.14 }] },
                { id: 1, cat: "PROTEİN", name: "Tavuk Göğsü (Haşlama/Izgara)", type: "portion", vals: { cal: 165, prot: 31, carb: 0, fat: 3.6 }, options: [{ label: "Küçük Porsiyon (100g)", ratio: 1 }, { label: "Normal Porsiyon (150g)", ratio: 1.5 }, { label: "Sporcu Porsiyonu (250g)", ratio: 2.5 }] },
                { id: 2, cat: "PROTEİN", name: "Tavuk But (Daha Yağlı)", type: "portion", vals: { cal: 210, prot: 24, carb: 0, fat: 12 }, options: [{ label: "1 Adet But", ratio: 1.5 }, { label: "2 Adet But", ratio: 3 }] },
                { id: 3, cat: "PROTEİN", name: "Köfte (Ev Yapımı)", type: "piece", vals: { cal: 60, prot: 5, carb: 2, fat: 4 }, unitName: "Adet" },
                { id: 4, cat: "PROTEİN", name: "Ton Balığı (Yağlı/Süzülmüş)", type: "portion", vals: { cal: 190, prot: 26, carb: 0, fat: 10 }, options: [{ label: "Küçük Kutu (80g)", ratio: 0.8 }, { label: "Büyük Kutu (160g)", ratio: 1.6 }] },
                { id: 5, cat: "PROTEİN", name: "Yumurta (Haşlanmış)", type: "piece", vals: { cal: 75, prot: 7, carb: 0.6, fat: 5 }, unitName: "Adet" },
                { id: 6, cat: "PROTEİN", name: "Lor Peyniri", type: "portion", vals: { cal: 90, prot: 15, carb: 2, fat: 1 }, options: [{ label: "3-4 Kaşık (100g)", ratio: 1 }, { label: "Yarım Paket (250g)", ratio: 2.5 }] },
                { id: 7, cat: "PROTEİN", name: "Kaşar Peyniri", type: "piece", vals: { cal: 70, prot: 5, carb: 0.5, fat: 6 }, unitName: "Dilim" },
                { id: 20, cat: "KARBONHİDRAT", name: "Pirinç Pilavı", type: "portion", vals: { cal: 130, prot: 2.7, carb: 28, fat: 0.3 }, options: [{ label: "Az (4-5 Kaşık)", ratio: 1 }, { label: "Tabak (200g)", ratio: 2 }, { label: "Dolu Tabak (300g)", ratio: 3 }] },
                { id: 21, cat: "KARBONHİDRAT", name: "Bulgur Pilavı", type: "portion", vals: { cal: 85, prot: 3, carb: 18, fat: 0.2 }, options: [{ label: "Az (4-5 Kaşık)", ratio: 1 }, { label: "Tabak (200g)", ratio: 2 }, { label: "Dolu Tabak (300g)", ratio: 3 }] },
                { id: 22, cat: "KARBONHİDRAT", name: "Makarna (Sade/Salçalı)", type: "portion", vals: { cal: 131, prot: 5, carb: 25, fat: 1 }, options: [{ label: "Küçük Tabak", ratio: 1 }, { label: "Normal Tabak", ratio: 2 }, { label: "Tepeleme Dolu", ratio: 3.5 }, { label: "Yarım Paket (Kuru)", ratio: 9 }] },
                { id: 23, cat: "KARBONHİDRAT", name: "Haşlanmış Patates", type: "piece", vals: { cal: 90, prot: 2, carb: 20, fat: 0.1 }, unitName: "Adet (Orta)" },
                { id: 24, cat: "KARBONHİDRAT", name: "Ekmek (Beyaz/Somun)", type: "portion", vals: { cal: 260, prot: 9, carb: 49, fat: 3 }, options: [{ label: "1 Dilim", ratio: 0.25 }, { label: "Çeyrek Ekmek", ratio: 0.6 }, { label: "Yarım Ekmek", ratio: 1.2 }] },
                { id: 25, cat: "KARBONHİDRAT", name: "Lavaş", type: "piece", vals: { cal: 180, prot: 5, carb: 35, fat: 2 }, unitName: "Adet" },
                { id: 40, cat: "SOKAK", name: "Tavuk Döner", type: "portion", vals: { cal: 250, prot: 15, carb: 30, fat: 10 }, options: [{ label: "Yarım Ekmek", ratio: 2 }, { label: "Dürüm", ratio: 2.5 }, { label: "Zurna Dürüm", ratio: 3.5 }] },
                { id: 41, cat: "SOKAK", name: "Et Döner", type: "portion", vals: { cal: 280, prot: 18, carb: 30, fat: 15 }, options: [{ label: "Yarım Ekmek", ratio: 2 }, { label: "Dürüm", ratio: 2.5 }, { label: "Porsiyon", ratio: 1.5 }] },
                { id: 42, cat: "SOKAK", name: "Lahmacun", type: "piece", vals: { cal: 180, prot: 10, carb: 25, fat: 5 }, unitName: "Adet" },
                { id: 43, cat: "SOKAK", name: "Çiğ Köfte", type: "portion", vals: { cal: 250, prot: 5, carb: 40, fat: 10 }, options: [{ label: "Dürüm", ratio: 1 }, { label: "Porsiyon (10 Sıkım)", ratio: 1.2 }] },
                { id: 44, cat: "SOKAK", name: "Simit", type: "piece", vals: { cal: 320, prot: 10, carb: 55, fat: 5 }, unitName: "Adet" },
                { id: 45, cat: "SOKAK", name: "Kıymalı Pide", type: "piece", vals: { cal: 500, prot: 20, carb: 60, fat: 20 }, unitName: "Adet (Tüm)" },
                { id: 60, cat: "EV YEMEĞİ", name: "Kuru Fasulye / Nohut", type: "portion", vals: { cal: 120, prot: 7, carb: 15, fat: 4 }, options: [{ label: "Az (Yarım Tabak)", ratio: 1 }, { label: "Tam Porsiyon", ratio: 2 }, { label: "Esnaf Porsiyonu (Bol)", ratio: 3 }] },
                { id: 61, cat: "EV YEMEĞİ", name: "Taze Fasulye / Türlü", type: "portion", vals: { cal: 70, prot: 2, carb: 8, fat: 4 }, options: [{ label: "Normal Tabak", ratio: 2 }, { label: "Dolu Tabak", ratio: 3 }] },
                { id: 62, cat: "EV YEMEĞİ", name: "Mercimek Çorbası", type: "portion", vals: { cal: 60, prot: 3, carb: 8, fat: 2 }, options: [{ label: "1 Kase", ratio: 2 }, { label: "Büyük Kase", ratio: 3 }] },
                { id: 63, cat: "EV YEMEĞİ", name: "Menemen", type: "portion", vals: { cal: 120, prot: 8, carb: 5, fat: 9 }, options: [{ label: "Yarım Tava (Tek Kişilik)", ratio: 2 }, { label: "Tam Tava", ratio: 4 }] },
                { id: 80, cat: "SNACK", name: "Cici Bebe", type: "portion", vals: { cal: 440, prot: 6, carb: 75, fat: 12 }, options: [{ label: "10 Adet", ratio: 0.4 }, { label: "Yarım Paket", ratio: 1 }, { label: "1 Kase Sütlü", ratio: 1.5 }] },
                { id: 81, cat: "SNACK", name: "Fıstık Ezmesi", type: "portion", vals: { cal: 590, prot: 25, carb: 20, fat: 50 }, options: [{ label: "1 Tatlı Kaşığı", ratio: 0.1 }, { label: "1 Yemek Kaşığı", ratio: 0.2 }, { label: "Tepeleme Kaşık", ratio: 0.35 }] },
                { id: 82, cat: "SNACK", name: "Yulaf Ezmesi", type: "portion", vals: { cal: 370, prot: 13, carb: 60, fat: 7 }, options: [{ label: "3-4 Kaşık", ratio: 0.4 }, { label: "1 Su Bardağı", ratio: 1 }, { label: "Büyük Kase", ratio: 1.5 }] },
                { id: 83, cat: "SNACK", name: "Muz", type: "piece", vals: { cal: 105, prot: 1, carb: 27, fat: 0.4 }, unitName: "Adet" },
                { id: 84, cat: "SNACK", name: "Süt (Tam/Yarım)", type: "portion", vals: { cal: 60, prot: 3, carb: 5, fat: 3 }, options: [{ label: "1 Bardak (200ml)", ratio: 2 }, { label: "Büyük Kupa (300ml)", ratio: 3 }, { label: "Yarım Kutu (500ml)", ratio: 5 }] },
                { id: 85, cat: "SNACK", name: "Yoğurt", type: "portion", vals: { cal: 65, prot: 4, carb: 5, fat: 3 }, options: [{ label: "1 Kase", ratio: 2 }, { label: "Büyük Kase", ratio: 3 }] },
                { id: 86, cat: "SNACK", name: "Cips", type: "portion", vals: { cal: 530, prot: 6, carb: 50, fat: 35 }, options: [{ label: "1 Avuç", ratio: 0.2 }, { label: "Küçük Paket", ratio: 0.5 }, { label: "Büyük Paket", ratio: 1.5 }] },
                { id: 87, cat: "SNACK", name: "Kakaolu Süt (Küçük)", type: "piece", vals: { cal: 150, prot: 6, carb: 20, fat: 4 }, unitName: "Kutu (200ml)" },
                { id: 88, cat: "SNACK", name: "Indomie Noodle", type: "piece", vals: { cal: 350, prot: 8, carb: 45, fat: 15 }, unitName: "Paket" }
            ],
            MEAL_PLAN_DB: {
                breakfast: [
                    { text: "3 Yumurta (Tavada/Omlet) + 3 Dilim Kaşar + Ekmek", kcal: 550 },
                    { text: "3 Haşlanmış Yumurta + 5-6 Zeytin + Bol Ekmek", kcal: 500 },
                    { text: "Menemen (3 Yumurtalı) + Yarım Ekmek", kcal: 600 },
                    { text: "Krep (2 Yumurta + 2 Bardak Süt + Un) + Fıstık Ezmesi", kcal: 700 }
                ],
                fuel: [
                    { text: "GAINER SHAKE (500ml - Bizim Tarif)", kcal: 850 },
                    { text: "GAINER SHAKE + 1 Muz (Ekstra)", kcal: 950 }
                ],
                lunch: [
                    { text: "Tavuklu Pilav (1.5 Porsiyon / Bol Tavuklu)", kcal: 750 },
                    { text: "Tavuk Döner (Tam Ekmek / Zurna Dürüm)", kcal: 800 },
                    { text: "Kıymalı Pide (1.5 Porsiyon)", kcal: 750 },
                    { text: "Makarna (Bol Salçalı ve Yağlı) + Yoğurt", kcal: 700 }
                ],
                pre_workout: [
                    { text: "1 Muz + 1 Sade Kahve", kcal: 110 },
                    { text: "2 Dilim Fıstık Ezmeli Ekmek", kcal: 350 },
                    { text: "1 Paket Cici Bebe + Süt", kcal: 600 }
                ],
                dinner: [
                    { text: "Ev Yemeği (Bakliyat/Sebze) + 100gr Lor Peyniri", kcal: 500 },
                    { text: "Kıymalı Makarna (Dolu Tabak) + Yoğurt", kcal: 650 },
                    { text: "Tavuk Sote + Pilav (Dolu Tabak)", kcal: 700 }
                ],
                night: [
                    { text: "1 Bardak Süt + 1 Avuç Kuruyemiş (Fıstık/Leblebi)", kcal: 300 },
                    { text: "Kaşarlı Tost (Çift Kaşarlı)", kcal: 400 },
                    { text: "Kalan Shake (Varsa)", kcal: 300 }
                ]
            },
            ANATOMY_DB: {
                "chest": { name: "Pectoralis Major", function: "İtme kuvveti.", system: "Üst Gövde İtiş", action: "Push-up, Floor Press", recovery: "48-72 Saat" },
                "abs": { name: "Rectus Abdominis", function: "Core gücü, cinsel dayanıklılık.", system: "Merkezi Denge", action: "Plank, Leg Raise, Vacuum", recovery: "24-48 Saat" },
                "quads": { name: "Quadriceps", function: "Vücudu taşıma, piston gücü.", system: "Lokomotor", action: "Squat", recovery: "72 Saat" },
                "biceps": { name: "Biceps Brachii", function: "Çekme, kavrama.", system: "Üst Gövde Çekiş", action: "Hammer Curl", recovery: "48 Saat" },
                "traps": { name: "Trapezius", function: "Omuz stabilizasyonu.", system: "Posterior Zincir", action: "Farmer's Walk", recovery: "48 Saat" },
                "lats": { name: "Latissimus Dorsi", function: "Gövdeyi yukarı çekme.", system: "Posterior Zincir", action: "One Arm Row", recovery: "48-72 Saat" },
                "glutes": { name: "Gluteus Maximus", function: "İtiş gücü (Thrust).", system: "Güç Merkezi", action: "Squat", recovery: "72 Saat" },
                "hamstrings": { name: "Hamstrings", function: "Diz bükme.", system: "Lokomotor", action: "Squat", recovery: "48-72 Saat" },
                "lowerback": { name: "Erector Spinae", function: "Omurgayı dik tutma.", system: "Core Destek", action: "Superman", recovery: "48 Saat" },
                "pelvic": { name: "Pelvik Taban", function: "Boşalma kontrolü.", system: "Üreme", action: "Kegel", recovery: "24 Saat" }
            },
            MENTAL_PHASES: [
                {
                    id: 1,
                    title: "FAZ 1: JAGUAR TEORİSİ",
                    desc: "Algı Yönetimi. Dışarıya güçlü görün, içeriği doldur.",
                    core: "Dışarıdan bakıldığında kırılgan, dağınık veya çaresiz görünmemek. Önce dışarıya soğukkanlı, kontrollü ve güçlü bir ‘kasa’ kurmak, sonra bu kasanın içini zamanla gerçek performans ve kapasiteyle doldurmak.",
                    intent: "İmaj ile iç gerçeklik arasındaki farkı bilinçli yönetmek. Şu an eksik olsan bile ‘kendi kendini ciddiye alan’ bir duruş inşa etmek.",
                    strategy: ["Kendi hakkında sürekli şikâyet eden, mağdur tonundan çıkmak.", "İnsanlara problemlerini değil, hareket planını ve ilerlemeni göstermek.", "Her ortamda minimum şikâyet, maksimum çözüm/aksiyon cümlesi kullanmak."],
                    practice: ["Günlük: En az 1 durumda ‘şikâyet etmek yerine aksiyon cümlesi’ kur.", "Günlük: Kendi hakkında negatif konuşmalarını fark edince durdurup nötr/çözüm odaklı cümleye çevir."]
                },
                {
                    id: 2,
                    title: "FAZ 2: KARANLIK SANATLAR",
                    desc: "Sistemin açıklarını bul. 48 Yasa oku.",
                    core: "İnsan ve sistem dinamiklerini naiflikten çıkıp daha soğuk ve analitik şekilde görmek. Sosyal oyunları, güç ilişkilerini ve manipülasyonları fark edip, bunları en azından savunma seviyesinde bilmek.",
                    intent: "‘Neden böyle oldu?’ diye safça kalmak yerine, insanların hareketlerinin arkasındaki çıkar, korku ve güç dinamiklerini okumayı öğrenmek.",
                    strategy: ["Temel kaynak: 48 Power Laws gibi kitapları saha rehberi gibi okumak.", "Günlük olayları ‘hangi yasa / hangi dinamik’ üzerinden işlediğini analiz etmek.", "Saflık ile aptallığı ayırmayı öğrenmek."],
                    practice: ["Günlük: Gün içinde seni etkileyen 1 olayı seç ve ‘burada kim ne istiyordu?’ diye analiz et.", "Haftalık: En az 1 kere, birinin davranışını sadece söylediklerine göre değil, çıkarına göre yorumlamaya çalış."]
                },
                {
                    id: 3,
                    title: "FAZ 3: ROBOTİK İCRAAT",
                    desc: "Duyguları kapat. Canın istemese de yap.",
                    core: "‘İçimden gelmiyor’ bahanesini öldürmek. Duygusal moduna göre değil, protokole göre hareket etmek. Canın istemediği hâlde minimum paketi bile olsa işi yapmayı öğrenmek.",
                    intent: "Ruh hâline göre değişmeyen, makine gibi çalışan küçük rutinler kurmak.",
                    strategy: ["Her gün için ‘duygu bağımsız’ 2–3 zorunlu davranış belirlemek.", "Kendine duygu analizi değil, metrik soruları sormak: ‘Yaptım mı / yapmadım mı?’.", "Minimum versiyonu kabul etmek: 0 yerine 1 birim iş."],
                    practice: ["Günlük: Her ne olursa olsun yapacağın 2 küçük rutin belirle.", "Günlük: ‘Canım istemiyor’ dediğin anda, rutini en küçük versiyonuyla da olsa icra et."]
                },
                {
                    id: 4,
                    title: "FAZ 4: DEBUGGING",
                    desc: "Reddedilmek hatadır. Analiz et, tekrar dene.",
                    core: "Bir şey yolunda gitmediğinde bunu kişisel değerine saldırı gibi değil, sistemdeki bir bug gibi görmek. Reddedilme, başarısızlık, görmezden gelinme gibi olayları soğukkanlı şekilde dissect etmek.",
                    intent: "‘Ben kötüyüm’ yerine ‘denemem yanlış kurgulanmış’ diyebilecek mesafe kazanmak.",
                    strategy: ["Her başarısız girişimi 3 soruyla incelemek: Ne denedim? Nerede kırıldı? Ne değiştirebilirim?", "Aynı denemeyi iyileştirerek tekrar etmek.", "Veri toplamadan debugging yapmamak."],
                    practice: ["Günlük/Haftalık: Sende iz bırakan her ‘red’ için 3 maddelik mini log yaz.", "Her red sonrası en az 1 tane ‘revize edilmiş yeni deneme’ belirle."]
                },
                {
                    id: 5,
                    title: "FAZ 5: ASYNC EXECUTION",
                    desc: "Mükemmeli bekleme. Aksak ayakla yürü.",
                    core: "Her şey hazır olmadan da harekete geçmek. Ekipman, ortam, ruh hâli, mükemmel plan beklemeden ‘neyle mümkünse onunla’ yola çıkmak.",
                    intent: "Sürekli erteleyen ‘hazırlık modu’ndan çıkıp, kusurlu ama çalışan bir yürüyüşe geçmek.",
                    strategy: ["Projeleri ‘mükemmel versiyon’ yerine ‘bugün başlayabileceğim minimum versiyon’la tanımlamak.", "Mazeret listesini kısaltmak.", "Küçük ama gerçek ilerleme metriği tutmak."],
                    practice: ["Günlük: En az 1 projede ‘hazır değilim’ dediğin noktada 5–10 dakikalık mini icraat yap.", "Günlük: ‘Bugün mükemmel değildi ama şunları yaptım’ diye liste çıkar."]
                },
                {
                    id: 6,
                    title: "FAZ 6: ÜRETİCİ MODU",
                    desc: "Tüketici olma. Tool yaz, içerik üret.",
                    core: "Sürekli izleyen, okuyan, kaydıran tarafta kalmak yerine bir şeyler üreten tarafa geçmek. Bilgiyi sadece depolamak değil, işleyip dışarı veren sistem olmak.",
                    intent: "Her gün seni ‘izleyici’ konumundan biraz daha ‘üretici’ konumuna taşıyan bir output bırakmak.",
                    strategy: ["Tüketim/üretim oranını görmek için basit bir log tutmak.", "Tek bir üretim formatı seçmek.", "Tükettiğin her büyük içerik için en az 1 küçük üretim çıktısı bırakmak."],
                    practice: ["Günlük: En az 1 ‘çıktı’ bırak (tweet, kısa yazı, mini script, repo update vs).", "Günlük: Tüketimi belirli bir banda kilitle."]
                },
                {
                    id: 7,
                    title: "FAZ 7: ŞANS MİMARİSİ",
                    desc: "Havuzunu kaz. Şans yağınca dolacak.",
                    core: "Şansı, tamamen rastgele bir olay olarak değil, senin önceden kazdığın havuzlara yağacak bir yağmur gibi görmek. İnsanlar, beceriler, projeler ve görünürlük üzerinden şans yüzdüğünde yakalayabileceğin yüzey alanını büyütmek.",
                    intent: "Gelecekteki fırsatlara hazır olacak altyapıyı bugünden kurmak.",
                    strategy: ["Skill havuzu oluşturmak.", "Network havuzu oluşturmak.", "Görünürlük havuzu oluşturmak."],
                    practice: ["Günlük/Haftalık: 1 kişiyle hafif bir temas kur.", "Haftalık: Yeni bir ‘havuz taşı’ ekle (küçük repo, not, proje)."]
                },
                {
                    id: 8,
                    title: "FAZ 8: DİNAMİK ADAPTASYON",
                    desc: "Statik olma. Sürekli kendini güncelle.",
                    core: "Planı kutsal değil, yönü kutsal görmek. Şartlara, geri bildirimlere ve kendi değişen hâline göre sistemi güncelleyebilmek.",
                    intent: "Sürekli ‘ben böyleyim’ diye takılı kalmak yerine, versiyon numaranı yükselten bir yaklaşım benimsemek.",
                    strategy: ["Haftalık review rutinini ciddiye almak.", "Sabit kimlik cümleleri yerine, ‘şu an’ki versiyonunu tanımlayan ifadeler kullanmak.", "Hataları ve saçmalıkları ‘sürüm notu’ gibi yazmak."],
                    practice: ["Haftalık: 20–30 dakikalık ‘sistem review’ zamanı ayır.", "Aylık: Kendine ‘version log’ yaz (Bu ay ne değişti?)."]
                }
            ]
        };

        // --- UTILS ---
        const Utils = {
            dateStr: () => new Date().toLocaleDateString('tr-TR').split('.').reverse().join('-'),
            storage: {
                async get(key) {
                    try {
                        if (typeof window.storage !== 'undefined') {
                            const res = await window.storage.get(key, false);
                            return res ? res.value : null;
                        }
                        return JSON.parse(localStorage.getItem(key));
                    } catch (e) { return null; }
                },
                async set(key, val) {
                    try {
                        if (typeof window.storage !== 'undefined') {
                            await window.storage.set(key, val, false);
                        } else {
                            localStorage.setItem(key, JSON.stringify(val));
                        }
                        return true;
                    } catch (e) { UI.showToast("Kayıt Hatası!", "error"); return false; }
                }
            },
            getRandomMeal(category) {
                const options = DB.MEAL_PLAN_DB[category];
                if (!options) return null;
                return options[Math.floor(Math.random() * options.length)];
            }
        };

        // --- STORE ---
        const Store = {
            state: { weight: 45.0, fuelDate: null, customFoods: [], meals: {}, dailyPlan: null, selectedMuscle: null, activeTab: 'dashboard' },
            async init() {
                const w = await Utils.storage.get(CONFIG.KEYS.WEIGHT);
                if (w) this.state.weight = parseFloat(w);
                this.state.fuelDate = await Utils.storage.get(CONFIG.KEYS.FUEL);
                this.state.customFoods = await Utils.storage.get(CONFIG.KEYS.CUSTOM_FOODS) || [];

                // Check or generate daily plan
                const today = Utils.dateStr();
                const savedPlan = await Utils.storage.get(CONFIG.KEYS.DAILY_PLAN);

                if (savedPlan && savedPlan.date === today) {
                    this.state.dailyPlan = savedPlan.plan;
                } else {
                    await this.generateDailyPlan();
                }
            },
            async generateDailyPlan() {
                const plan = {
                    breakfast: Utils.getRandomMeal('breakfast'),
                    fuel: Utils.getRandomMeal('fuel'),
                    lunch: Utils.getRandomMeal('lunch'),
                    pre_workout: Utils.getRandomMeal('pre_workout'),
                    dinner: Utils.getRandomMeal('dinner'),
                    night: Utils.getRandomMeal('night')
                };
                this.state.dailyPlan = plan;
                await Utils.storage.set(CONFIG.KEYS.DAILY_PLAN, { date: Utils.dateStr(), plan: plan });
            },
            async getWorkout(date) { return await Utils.storage.get(CONFIG.KEYS.WORKOUT + date) || []; },
            async toggleTask(id) {
                const date = Utils.dateStr();
                let tasks = await this.getWorkout(date);
                tasks = tasks.includes(id) ? tasks.filter(t => t !== id) : [...tasks, id];
                await Utils.storage.set(CONFIG.KEYS.WORKOUT + date, tasks);
                await this.updateStreak(); // Update streak on task toggle
            },
            async saveWeight(w) {
                this.state.weight = parseFloat(w);
                await Utils.storage.set(CONFIG.KEYS.WEIGHT, this.state.weight);
                let hist = await Utils.storage.get(CONFIG.KEYS.WEIGHT_HISTORY) || {};
                hist[Utils.dateStr()] = this.state.weight;
                await Utils.storage.set(CONFIG.KEYS.WEIGHT_HISTORY, hist);
                return true;
            },
            async saveFuel() {
                this.state.fuelDate = Utils.dateStr();
                await Utils.storage.set(CONFIG.KEYS.FUEL, this.state.fuelDate);
            },
            async addMeal(meal) {
                const date = Utils.dateStr();
                const key = CONFIG.KEYS.MEAL + date;
                let meals = await Utils.storage.get(key) || [];
                meals.push(meal);
                await Utils.storage.set(key, meals);
            },
            async getMeals(date) { return await Utils.storage.get(CONFIG.KEYS.MEAL + date) || []; },
            async deleteMeal(index) {
                const date = Utils.dateStr();
                const key = CONFIG.KEYS.MEAL + date;
                let meals = await Utils.storage.get(key) || [];
                if (index >= 0 && index < meals.length) {
                    meals.splice(index, 1);
                    await Utils.storage.set(key, meals);
                    return true;
                }
                return false;
            },
            async addCustomFood(food) {
                this.state.customFoods.push(food);
                await Utils.storage.set(CONFIG.KEYS.CUSTOM_FOODS, this.state.customFoods);
            },
            getAllFoods() {
                // Sort by category first, then name
                const combined = [...DB.FOODS, ...this.state.customFoods];
                return combined.sort((a, b) => {
                    // Put PROTOKOL first
                    if (a.cat === 'PROTOKOL') return -1;
                    if (b.cat === 'PROTOKOL') return 1;
                    return a.name.localeCompare(b.name);
                });
            },
            async getStats() { return await Utils.storage.get(CONFIG.KEYS.MEASURE) || {}; },
            async saveStats(s) { await Utils.storage.set(CONFIG.KEYS.MEASURE, s); },
            async getHistory() { return await Utils.storage.get(CONFIG.KEYS.WEIGHT_HISTORY) || {}; },

            // Streak & Progress Tracking
            async getStreak() {
                const streakData = await Utils.storage.get(CONFIG.KEYS.STREAK) || { count: 0, lastDate: null };
                const today = Utils.dateStr();
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toLocaleDateString('tr-TR').split('.').reverse().join('-');

                // If last activity was today, return current streak
                if (streakData.lastDate === today) {
                    return streakData.count;
                }
                // If last activity was yesterday, streak continues but needs update
                if (streakData.lastDate === yesterdayStr) {
                    return streakData.count;
                }
                // Otherwise streak is broken
                return 0;
            },
            async updateStreak() {
                const today = Utils.dateStr();
                const workout = await this.getWorkout(today);
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];

                // Only update streak if at least half of tasks are done
                if (workout.length >= Math.ceil(plan.tasks.length / 2)) {
                    let streakData = await Utils.storage.get(CONFIG.KEYS.STREAK) || { count: 0, lastDate: null };

                    if (streakData.lastDate !== today) {
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yesterdayStr = yesterday.toLocaleDateString('tr-TR').split('.').reverse().join('-');

                        if (streakData.lastDate === yesterdayStr) {
                            streakData.count += 1;
                        } else if (streakData.lastDate !== today) {
                            streakData.count = 1; // Reset streak
                        }
                        streakData.lastDate = today;
                        await Utils.storage.set(CONFIG.KEYS.STREAK, streakData);
                    }
                }
            },
            async getTodayProgress() {
                const today = Utils.dateStr();
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];
                const workout = await this.getWorkout(today);
                const meals = await this.getMeals(today);

                const totalCal = meals.reduce((sum, m) => sum + m.cal, 0);
                const tasksDone = workout.length;
                const tasksTotal = plan.tasks.length;

                return {
                    tasksDone,
                    tasksTotal,
                    tasksPercent: Math.round((tasksDone / tasksTotal) * 100),
                    calories: totalCal,
                    caloriesTarget: CONFIG.TARGETS.CAL,
                    caloriesPercent: Math.round((totalCal / CONFIG.TARGETS.CAL) * 100)
                };
            }
        };

        // --- UI ---
        const UI = {
            activeView: 'front',
            init() {
                this.renderTabs();
                this.startClock();
                Actions.switchTab('dashboard');
                Actions.checkSystemAlerts();
            },
            renderTabs() {
                const tabs = [
                    { id: 'dashboard', l: 'DASHBOARD', i: 'fa-chart-line' },
                    { id: 'training', l: 'ANTRENMAN', i: 'fa-dumbbell' },
                    { id: 'nutrition', l: 'BESLENME', i: 'fa-utensils' },
                    { id: 'progress', l: 'GELİŞİM', i: 'fa-chart-bar' },
                    { id: 'anatomy', l: 'ANATOMİ LAB', i: 'fa-dna' },
                    { id: 'mental', l: 'ZİHİNSEL', i: 'fa-brain' }
                ];
                document.getElementById('nav-tabs').innerHTML = tabs.map(t =>
                    `<button onclick="Actions.switchTab('${t.id}')" id="btn-${t.id}" class="tab-btn flex-none px-6 py-3 font-bold text-xs md:text-sm whitespace-nowrap text-gray-500 hover:text-white transition-colors border-b-2 border-transparent relative">
                        <i class="fas ${t.i} mr-2"></i>${t.l}
                        <div id="badge-${t.id}" class="notification-badge hidden"></div>
                    </button>`
                ).join('');
            },
            updateTab(id) {
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active-tab', 'border-neon-green', 'text-neon-green', 'bg-gray-900/50');
                    b.classList.add('text-gray-500', 'border-transparent');
                });
                document.getElementById(`btn-${id}`)?.classList.add('active-tab', 'border-neon-green', 'text-neon-green', 'bg-gray-900/50');
                document.getElementById(`btn-${id}`)?.classList.remove('text-gray-500', 'border-transparent');
            },
            showToast(msg, type = 'success') {
                const c = document.getElementById('toast-container');
                const e = document.createElement('div');
                e.className = `toast mb-3 rounded shadow-lg bg-cyber-dark border-l-4 ${type === 'success' ? 'border-neon-green text-neon-green' : 'border-neon-red text-neon-red'} text-sm font-bold flex items-center gap-3`;
                e.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${msg}`;
                c.appendChild(e);
                setTimeout(() => e.remove(), 3000);
            },
            modal: {
                open(t, c) {
                    document.getElementById('modal-title').innerText = t;
                    document.getElementById('modal-body').innerHTML = c;
                    document.getElementById('universal-modal').classList.add('active');
                },
                close() { document.getElementById('universal-modal').classList.remove('active'); }
            },
            alert: {
                show(msg) {
                    document.getElementById('alert-message').innerHTML = msg;
                    document.getElementById('alert-modal').classList.add('active');
                },
                close() {
                    document.getElementById('alert-modal').classList.remove('active');
                }
            },
            startClock() {
                const el = document.getElementById('clock-display');
                if (!el) return;
                setInterval(() => el.innerText = new Date().toLocaleTimeString('tr-TR'), 1000);
            },
            renderPortionInputs() {
                const select = document.getElementById('m-food');
                const container = document.getElementById('portion-container');
                if (!select || !container) return;

                if (!select.value) return;

                const foods = Store.getAllFoods();
                const selectedFood = foods[select.value];

                if (!selectedFood) return;

                if (selectedFood.type === 'portion') {
                    let html = `<div class="grid grid-cols-1 gap-2 mt-1">`;
                    selectedFood.options.forEach((opt, idx) => {
                        html += `
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="portion_opt" value="${idx}" class="peer sr-only portion-radio" ${idx === 1 ? 'checked' : ''}>
                                <div class="p-3 rounded border border-gray-600 bg-gray-900 text-gray-400 peer-checked:border-neon-green peer-checked:text-white peer-checked:bg-green-900/20 transition-all flex justify-between items-center gap-2 hover:border-gray-400">
                                    <div class="flex items-center gap-3">
                                        <div class="w-4 h-4 rounded-full border border-gray-500 radio-dot flex items-center justify-center"></div>
                                        <span class="text-sm font-bold">${opt.label}</span>
                                    </div>
                                    <span class="text-xs text-gray-500 font-mono">~${Math.round(selectedFood.vals.cal * opt.ratio)} kcal</span>
                                </div>
                            </label>
                        `;
                    });
                    html += `</div>`;
                    container.innerHTML = `<label class="text-[10px] text-gray-500 font-bold block mb-2 tracking-widest">PORSİYON SEÇİMİ</label>${html}`;
                } else {
                    const unitName = selectedFood.unitName || 'Adet';
                    container.innerHTML = `
                        <label class="text-[10px] text-gray-500 font-bold block mb-1">MİKTAR (${unitName})</label>
                        <input type="number" id="m-amount" class="${THEME.input}" value="1" placeholder="Kaç ${unitName}?">
                    `;
                }
            },
            filterFoodList() {
                const search = document.getElementById('food-search').value.toLowerCase();
                const select = document.getElementById('m-food');
                const options = select.options;
                let firstVisibleIndex = -1;

                for (let i = 0; i < options.length; i++) {
                    const txt = options[i].text.toLowerCase();
                    if (txt.includes(search)) {
                        options[i].style.display = "";
                        if (firstVisibleIndex === -1) firstVisibleIndex = i;
                    } else {
                        options[i].style.display = "none";
                    }
                }

                if (select.selectedIndex >= 0 && options[select.selectedIndex].style.display === "none") {
                    if (firstVisibleIndex !== -1) {
                        select.selectedIndex = firstVisibleIndex;
                    }
                }

                this.renderPortionInputs();
            }
        };

        // --- RENDERERS ---
        const Renderers = {
            async dashboard() {
                const p = Math.min(100, Math.max(0, ((Store.state.weight - CONFIG.TARGETS.START) / (CONFIG.TARGETS.GOAL - CONFIG.TARGETS.START)) * 100));
                const fuelDone = Store.state.fuelDate === Utils.dateStr();
                const fuelCardClass = fuelDone ? "border-l-4 border-l-neon-yellow" : "border-2 border-neon-red animate-pulse-urgent";

                // Get streak and today's progress
                const streak = await Store.getStreak();
                const progress = await Store.getTodayProgress();

                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-slide-up">
                        <!-- STREAK CARD - Prominent -->
                        <div class="${THEME.card} text-center relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-br from-neon-green/5 to-transparent"></div>
                            <div class="relative">
                                <div class="${THEME.label}">🔥 STREAK</div>
                                <div class="text-7xl md:text-8xl font-header font-black ${streak > 0 ? 'text-neon-green' : 'text-text-muted'} leading-none">${streak}</div>
                                <div class="text-sm text-text-muted mt-4 uppercase tracking-wider">${streak > 0 ? 'Gün Üst Üste' : 'Seri Kırıldı'}</div>
                            </div>
                        </div>
                        
                        <!-- TODAY'S PROGRESS -->
                        <div class="${THEME.card}">
                            <div class="${THEME.label}">📊 BUGÜNKÜ DURUM</div>
                            <div class="space-y-5 mt-4">
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-text-muted uppercase tracking-wider">Görevler</span>
                                        <span class="text-neon-green font-bold text-lg">${progress.tasksDone}/${progress.tasksTotal}</span>
                                    </div>
                                    <div class="w-full bg-surface-raised h-3 rounded-full overflow-hidden">
                                        <div class="h-full bg-neon-green transition-all duration-500 progress-shimmer rounded-full" style="width: ${progress.tasksPercent}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-text-muted uppercase tracking-wider">Kalori</span>
                                        <span class="text-accent-orange font-bold text-lg">${progress.calories}/${progress.caloriesTarget}</span>
                                    </div>
                                    <div class="w-full bg-surface-raised h-3 rounded-full overflow-hidden">
                                        <div class="h-full bg-accent-orange transition-all duration-500 rounded-full" style="width: ${Math.min(100, progress.caloriesPercent)}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SYSTEM LOAD (WEIGHT) - Hero Card -->
                        <div class="${THEME.card} md:row-span-2 flex flex-col justify-between">
                            <div>
                                <div class="${THEME.label}">⚖️ SYSTEM LOAD</div>
                                <div class="flex items-baseline gap-3 mt-4">
                                    <input type="number" value="${Store.state.weight}" class="bg-transparent text-6xl md:text-7xl font-black text-white w-32 focus:text-neon-green outline-none transition-colors" onchange="Actions.saveWeight(this.value)">
                                    <span class="text-text-muted text-xl">KG</span>
                                </div>
                                <div class="text-text-muted mt-2">Hedef: ${CONFIG.TARGETS.GOAL} KG</div>
                            </div>
                            <div class="mt-6">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-text-muted">İlerleme</span>
                                    <span class="text-neon-green font-bold">${Math.round(p)}%</span>
                                </div>
                                <div class="w-full bg-surface-raised h-4 rounded-full overflow-hidden">
                                    <div class="h-full bg-neon-green transition-all duration-1000 progress-shimmer rounded-full" style="width: ${p}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FUEL STATUS -->
                        <div class="${THEME.card} lg:col-span-2 ${!fuelDone ? 'ring-2 ring-neon-red/50' : ''} relative">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="${THEME.label}">⛽ FUEL STATUS</div>
                                    <div class="text-2xl md:text-3xl font-bold text-white mt-2">GAINER SHAKE</div>
                                    <div class="text-text-muted mt-1">Süt + Yulaf + Fıstık + Muz</div>
                                </div>
                                <button onclick="Actions.injectFuel()" class="${fuelDone ? 'bg-neon-green text-gunmetal' : 'bg-neon-red text-white'} px-6 py-3 rounded-xl font-bold text-sm uppercase tracking-wider transition-all hover:scale-105">
                                    ${fuelDone ? '✓ ENJEKTE EDİLDİ' : '⚠ BEKLİYOR'}
                                </button>
                            </div>
                            ${!fuelDone ? '<div class="absolute top-4 right-4 text-neon-red animate-pulse"><i class="fas fa-exclamation-circle text-xl"></i></div>' : ''}
                        </div>
                        
                        <!-- MOTIVATIONAL QUOTE -->
                        <div class="${THEME.card} text-center flex items-center justify-center bg-surface-raised/50">
                            <div class="text-xl md:text-2xl font-bold text-white/80 italic">"Aksak ayakla yürü, ama yürü."</div>
                        </div>
                    </div>`;
            },
            async training() {
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];
                const done = await Store.getWorkout(Utils.dateStr());
                const btnClass = "bg-gray-800 hover:bg-neon-blue hover:text-black text-neon-blue border border-neon-blue font-bold py-3 px-6 rounded transition w-full mb-6 flex items-center justify-center gap-2 shadow-[0_0_15px_rgba(0,243,255,0.2)]";
                const warmUpBtn = `<button onclick="Actions.openWarmup()" class="${btnClass}"><i class="fas fa-fire animate-pulse"></i> SYSTEM BOOT (ISINMA)</button>`;

                return `<div class="animate-slide-up">
                    <div class="flex justify-between items-end mb-6 border-b border-gray-800 pb-4">
                        <div><h2 class="text-3xl font-header font-bold text-white">${plan.name}</h2><div class="text-neon-green tracking-widest text-xs mt-1">${plan.title}</div></div>
                        <div class="text-xl font-mono text-white">0${day}</div>
                    </div>
                    ${warmUpBtn}
                    <div class="space-y-2">
                        ${plan.tasks.map(tid => {
                    const ex = DB.EXERCISES[tid];
                    const isDone = done.includes(tid);
                    return `<div class="exercise-card flex items-center justify-between p-4 border rounded ${isDone ? 'border-neon-green bg-gray-900' : 'border-gray-700 bg-gray-900/30'}" onclick="if(!event.target.type) Actions.showExercise('${tid}')">
                                <div class="flex items-center gap-4"><i class="fas fa-info-circle text-gray-500"></i><div><div class="font-bold text-white">${ex.title}</div><div class="text-[10px] text-gray-500">${ex.tags.join(', ')}</div></div></div>
                                <input type="checkbox" class="custom-checkbox" ${isDone ? 'checked' : ''} onclick="event.stopPropagation(); Actions.toggleTask('${tid}')">
                            </div>`;
                }).join('')}
                    </div>
                </div>`;
            },
            async nutrition() {
                const meals = await Store.getMeals(Utils.dateStr());
                let t = { c: 0, p: 0, carb: 0, f: 0 };
                const list = meals.map((m, idx) => {
                    t.c += m.cal; t.p += m.prot; t.carb += m.carb; t.f += m.fat;
                    let amountDisplay = "";
                    if (m.unit === 'portion') {
                        amountDisplay = `(${m.portionLabel})`;
                    } else {
                        amountDisplay = `(${m.amount} ${m.unit || 'Adet'})`;
                    }
                    return `<div class="meal-item flex justify-between items-center text-xs bg-gray-900 p-3 rounded mb-1 border border-gray-800 group"><div><span class="text-white font-bold">${m.name}</span> <span class="text-gray-500 text-[10px]">${amountDisplay}</span></div><div class="flex items-center gap-3"><span class="text-neon-green font-mono">${m.cal} kcal</span><button onclick="Actions.deleteMeal(${idx})" class="text-red-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition" title="Sil"><i class="fas fa-trash-alt"></i></button></div></div>`;
                }).join('') || '<div class="text-center text-gray-600 py-4 border-2 border-dashed border-gray-800 rounded">HENÜZ YAKIT GİRİLMEDİ<br><span class="text-[10px] text-neon-red">SİSTEM ZAYIFLIYOR!</span></div>';

                // BRUTAL REALITY LOGIC
                let feedbackBox = "";
                const targetCal = CONFIG.TARGETS.CAL;

                if (t.c < targetCal) {
                    const threats = [
                        "UYARI: Yetersiz Yakıt. Testosteron üretimi durduruluyor. Libido %0'a iniyor.",
                        "KRİTİK: Kas Yıkımı (Katabolizma) Başladı. Kendi bacaklarını yiyorsun.",
                        "HATA: Beyin Sisi Algılandı. Kodlama yeteneğin düşüyor."
                    ];
                    const randomThreat = threats[Math.floor(Math.random() * threats.length)];
                    feedbackBox = `<div class="mt-4 p-4 border-2 border-red-600 bg-red-900/20 rounded text-center animate-pulse-urgent"><div class="text-red-500 font-bold text-lg mb-1"><i class="fas fa-skull"></i> SİSTEM TEHLİKEDE</div><div class="text-gray-300 text-xs">${randomThreat}</div></div>`;
                } else {
                    feedbackBox = `<div class="mt-4 p-4 border-2 border-neon-green bg-green-900/20 rounded text-center"><div class="text-neon-green font-bold text-lg mb-1"><i class="fas fa-check-circle"></i> SİSTEM OPTİMUM</div><div class="text-gray-300 text-xs">Büyüme Hormonu (HGH) Aktif. İnşaat sürüyor.</div></div>`;
                }

                const plan = Store.state.dailyPlan || {};
                let totalPlanCal = 0;
                ['breakfast', 'fuel', 'lunch', 'pre_workout', 'dinner', 'night'].forEach(k => { if (plan[k]) totalPlanCal += plan[k].kcal; });

                return `<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-slide-up"><div class="${THEME.card} h-fit"><span class="text-[10px] text-gray-500 font-bold">GÜNLÜK HEDEF</span><div class="text-4xl font-bold text-white mt-2">${t.c} <span class="text-sm text-gray-500">/ ${targetCal}</span></div><div class="h-2 w-full bg-gray-900 rounded-full mt-2 mb-4 overflow-hidden"><div class="h-full bg-neon-green" style="width:${Math.min(100, (t.c / targetCal) * 100)}%"></div></div>${feedbackBox}<div class="grid grid-cols-3 gap-2 text-center text-xs mb-4 mt-6"><div class="bg-gray-900 p-2 rounded"><div class="text-gray-500">PROT</div><div class="text-neon-blue font-bold">${t.p}/${CONFIG.TARGETS.PROT}</div></div><div class="bg-gray-900 p-2 rounded"><div class="text-gray-500">CARB</div><div class="text-neon-orange font-bold">${t.carb}/${CONFIG.TARGETS.CARB}</div></div><div class="bg-gray-900 p-2 rounded"><div class="text-gray-500">FAT</div><div class="text-neon-yellow font-bold">${t.f}/${CONFIG.TARGETS.FAT}</div></div></div><button onclick="Actions.openMealModal()" class="${THEME.btn} w-full">ÖĞÜN EKLE</button></div><div class="col-span-2 ${THEME.card} flex flex-col"><div class="flex justify-between mb-4 items-center"><span class="text-[10px] text-gray-500 font-bold">GÜNLÜK PLAN (${totalPlanCal} kcal)</span><div class="flex gap-4 items-center"><button onclick="Actions.rerollPlan()" class="text-xs text-neon-blue hover:text-white font-bold"><i class="fas fa-sync-alt mr-1"></i> MENÜYÜ YENİLE</button><span class="text-[10px] text-gray-500">${Utils.dateStr()}</span></div></div>
                <div class="mb-4 bg-gray-900/50 p-3 rounded border border-gray-700 text-xs text-gray-300">
                    <div class="font-bold text-neon-green mb-2">⚡ OPERASYONEL BESLENME PLANI</div>
                    <ul class="space-y-2">
                        <li class="flex gap-2"><span class="text-gray-500 w-10">08:00</span> <span class="text-white font-bold">${plan.breakfast ? plan.breakfast.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">11:00</span> <span class="text-neon-yellow font-bold">${plan.fuel ? plan.fuel.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">14:00</span> <span class="text-white">${plan.lunch ? plan.lunch.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">17:00</span> <span class="text-white">${plan.pre_workout ? plan.pre_workout.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">19:00</span> <span class="text-white">${plan.dinner ? plan.dinner.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">23:00</span> <span class="text-white">${plan.night ? plan.night.text : '...'}</span></li>
                    </ul>
                </div>
                <div class="overflow-y-auto flex-1 h-[200px] custom-scrollbar">${list}</div></div></div>`;
            },
            async progress() {
                const hist = await Store.getHistory();
                const stats = await Store.getStats();
                const dates = Object.keys(hist).sort().slice(-7);
                let bars = dates.length ? dates.map(d => {
                    const h = ((hist[d] - CONFIG.TARGETS.START) / (CONFIG.TARGETS.GOAL - CONFIG.TARGETS.START)) * 80 + 10;
                    return `<div class="w-full bg-gray-800 hover:bg-neon-green/50 relative group rounded-t transition-all" style="height:${h}%"><div class="absolute -top-6 left-1/2 -translate-x-1/2 text-[9px] bg-black px-1 rounded opacity-0 group-hover:opacity-100 transition">${hist[d]}</div></div>`;
                }).join('') : '<div class="text-gray-600 text-xs w-full text-center self-center">Veri yok.</div>';
                return `<div class="grid grid-cols-1 md:grid-cols-2 gap-6 animate-slide-up"><div class="${THEME.card} h-64 flex flex-col"><span class="text-[10px] text-gray-500 font-bold mb-4">AĞIRLIK GEÇMİŞİ</span><div class="flex items-end justify-between gap-1 flex-1 border-b border-gray-800">${bars}</div></div><div class="${THEME.card}"><div class="flex justify-between mb-4"><span class="text-[10px] text-gray-500 font-bold">ÖLÇÜLER (CM)</span><button onclick="Actions.saveStats()" class="text-neon-green text-xs font-bold">KAYDET</button></div><div class="grid grid-cols-2 gap-4">${['chest', 'arm', 'waist', 'leg'].map(k => `<div><label class="text-[10px] text-gray-500 block mb-1 uppercase">${k}</label><input type="number" id="stat-${k}" value="${stats[k] || ''}" class="${THEME.input} text-center"></div>`).join('')}</div></div></div>`;
            },
            async anatomy() {
                const view = UI.activeView;
                const paths = {
                    front: `<path d="M60,50 Q100,70 140,50 L135,90 Q100,100 65,90 Z" class="muscle-path" onclick="Actions.selectMuscle('chest')"></path><rect x="80" y="95" width="40" height="60" rx="5" class="muscle-path" onclick="Actions.selectMuscle('abs')"></rect><path d="M65,160 L90,160 L85,240 L60,240 Z" class="muscle-path" onclick="Actions.selectMuscle('quads')"></path><path d="M110,160 L135,160 L140,240 L115,240 Z" class="muscle-path" onclick="Actions.selectMuscle('quads')"></path><ellipse cx="45" cy="70" rx="10" ry="20" class="muscle-path" onclick="Actions.selectMuscle('biceps')"></ellipse><ellipse cx="155" cy="70" rx="10" ry="20" class="muscle-path" onclick="Actions.selectMuscle('biceps')"></ellipse><path d="M85,155 L115,155 L100,180 Z" fill="#ff003c" opacity="0.5" onclick="Actions.selectMuscle('pelvic')" class="cursor-pointer hover:opacity-100"></path>`,
                    back: `<path d="M70,40 L100,20 L130,40 L100,60 Z" class="muscle-path" onclick="Actions.selectMuscle('traps')"></path><path d="M60,60 L40,100 L100,130 L160,100 L140,60 L100,60 Z" class="muscle-path" onclick="Actions.selectMuscle('lats')"></path><rect x="85" y="130" width="30" height="20" class="muscle-path" onclick="Actions.selectMuscle('lowerback')"></rect><path d="M70,150 Q100,170 130,150 L130,190 Q100,210 70,190 Z" class="muscle-path" onclick="Actions.selectMuscle('glutes')"></path><rect x="75" y="200" width="20" height="60" class="muscle-path" onclick="Actions.selectMuscle('hamstrings')"></rect><rect x="105" y="200" width="20" height="60" class="muscle-path" onclick="Actions.selectMuscle('hamstrings')"></rect>`
                };
                const sel = Store.state.selectedMuscle ? DB.ANATOMY_DB[Store.state.selectedMuscle] : null;
                return `<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-slide-up h-full"><div class="${THEME.card} flex flex-col items-center justify-center anatomy-grid min-h-[400px] relative"><div class="absolute top-4 left-4 flex gap-2"><button onclick="Actions.setAnatomyView('front')" class="px-3 py-1 text-xs border ${view === 'front' ? 'border-neon-green text-neon-green' : 'border-gray-700 text-gray-500'} rounded">ÖN</button><button onclick="Actions.setAnatomyView('back')" class="px-3 py-1 text-xs border ${view === 'back' ? 'border-neon-green text-neon-green' : 'border-gray-700 text-gray-500'} rounded">ARKA</button></div><div class="relative w-64 h-96"><svg viewBox="0 0 200 300" class="w-full h-full drop-shadow-[0_0_15px_rgba(0,255,65,0.1)]"><path d="M100,20 L120,25 L130,40 L160,45 L150,100 L160,150 L140,280 L130,290 L100,250 L70,290 L60,280 L40,150 L50,100 L40,45 L70,40 L80,25 Z" fill="#111" stroke="#333" stroke-width="2"/>${paths[view]}</svg></div></div><div class="${THEME.card} relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-1 bg-neon-blue"></div><div class="text-[10px] text-neon-blue font-bold mb-4 tracking-widest">DIAGNOSTIC PANEL</div>${sel ? `<div><h2 class="text-2xl font-header font-bold text-white mb-1">${sel.name}</h2><div class="text-xs text-gray-400 mb-6 font-mono">// ${sel.system}</div><div class="space-y-4"><div class="bg-gray-900 p-3 rounded border-l-2 border-neon-green"><div class="text-[9px] text-gray-500 font-bold mb-1">GÖREV</div><div class="text-sm text-gray-200">${sel.function}</div></div><div class="bg-gray-900 p-3 rounded border-l-2 border-neon-orange"><div class="text-[9px] text-gray-500 font-bold mb-1">HARDENING</div><div class="text-sm text-neon-orange font-bold">${sel.action}</div></div><div class="bg-gray-900 p-2 rounded border border-gray-800"><div class="text-[9px] text-gray-500">RECOVERY</div><div class="text-neon-blue">${sel.recovery}</div></div></div></div>` : '<div class="h-full flex flex-col items-center justify-center text-gray-600 opacity-50"><i class="fas fa-fingerprint text-4xl mb-4"></i><p class="text-xs">SEÇİM BEKLENİYOR...</p></div>'}</div></div>`;
            },
            async mental() {
                const phases = DB.MENTAL_PHASES.map(p => `
                    <details class="group bg-gray-900/40 border border-gray-800 hover:border-neon-purple/80 rounded-lg p-4 transition-all mb-3">
                        <summary class="flex items-center justify-between cursor-pointer list-none">
                            <div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center text-xs font-bold text-gray-500 group-hover:text-neon-purple border border-gray-700 group-hover:border-neon-purple transition">${p.id}</div><div><div class="font-bold text-gray-200 group-hover:text-white transition text-sm">${p.title}</div><div class="text-[10px] text-gray-500 group-hover:text-gray-400 transition mt-1">${p.desc}</div></div></div><i class="fas fa-chevron-down text-gray-700 group-open:rotate-180 group-open:text-neon-purple transition-transform"></i>
                        </summary>
                        <div class="mt-4 pt-4 border-t border-gray-800 text-xs text-gray-300 space-y-4">
                            <div><div class="text-[9px] text-gray-500 font-bold mb-1">ÇEKİRDEK FİKİR</div><p>${p.core}</p></div>
                            <div><div class="text-[9px] text-gray-500 font-bold mb-1">NİYET / AMAÇ</div><p>${p.intent}</p></div>
                            <div><div class="text-[9px] text-gray-500 font-bold mb-1">STRATEJİ</div><ul class="space-y-1">${p.strategy.map(s => `<li class="flex gap-2"><i class="fas fa-caret-right text-neon-purple"></i><span>${s}</span></li>`).join('')}</ul></div>
                            <div><div class="text-[9px] text-gray-500 font-bold mb-1">PRATİK</div><ul class="space-y-1">${p.practice.map(s => `<li class="flex gap-2"><i class="fas fa-bolt text-neon-green"></i><span>${s}</span></li>`).join('')}</ul></div>
                            <div class="flex justify-end"><button onclick="Actions.showPhase(${p.id})" class="text-[10px] px-3 py-1 border border-gray-700 hover:border-neon-purple rounded-full text-gray-500 hover:text-neon-purple font-mono transition">MODAL AÇ</button></div>
                        </div>
                    </details>
                `).join('');
                return `<div class="animate-slide-up"><div class="flex items-center gap-3 mb-4 border-b border-gray-800 pb-3"><i class="fas fa-brain text-neon-purple text-xl"></i><div><h2 class="font-header font-bold text-white">ZİHİNSEL SAVAŞ</h2><div class="text-[10px] text-gray-500 mt-1">Mental Hardening Protokolü v5.6.1</div></div></div>${phases}</div>`;
            }
        };

        // --- ACTIONS ---
        const Actions = {
            async switchTab(id) {
                Store.state.activeTab = id;
                UI.updateTab(id);
                document.getElementById('view-container').innerHTML = await Renderers[id]();
                if (id === 'nutrition') {
                    // Nutrition specific listeners could go here
                }
            },
            async saveWeight(v) { const num = parseFloat(v); if (isNaN(num) || num <= 0 || num > 300) { UI.showToast("Geçersiz kilo!", "error"); return; } if (await Store.saveWeight(num)) { UI.showToast("Kilo güncellendi."); this.switchTab('dashboard'); } },
            async injectFuel() { await Store.saveFuel(); UI.showToast("Yakıt alındı."); this.switchTab('dashboard'); },
            async toggleTask(id) { await Store.toggleTask(id); this.switchTab('training'); },
            // ROBOT MODE (EMOTION OVERRIDE) SYSTEM
            overrideState: { active: false, startTime: null, timerInterval: null },

            async toggleOverride() {
                if (this.overrideState.active) {
                    this.exitOverride();
                    return;
                }

                // ACTIVATE ROBOT MODE
                this.overrideState.active = true;
                this.overrideState.startTime = Date.now();
                document.body.classList.add('override-mode');

                const btn = document.getElementById('btn-override');
                btn.innerHTML = '<i class="fas fa-skull mr-1"></i> ROBOT MODE';
                btn.classList.add('bg-red-900', 'animate-pulse');

                // Start timer
                this.overrideState.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.overrideState.startTime) / 1000);
                    const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const secs = (elapsed % 60).toString().padStart(2, '0');
                    document.getElementById('override-timer').textContent = `${mins}:${secs}`;
                }, 1000);

                // Generate mission based on incomplete tasks
                const mission = await this.generateOverrideMission();
                document.getElementById('override-mission').textContent = mission;

                // Show brutal command
                const commands = [
                    "DUYGULAR ÖNEMSİZ. GÖREV KUTSAL.",
                    "CANIM İSTEMİYOR DEME. YAP.",
                    "AKSAK AYAKLA YÜRÜ, AMA YÜRÜ.",
                    "ŞİMDİ YAPMAZSAN KİM YAPACAK?",
                    "BU SENİN SEÇİMİN. ROBOT GİBİ ÇALIŞ."
                ];
                UI.showToast(commands[Math.floor(Math.random() * commands.length)], "warning");

                // Lock to current tab or training
                const currentTab = Store.state.activeTab || 'training';
                this.switchTab(currentTab);

                // ESC key listener
                document.addEventListener('keydown', this.handleOverrideEsc);
            },

            handleOverrideEsc(e) {
                if (e.key === 'Escape' && Actions.overrideState.active) {
                    Actions.exitOverride();
                }
            },

            exitOverride() {
                this.overrideState.active = false;
                document.body.classList.remove('override-mode');

                const btn = document.getElementById('btn-override');
                btn.innerHTML = '<i class="fas fa-power-off mr-1"></i> EMOTION OVERRIDE';
                btn.classList.remove('bg-red-900', 'animate-pulse');

                if (this.overrideState.timerInterval) {
                    clearInterval(this.overrideState.timerInterval);
                }

                const elapsed = Math.floor((Date.now() - this.overrideState.startTime) / 1000);
                const mins = Math.floor(elapsed / 60);
                UI.showToast(`Robot Modu: ${mins} dakika odaklandın.`);

                document.removeEventListener('keydown', this.handleOverrideEsc);
            },

            async generateOverrideMission() {
                const today = Utils.dateStr();
                const workout = await Store.getWorkout(today);
                const meals = await Store.getMeals(today);
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];

                const incompleteTasks = plan.tasks.filter(t => !workout.includes(t)).length;
                const totalCal = meals.reduce((sum, m) => sum + m.cal, 0);
                const calDeficit = CONFIG.TARGETS.CAL - totalCal;

                if (incompleteTasks > 0) {
                    return `GÖREV: ${incompleteTasks} ANTRENMAN KALDI`;
                } else if (calDeficit > 500) {
                    return `GÖREV: ${calDeficit} KALORİ EKSİK`;
                } else if (calDeficit > 0) {
                    return `GÖREV: ${calDeficit} KAL EKSİK - BİTİRE GEL`;
                } else {
                    return "TÜM GÖREVLER TAMAM. KAZANDIN.";
                }
            },
            async rerollPlan() {
                await Store.generateDailyPlan();
                UI.showToast("Günlük menü yenilendi.");
                this.switchTab('nutrition');
            },
            async deleteMeal(index) {
                if (await Store.deleteMeal(index)) {
                    UI.showToast("Öğün silindi.");
                    this.switchTab('nutrition');
                }
            },
            openMealModal() {
                const foods = Store.getAllFoods();
                UI.modal.open("YAKIT EKLE", `
                    <div class="flex gap-2 mb-4 border-b border-gray-800 pb-2">
                        <button onclick="document.getElementById('tab-exist').style.display='block';document.getElementById('tab-new').style.display='none'" class="text-xs text-neon-green font-bold hover:underline">LİSTEDEN SEÇ</button>
                        <button onclick="document.getElementById('tab-exist').style.display='none';document.getElementById('tab-new').style.display='block'" class="text-xs text-gray-500 font-bold hover:text-white hover:underline">YENİ TANIMLA</button>
                    </div>
                    <div id="tab-exist">
                        <div class="space-y-4">
                            <div>
                                <input type="text" id="food-search" placeholder="Besin Ara (örn: Döner, Pilav)" class="${THEME.input} mb-2 border-neon-blue/30 text-sm" onkeyup="UI.filterFoodList()">
                                <select id="m-food" class="${THEME.input} custom-scrollbar" onchange="UI.renderPortionInputs()" size="5">
                                    ${foods.map((f, i) => `<option value="${i}">${f.name}</option>`).join('')}
                                </select>
                            </div>
                            <div id="portion-container">
                                <!-- Dynamic Inputs Here -->
                            </div>
                            <button onclick="Actions.submitMeal()" class="${THEME.btn} w-full mt-2">EKLE</button>
                        </div>
                    </div>
                    <div id="tab-new" style="display:none">
                        <div class="space-y-3">
                            <input type="text" id="new-name" placeholder="Besin Adı (Örn: Çiğ Köfte)" class="${THEME.input}">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="new-cal" placeholder="Kalori (100g veya Adet)" class="${THEME.input}">
                                <input type="number" id="new-prot" placeholder="Protein" class="${THEME.input}">
                                <input type="number" id="new-carb" placeholder="Karbonhidrat" class="${THEME.input}">
                                <input type="number" id="new-fat" placeholder="Yağ" class="${THEME.input}">
                            </div>
                             <div>
                                <label class="text-[10px] text-gray-500 font-bold block mb-1">BİRİM TÜRÜ</label>
                                <select id="new-unit" class="${THEME.input}">
                                    <option value="gr">Gram (100g üzerinden)</option>
                                    <option value="ad">Adet/Porsiyon</option>
                                </select>
                            </div>
                            <button onclick="Actions.createCustomFood()" class="${THEME.btn} w-full border-neon-blue text-neon-blue hover:bg-neon-blue hover:text-black">VERİTABANINA KAYDET</button>
                        </div>
                    </div>
                `);
                // Trigger initial render for first item
                setTimeout(() => {
                    const select = document.getElementById('m-food');
                    if (select && select.options.length > 0) {
                        select.selectedIndex = 0; // Force selection
                        UI.renderPortionInputs();
                    }
                }, 100);
            },
            async submitMeal() {
                const idx = document.getElementById('m-food').value;
                const f = Store.getAllFoods()[idx];
                let amt = 0;
                let ratio = 0;
                let unitLabel = "";

                // Logic Branching for Portion vs Piece vs Legacy Grams
                if (f.type === 'portion') {
                    // Get selected radio
                    const radios = document.getElementsByName('portion_opt');
                    let selectedOptIdx = 0;
                    for (const r of radios) { if (r.checked) { selectedOptIdx = parseInt(r.value); break; } }

                    const opt = f.options[selectedOptIdx];
                    ratio = opt.ratio; // Multiplier of base 100g values
                    amt = 1; // Logically 1 portion
                    unitLabel = opt.label;

                } else if (f.type === 'piece') {
                    // Standard Piece logic
                    amt = parseFloat(document.getElementById('m-amount').value);
                    if (!amt) return;
                    ratio = amt; // 1 banana * 1
                    unitLabel = f.unitName || 'Adet';

                } else {
                    // Legacy/Custom Grams logic (Default)
                    amt = parseFloat(document.getElementById('m-amount').value);
                    if (!amt) return;
                    // If custom food was saved with 'ad' unit, ratio is amt. If 'gr', ratio is amt/100.
                    // Current custom food logic saves 'unit' property.
                    if (f.unit === 'ad') {
                        ratio = amt;
                        unitLabel = 'Adet';
                    } else {
                        ratio = amt / 100;
                        unitLabel = 'Gr';
                    }
                }

                await Store.addMeal({
                    name: f.name,
                    amount: amt,
                    unit: f.type || 'custom', // Storing type for reference
                    portionLabel: unitLabel, // For display
                    cal: Math.round(f.vals.cal * ratio),
                    prot: Math.round(f.vals.prot * ratio),
                    carb: Math.round(f.vals.carb * ratio),
                    fat: Math.round(f.vals.fat * ratio)
                });

                UI.modal.close();
                UI.showToast("Öğün eklendi.");
                this.switchTab('nutrition');
            },
            async createCustomFood() {
                const n = document.getElementById('new-name').value;
                const c = parseFloat(document.getElementById('new-cal').value);
                const p = parseFloat(document.getElementById('new-prot').value);
                const carb = parseFloat(document.getElementById('new-carb').value);
                const f = parseFloat(document.getElementById('new-fat').value);
                const u = document.getElementById('new-unit').value;

                if (!n || !c) { UI.showToast("Eksik bilgi!", "error"); return; }

                // Custom foods use 'vals' structure now to match new DB schema
                await Store.addCustomFood({
                    name: n,
                    type: 'custom', // Custom types handled by unit
                    unit: u,
                    vals: {
                        cal: c,
                        prot: p || 0,
                        carb: carb || 0,
                        fat: f || 0
                    }
                });

                UI.modal.close();
                UI.showToast("Veritabanı güncellendi.");
                setTimeout(() => this.openMealModal(), 500);
            },
            async saveStats() {
                await Store.saveStats({
                    chest: document.getElementById('stat-chest').value,
                    arm: document.getElementById('stat-arm').value,
                    waist: document.getElementById('stat-waist').value,
                    leg: document.getElementById('stat-leg').value
                });
                UI.showToast("Ölçüler kaydedildi.");
            },
            showExercise(id) {
                const ex = DB.EXERCISES[id];
                UI.modal.open(ex.title, `<div class="text-sm text-gray-300 mb-4">${ex.desc}</div><div class="bg-gray-900 p-4 rounded border border-gray-700"><div class="text-[10px] text-gray-500 font-bold mb-2">OPERASYON ADIMLARI</div><ul class="space-y-2 text-xs">${ex.steps.map(s => `<li class="flex gap-2"><i class="fas fa-caret-right text-neon-green"></i>${s}</li>`).join('')}</ul></div>`);
            },
            showPhase(id) {
                const p = DB.MENTAL_PHASES.find(x => x.id == id);
                UI.modal.open(p.title, `<div class="space-y-4 text-sm text-gray-300"><div class="bg-gray-900 p-3 rounded border border-gray-800"><div class="text-[9px] text-gray-500 font-bold mb-1">ÖZET</div><p>${p.desc}</p></div><div class="bg-gray-900 p-3 rounded border border-gray-800"><div class="text-[9px] text-gray-500 font-bold mb-1">ÇEKİRDEK</div><p>${p.core}</p></div><div class="grid grid-cols-2 gap-2"><div class="bg-gray-900 p-3 rounded"><div class="text-[9px] text-gray-500 font-bold mb-1">STRATEJİ</div><ul class="space-y-1 text-xs">${p.strategy.map(s => `<li>- ${s}</li>`).join('')}</ul></div><div class="bg-gray-900 p-3 rounded"><div class="text-[9px] text-gray-500 font-bold mb-1">PRATİK</div><ul class="space-y-1 text-xs">${p.practice.map(s => `<li>- ${s}</li>`).join('')}</ul></div></div></div>`);
            },
            setAnatomyView(v) { UI.activeView = v; Store.state.selectedMuscle = null; this.switchTab('anatomy'); },
            selectMuscle(id) { Store.state.selectedMuscle = id; this.switchTab('anatomy'); },

            // --- ALERT SYSTEM ---
            async checkSystemAlerts() {
                const shakeDone = Store.state.fuelDate === Utils.dateStr();
                const meals = await Store.getMeals(Utils.dateStr()) || [];
                let alertMsg = "";

                if (!shakeDone) {
                    alertMsg += "<div class='mb-4'><span class='text-neon-yellow font-bold'>⚠️ KRİTİK UYARI:</span><br>Günlük Gainer Shake henüz sisteme girilmedi! Yakıt seviyesi kritik.</div>";
                }

                if (meals.length === 0) {
                    alertMsg += "<div><span class='text-neon-red font-bold'>⚠️ BESLENME HATASI:</span><br>Bugün hiçbir öğün kaydı yapılmadı. Sistem aç çalışamaz!</div>";
                }

                if (alertMsg !== "") {
                    UI.alert.show(alertMsg);
                    const nutBtn = document.getElementById('badge-nutrition');
                    if (nutBtn && meals.length === 0) nutBtn.classList.remove('hidden');
                }
            },

            openWarmup() {
                const warmupRoutine = `
                    <div class="space-y-4 text-sm text-gray-300">
                        <div class="bg-gray-900 p-3 rounded border border-neon-blue">
                            <h4 class="text-neon-blue font-bold mb-2">SİSTEM BAŞLATILIYOR (ISINMA)</h4>
                            <p class="text-xs text-gray-400 mb-3">Motor soğukken gazlama. Sakatlanmamak için bu 3 dakikalık rutini her antrenmandan önce yap.</p>
                            
                            <ul class="space-y-2">
                                <li class="flex gap-3 items-center">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Boyun Çevirme</span>
                                        <div class="text-[10px] text-gray-500">Sağa, sola, öne, arkaya yavaşça (30sn)</div>
                                    </div>
                                </li>
                                <li class="flex gap-3 items-center">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Kol Çevirme</span>
                                        <div class="text-[10px] text-gray-500">Kollarını pervane gibi öne ve arkaya çevir (30sn)</div>
                                    </div>
                                </li>
                                <li class="flex gap-3 items-center">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Bel Dairesi</span>
                                        <div class="text-[10px] text-gray-500">Eller belde, geniş daireler çiz (30sn)</div>
                                    </div>
                                </li>
                                <li class="flex gap-3 items-center">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Hafif Koşu</span>
                                        <div class="text-[10px] text-gray-500">Olduğun yerde sekerek nabzını yükselt (1dk)</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="text-center">
                            <button onclick="UI.modal.close()" class="${THEME.btn} w-full border-neon-green text-neon-green hover:bg-neon-green hover:text-black">HAZIRIM, BAŞLAT</button>
                        </div>
                    </div>
                `;
                UI.modal.open("SYSTEM BOOT (ISINMA)", warmupRoutine);
            }
        };

        // --- BOOT ---
        (async function () {
            console.log("SYSTEM BOOT...");
            await Store.init();
            UI.init();
        })();
    </script>
</body>

</html>