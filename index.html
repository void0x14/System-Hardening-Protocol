<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROJECT: MONK MODE | v5.9.0 (Premium)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700;800&family=Orbitron:wght@500;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gunmetal': '#0a0a0f',
                        'surface-card': '#111116',
                        'surface-raised': '#1a1a22',
                        'surface-hover': '#222230',
                        'neon-green': '#00ff41',
                        'neon-red': '#ff003c',
                        'accent-orange': '#ff6b35',
                        'text-muted': '#6b7280',
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        header: ['"Orbitron"', 'sans-serif'],
                    },
                    animation: {
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'scan': 'scan 2s linear infinite',
                        'pulse-urgent': 'pulseUrgent 1.5s infinite',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scan: {
                            '0%': { backgroundPosition: '0% 0%' },
                            '100%': { backgroundPosition: '0% 100%' }
                        },
                        pulseUrgent: {
                            '0%, 100%': { borderColor: '#ff003c', boxShadow: '0 0 5px #ff003c' },
                            '50%': { borderColor: 'transparent', boxShadow: 'none' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0a0a0f;
            color: #e5e7eb;
            overflow-x: hidden;
            font-size: 15px;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00ff41;
        }

        .cyber-border:hover {
            border-color: #00ff41;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
        }

        .custom-checkbox {
            appearance: none;
            width: 1.2em;
            height: 1.2em;
            border: 2px solid #444;
            background: #111;
            cursor: pointer;
            display: grid;
            place-content: center;
            transition: 0.2s;
        }

        .custom-checkbox::before {
            content: "";
            width: 0.6em;
            height: 0.6em;
            transform: scale(0);
            background: #00ff41;
            transition: 0.2s transform ease-in-out;
        }

        .custom-checkbox:checked {
            border-color: #00ff41;
        }

        .custom-checkbox:checked::before {
            transform: scale(1);
        }

        body.override-mode {
            filter: grayscale(80%) contrast(1.1);
        }

        body.override-mode * {
            animation-play-state: paused !important;
            transition: none !important;
        }

        body.override-mode .tab-btn:not(.active-override-tab) {
            opacity: 0.3;
            pointer-events: none;
        }

        body.override-mode .override-hide {
            display: none !important;
        }

        body.override-mode .override-highlight {
            border-color: #ff003c !important;
            box-shadow: 0 0 10px rgba(255, 0, 60, 0.5) !important;
        }

        #override-panel {
            display: none;
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 0, 0, 0.95);
            border: 2px solid #ff003c;
            padding: 1rem 2rem;
            z-index: 100;
            text-align: center;
            border-radius: 8px;
        }

        body.override-mode #override-panel {
            display: block;
        }

        #override-timer {
            font-size: 2rem;
            font-weight: bold;
            color: #ff003c;
            font-family: 'JetBrains Mono', monospace;
        }

        #override-mission {
            color: #fff;
            font-size: 0.75rem;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem;
            border-left: 4px solid;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(4px);
            z-index: 100;
            animation: slideUp 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal {
            transition: opacity 0.2s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .muscle-path {
            fill: #1a1a1a;
            stroke: #333;
            stroke-width: 1;
            transition: all 0.3s;
            cursor: pointer;
        }

        .muscle-path:hover {
            fill: #00ff41;
            stroke: #fff;
        }

        .muscle-path.active {
            fill: #00f3ff;
            stroke: #fff;
            filter: drop-shadow(0 0 5px rgba(0, 243, 255, 0.5));
        }

        .anatomy-grid {
            background-image: linear-gradient(rgba(0, 255, 65, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 65, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .alert-overlay {
            background: rgba(255, 0, 60, 0.1);
            border: 1px solid #ff003c;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background-color: #ff003c;
            border-radius: 50%;
            box-shadow: 0 0 5px #ff003c;
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes ping {

            75%,
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Radio Button Styling for Portions */
        .portion-radio:checked+div {
            background-color: rgba(0, 255, 65, 0.1);
            border-color: #00ff41;
            color: #fff;
        }

        .portion-radio:checked+div .radio-dot {
            background-color: #00ff41;
            box-shadow: 0 0 8px #00ff41;
        }

        /* Custom Scrollbar for containers */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 2px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #00ff41;
        }

        /* ============================================
           PHASE 1: PREMIUM UI ENHANCEMENTS
           Estetik: EndÃ¼striyel/Taktiksel Premium
           ============================================ */

        /* Typography Enhancement */
        body {
            font-family: 'Inter', 'JetBrains Mono', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            letter-spacing: 0.01em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .font-mono,
        code,
        pre,
        input[type="number"] {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            letter-spacing: -0.02em;
        }

        /* Smooth Global Transitions */
        *,
        *::before,
        *::after {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Card Hover Lift Effect */
        .card-hover-lift {
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
        }

        .card-hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4), 0 0 1px rgba(0, 255, 65, 0.1);
        }

        /* Progress Bar Shimmer */
        .progress-shimmer {
            position: relative;
            overflow: hidden;
        }

        .progress-shimmer::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.15) 50%,
                    transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        /* Enhanced Checkbox Bounce */
        .custom-checkbox {
            transition: transform 0.15s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .custom-checkbox:hover {
            border-color: #00ff41;
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.2);
        }

        .custom-checkbox:checked {
            animation: checkBounce 0.25s ease-out;
        }

        @keyframes checkBounce {
            0% {
                transform: scale(1);
            }

            40% {
                transform: scale(1.15);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Tab Navigation Underline */
        .tab-btn {
            position: relative;
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #00ff41;
            transition: width 0.25s ease, left 0.25s ease;
        }

        .tab-btn:hover::after,
        .tab-btn.active-tab::after {
            width: 100%;
            left: 0;
        }

        .tab-btn:hover i,
        .tab-btn.active-tab i {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }

        /* Button Press Feedback */
        button,
        .btn-press {
            transition: transform 0.1s ease, background-color 0.2s ease, border-color 0.2s ease;
        }

        button:active,
        .btn-press:active {
            transform: scale(0.97);
        }

        /* Input Focus Glow */
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #00ff41 !important;
            box-shadow: 0 0 0 2px rgba(0, 255, 65, 0.15), 0 0 12px rgba(0, 255, 65, 0.1);
        }

        /* Toast Slide-In Animation */
        .toast {
            animation: toastSlideIn 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes toastSlideIn {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }

            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Modal Scale-In Animation */
        .modal.active .modal-content {
            animation: modalScaleIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalScaleIn {
            0% {
                transform: scale(0.95);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* View Container Smooth Transition */
        #view-container {
            transition: opacity 0.15s ease;
        }

        /* ============================================
           PHASE 3: VISUAL POLISH
           ============================================ */

        /* Exercise Card Hover */
        .exercise-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .exercise-card:hover {
            background: rgba(0, 255, 65, 0.03);
            border-color: rgba(0, 255, 65, 0.3) !important;
            transform: translateX(4px);
        }

        .exercise-card:hover i {
            color: #00ff41;
        }

        /* Meal Item Hover */
        .meal-item {
            transition: all 0.2s ease;
        }

        .meal-item:hover {
            background: rgba(0, 255, 65, 0.05);
            transform: translateX(3px);
        }

        /* Details/Summary Smooth Open */
        details {
            transition: all 0.25s ease;
        }

        details summary {
            cursor: pointer;
        }

        details[open] summary~* {
            animation: detailsOpen 0.25s ease-out;
        }

        @keyframes detailsOpen {
            0% {
                opacity: 0;
                transform: translateY(-8px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Touch Feedback */
        @media (hover: none) {
            .card-hover-lift:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }

            .exercise-card:active {
                background: rgba(0, 255, 65, 0.08);
                transform: scale(0.99);
            }

            .meal-item:active {
                background: rgba(0, 255, 65, 0.08);
            }

            button:active {
                transform: scale(0.95);
            }

            .tab-btn:active {
                background: rgba(0, 255, 65, 0.1);
            }
        }

        /* Scrollbar animation on scroll */
        .custom-scrollbar {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body class="text-base">

    <!-- NAV -->
    <nav class="fixed top-0 w-full bg-gunmetal/80 backdrop-blur-md z-40 border-b border-white/5 h-20">
        <div class="container mx-auto h-full px-6 flex justify-between items-center max-w-7xl">
            <div class="flex items-center gap-4">
                <i class="fas fa-biohazard text-neon-green text-2xl"></i>
                <div>
                    <h1 class="font-header font-bold text-white tracking-wider text-lg md:text-xl">PROTOCOL <span
                            class="text-sm text-text-muted">v5.9.0</span></h1>
                    <div class="text-[10px] text-neon-green font-bold tracking-[0.2em] uppercase">FIELD TEST APPROVED
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <div id="clock-display" class="hidden md:block font-mono text-text-muted font-bold text-sm">--:--:--
                </div>
                <button onclick="Actions.openSettings()" id="btn-settings"
                    class="bg-gray-800 text-gray-400 px-3 py-2 rounded-lg hover:bg-gray-700 hover:text-white transition">
                    <i class="fas fa-cog"></i>
                </button>
                <button onclick="Actions.toggleOverride()" id="btn-override"
                    class="bg-neon-red/10 text-neon-red px-4 py-2 rounded-lg hover:bg-neon-red hover:text-white transition text-xs font-bold tracking-widest">
                    <i class="fas fa-power-off mr-2"></i> OVERRIDE
                </button>
            </div>
        </div>
    </nav>

    <!-- MAIN -->
    <main class="container mx-auto mt-24 px-6 pb-24 max-w-7xl">
        <div class="flex justify-center overflow-x-auto mb-8 gap-3 border-b border-white/5 pb-2 scrollbar-hide"
            id="nav-tabs"></div>
        <div id="view-container" class="min-h-[60vh] animate-slide-up"></div>
    </main>

    <!-- MODAL -->
    <div id="universal-modal"
        class="modal fixed inset-0 z-50 flex items-center justify-center p-6 bg-gunmetal/90 backdrop-blur-md">
        <div
            class="modal-content bg-surface-card w-full max-w-2xl rounded-2xl shadow-2xl relative max-h-[85vh] flex flex-col">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <h3 id="modal-title" class="font-header text-xl font-bold text-neon-green">INFO</h3>
                <button onclick="UI.modal.close()" class="text-text-muted hover:text-white transition p-2"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div id="modal-body" class="p-8 overflow-y-auto custom-scrollbar"></div>
        </div>
    </div>

    <!-- ALERT MODAL -->
    <div id="alert-modal"
        class="modal fixed inset-0 z-[60] flex items-center justify-center p-6 bg-gunmetal/95 backdrop-blur-lg">
        <div
            class="modal-content bg-surface-card border border-neon-red/30 w-full max-w-md rounded-2xl shadow-[0_0_60px_rgba(255,0,60,0.2)] relative p-8 text-center">
            <i class="fas fa-exclamation-triangle text-6xl text-neon-red mb-6"></i>
            <h2 class="text-3xl font-header font-bold text-white mb-3">SÄ°STEM UYARISI</h2>
            <p id="alert-message" class="text-gray-300 mb-8 text-base leading-relaxed"></p>
            <button onclick="UI.alert.close()"
                class="bg-neon-red text-white font-bold py-4 px-8 rounded-xl hover:bg-white hover:text-neon-red transition w-full text-lg">ANLAÅILDI
                KOMUTANIM</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <!-- OVERRIDE PANEL (Robot Mode) -->
    <div id="override-panel">
        <div id="override-timer">00:00</div>
        <div id="override-mission">GÃ–REV: TAMAMLANMAMIÅ Ä°ÅLER</div>
        <button onclick="Actions.exitOverride()"
            class="mt-3 text-xs text-gray-500 hover:text-white border border-gray-700 px-3 py-1 rounded">Ã‡IKIÅ
            (ESC)</button>
    </div>

    <script>
        // --- CONFIG & DATA ---
        const CONFIG = {
            VERSION: '5.9.0 Premium',
            KEYS: {
                WEIGHT: 'monk_weight',
                FUEL: 'monk_fuel_date',
                WORKOUT: 'monk_workout_log_',
                MEAL: 'monk_meal_log_',
                MEASURE: 'monk_body_stats',
                WEIGHT_HISTORY: 'monk_weight_history',
                CUSTOM_FOODS: 'monk_custom_foods',
                DAILY_PLAN: 'monk_daily_plan',
                STREAK: 'monk_streak_data',
                BACKUP: 'monk_last_backup_date',
                SLEEP: 'monk_sleep_log_',
                WATER: 'monk_water_',
                EXERCISE_HISTORY: 'monk_exercise_history',
                MENTAL_PROGRESS: 'monk_mental_progress'
            },
            TARGETS: { START: 45.0, GOAL: 60.0, CAL: 3000, PROT: 225, CARB: 375, FAT: 67, WATER: 8, SLEEP: 7.5 },
            MILESTONES: [
                { weight: 48, title: "BaÅŸlangÄ±Ã§ +3kg", icon: "ğŸŒ±" },
                { weight: 50, title: "YarÄ±m YÃ¼zlÃ¼k", icon: "âš¡" },
                { weight: 55, title: "YarÄ± Yol", icon: "ğŸ”¥" },
                { weight: 60, title: "HEDEF", icon: "ğŸ†" }
            ]
        };

        const THEME = {
            card: "bg-surface-card rounded-xl p-6 md:p-8 shadow-2xl transition-all card-hover-lift",
            btn: "bg-surface-raised hover:bg-neon-green hover:text-gunmetal text-white font-bold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2",
            input: "bg-surface-raised border-0 text-white rounded-lg p-3 focus:ring-2 focus:ring-neon-green/30 outline-none w-full transition-all",
            label: "text-xs uppercase tracking-[0.2em] text-text-muted font-bold mb-3 block"
        };

        const DB = {
            WEEKLY_PLAN: {
                1: { name: "PAZARTESÄ°", title: "FULL BODY START", tasks: ["squat", "pushup", "one_arm_row", "plank"] },
                2: { name: "SALI", title: "BESLENME & RECOVERY", tasks: ["eat_bulk", "stretch", "farmers_walk"] },
                3: { name: "Ã‡ARÅAMBA", title: "CORE & KERNEL", tasks: ["lying_leg_raise", "mountain_climber", "stomach_vacuum", "kegel", "bottle_curl"] },
                4: { name: "PERÅEMBE", title: "LEG DAY", tasks: ["squat_heavy", "single_leg_raise", "stretch"] },
                5: { name: "CUMA", title: "STRESS TEST", tasks: ["goblet_squat", "one_arm_row", "pushup", "hammer_curl"] },
                6: { name: "CUMARTESÄ°", title: "ACTIVE REST", tasks: ["stomach_vacuum", "farmers_walk", "cool_down", "walk_outside"] },
                0: { name: "PAZAR", title: "SYSTEM REBOOT", tasks: ["weigh_in", "prep_food"] }
            },
            EXERCISES: {
                "stomach_vacuum": {
                    title: "Stomach Vacuum",
                    tags: ["Core", "Ä°Ã§ Korse"],
                    desc: "Sabah aÃ§ karnÄ±na. Nefesinin tamamÄ±nÄ± dÄ±ÅŸarÄ± Ã¼fle. Nefes almadan gÃ¶beÄŸini omurgana yapÄ±ÅŸtÄ±r. 10-15 saniye bekle. Ä°Ã§ korseyi (Transversus Abdominis) sÄ±kÄ±laÅŸtÄ±rÄ±r.<br><br><strong>HEDEF:</strong> 3 Set x 15-20 Saniye Bekle.",
                    steps: ["Nefesi boÅŸalt.", "Vakumla.", "Bekle."]
                },
                "squat": {
                    title: "Squat (Warmup)",
                    tags: ["Bacak", "KalÃ§a"],
                    desc: "Ayaklar omuz geniÅŸliÄŸinde. Ä°nerken 'Sandalyeye oturur gibi' geriye git. Dizlerin iÃ§eri Ã§Ã¶kmesin. Kalkarken TOPUKLARINA bas.<br><br><strong>HEDEF:</strong> 4 Set x 20 Tekrar.",
                    steps: ["Ayaklar omuz geniÅŸliÄŸinde.", "SÄ±rt dik.", "Topuklara bas."]
                },
                "goblet_squat": {
                    title: "Goblet Squat (YÃ¼klÃ¼)",
                    tags: ["Bacak", "GÃ¼Ã§"],
                    desc: "Ayaklar omuz geniÅŸliÄŸinde. AÄŸÄ±rlÄ±ÄŸÄ± gÃ¶ÄŸsÃ¼ne YAPIÅTIR (Goblet). Ä°nerken 'Sandalyeye oturur gibi' geriye git. Dizlerin iÃ§eri Ã§Ã¶kmesin (Valgus Collapse). Kalkarken TOPUKLARINA bas. Titreme baÅŸladÄ±ÄŸÄ±nda durma, orasÄ± geliÅŸim bÃ¶lgesidir.<br><br><strong>HEDEF:</strong> 4 Set x 20 Tekrar.",
                    steps: ["AÄŸÄ±rlÄ±ÄŸÄ± kucakla.", "KalÃ§a geriye.", "Topukla it."]
                },
                "pushup": {
                    title: "Incline/Standard Push-up",
                    tags: ["GÃ¶ÄŸÃ¼s", "PatlayÄ±cÄ± GÃ¼Ã§"],
                    desc: "Eller koltuk/yatak kenarÄ±nda (veya yerde). VÃ¼cut dÃ¼mdÃ¼z (Plank formunda). Ä°nerken 3 saniye (YavaÅŸ/Negatif), kalkarken 1 saniye (PatlayÄ±cÄ±). Bileklerin aÄŸrÄ±yorsa YUMRUK Ã¼stÃ¼nde veya tutamaÃ§la yap. GÃ¶ÄŸsÃ¼nÃ¼ deÄŸdirmeden kalkma.<br><br><strong>HEDEF:</strong> 4 Set x MAKSÄ°MUM Tekrar.",
                    steps: ["VÃ¼cut ok gibi dÃ¼z.", "YavaÅŸ in (3sn).", "PatlayÄ±cÄ± kalk (1sn)."]
                },
                "one_arm_row": {
                    title: "One Arm Row (Tek Kol Ã‡ekiÅŸ)",
                    tags: ["SÄ±rt", "Kanat"],
                    desc: "YataÄŸÄ±n/KoltuÄŸun kenarÄ±na geÃ§. Bir elini ve dizini daya (Masa pozisyonu). DiÄŸer elinle aÄŸÄ±rlÄ±ÄŸÄ± CEBÄ°NE DOÄRU Ã§ek. DirseÄŸin vÃ¼cuduna sÃ¼rterek geriye gitsin. Tepede sÄ±rtÄ±nÄ± sÄ±kÄ±ÅŸtÄ±r.<br><br><strong>HEDEF:</strong> 4 Set x 12 Tekrar (Her Kol).",
                    steps: ["Masa pozisyonu al.", "DirseÄŸi sÃ¼rt.", "Cebine Ã§ek."]
                },
                "plank": {
                    title: "RKC Plank",
                    tags: ["Core", "Stabilizasyon"],
                    desc: "Dirsekler omuz altÄ±nda. Elleri birleÅŸtirme (Yumruk yap). KalÃ§anÄ± sÄ±k (Posterior Tilt), karnÄ±nÄ± iÃ§eri vakumla. Sadece durma, dirseklerini ayaklarÄ±na doÄŸru Ã§ekmeye Ã§alÄ±ÅŸ (RKC Plank). Titreme yoksa verim yoktur.<br><br><strong>HEDEF:</strong> 3 Set x 30-45 Saniye.",
                    steps: ["Dirsekler yerde.", "GÃ¶tÃ¼nÃ¼ sÄ±k.", "Dirsekleri ayaklara Ã§ek."]
                },
                "farmers_walk": {
                    title: "Farmer's Walk",
                    tags: ["Bilek", "PenÃ§e Kuvveti"],
                    desc: "YÃ¼kleri iki eline al. Omuzlar geride, gÃ¶ÄŸÃ¼s ileride. KollarÄ±nÄ± 'Ã–lÃ¼ AÄŸÄ±rlÄ±k' gibi aÅŸaÄŸÄ± sal (Dirsek bÃ¼kme). KÃ¼Ã§Ã¼k ve seri adÄ±mlarla yÃ¼rÃ¼. Bileklerin kopana kadar bÄ±rakma.<br><br><strong>HEDEF:</strong> 3 Tur (Parmaklar aÃ§Ä±lana kadar).",
                    steps: ["Omuzlar geride.", "Kollar kilitli.", "YÃ¼rÃ¼."]
                },
                "hammer_curl": {
                    title: "Hammer Curl",
                    tags: ["Biceps", "Ã–n Kol"],
                    desc: "Ayakta dur. AÄŸÄ±rlÄ±ÄŸÄ± Ã§ekiÃ§ tutar gibi (AvuÃ§ iÃ§i vÃ¼cuda dÃ¶nÃ¼k) kavra. Dirseklerini vÃ¼cuduna YAPIÅTIR ve kilitle. AÄŸÄ±rlÄ±ÄŸÄ± omzuna doÄŸru kaldÄ±r, yavaÅŸÃ§a indir. Sallanma, belden gÃ¼Ã§ alma.<br><br><strong>HEDEF:</strong> 4 Set x 12 Tekrar.",
                    steps: ["Dirsek yapÄ±ÅŸÄ±k.", "Ã‡ekiÃ§ tutuÅŸ.", "YavaÅŸ indir."]
                },
                "kegel": {
                    title: "Kegel",
                    tags: ["Pelvis", "Cinsel GÃ¼Ã§"],
                    desc: "Tuvaletini tutar gibi PC kasÄ±nÄ± sÄ±k. KalÃ§anÄ± veya karnÄ±nÄ± sÄ±kma, sadece o bÃ¶lgeyi izole et. 3 saniye sÄ±k, 3 saniye bÄ±rak. Ereksiyon kalitesini artÄ±rÄ±r.<br><br><strong>HEDEF:</strong> 5 Set x 10 Tekrar.",
                    steps: ["Ä°zole et.", "SÄ±k (3sn).", "BÄ±rak (3sn)."]
                },
                "mountain_climber": {
                    title: "Mountain Climber",
                    tags: ["Kardiyo"],
                    desc: "Yerde koÅŸma.<br><br><strong>HEDEF:</strong> 3 x 45sn.",
                    steps: ["ÅÄ±nav pozisyonu.", "KoÅŸ."]
                },
                "lying_leg_raise": {
                    title: "Lying Leg Raise",
                    tags: ["Alt KarÄ±n", "Core"],
                    desc: "SÄ±rt Ã¼stÃ¼ yat. ELLERÄ°NÄ° KALÃ‡ANIN ALTINA KOY (Mekanik Destek). Belini yere mÃ¼hÃ¼rle (BoÅŸluk kalmasÄ±n). BacaklarÄ± kaldÄ±r, indirirken BELÄ°N KALKMADAN hemen Ã¶nce dur. *Yanma hissi bacakta deÄŸil, alt karÄ±nda olmalÄ±. Belin kalkÄ±yorsa hareket Ã§Ã¶ptÃ¼r.*<br><br><strong>HEDEF:</strong> 4 Set x 12.",
                    steps: ["Eller popo altÄ±.", "Belini bas.", "KontrollÃ¼ indir."]
                },
                "eat_bulk": { title: "BULK YE", tags: ["Yemek"], desc: "Kalori al.", steps: ["Ã–ÄŸÃ¼n atlama."] },
                "stretch": { title: "ESNEME", tags: ["Recovery"], desc: "Rahatla.", steps: ["AÄŸrÄ±yan yeri esnet."] },
                "walk_outside": { title: "YÃœRÃœYÃœÅ", tags: ["Mental"], desc: "Hava al.", steps: ["DÄ±ÅŸarÄ± Ã§Ä±k."] },
                "eat_home": { title: "EV YEMEÄÄ°", tags: ["Beslenme"], desc: "DÄ±ÅŸarÄ±dan yeme.", steps: [] },
                "weigh_in": { title: "TARTIL", tags: ["Analiz"], desc: "AÃ§ karna.", steps: [] },
                "prep_food": { title: "STOK", tags: ["Lojistik"], desc: "Eksikleri al.", steps: [] },
                "single_leg_raise": { title: "Single Leg Raise", tags: ["Alt KarÄ±n"], desc: "Tek tek kaldÄ±r.<br><br><strong>HEDEF:</strong> 4 Set x 12.", steps: ["Tek bacak."] },
                "bottle_curl": { title: "Bottle Curl", tags: ["PazÄ±"], desc: "AÄŸÄ±rlÄ±k ile curl.<br><br><strong>HEDEF:</strong> 4 Set x 12.", steps: ["KaldÄ±r."] },
                "squat_heavy": { title: "Bulgarian Split Squat", tags: ["Bacak"], desc: "AyaÄŸÄ±nÄ± arkadaki koltuÄŸa koy. Tek bacakla Ã§Ã¶k kalk.<br><br><strong>HEDEF:</strong> 4 Set x 12 (Her Bacak).", steps: ["Tek ayak koltukta.", "Dik dur.", "Ã‡Ã¶k."] },
                "cool_down": {
                    title: "Cool Down (SoÄŸuma)",
                    tags: ["Recovery", "Esneklik"],
                    desc: "Serbest Stil Esneme & Rahatlama.<br><br><strong>HEDEF:</strong> 5-10 Dakika.",
                    steps: ["Derin nefes al.", "KaslarÄ±nÄ± uzat.", "GevÅŸe."]
                },
                "superman": {
                    title: "Superman",
                    tags: ["Alt SÄ±rt", "Core"],
                    desc: "YÃ¼zÃ¼stÃ¼ yat. KollarÄ±nÄ± ve bacaklarÄ±nÄ± aynÄ± anda kaldÄ±r. 2-3 saniye tepede tut.<br><br><strong>HEDEF:</strong> 3 Set x 12 Tekrar.",
                    steps: ["YÃ¼zÃ¼stÃ¼ yat.", "Kol ve bacaklarÄ± kaldÄ±r.", "Tepede tut."]
                }
            },
            FOODS: [
                { id: 100, cat: "PROTOKOL", name: "GAINER SHAKE (Bizim Tarif)", type: "piece", vals: { cal: 850, prot: 35, carb: 100, fat: 35 }, unitName: "Adet" },
                { id: 101, cat: "PROTOKOL", name: "ZeytinyaÄŸÄ±", type: "portion", vals: { cal: 884, prot: 0, carb: 0, fat: 100 }, options: [{ label: "1 TatlÄ± KaÅŸÄ±ÄŸÄ±", ratio: 0.05 }, { label: "1 Yemek KaÅŸÄ±ÄŸÄ±", ratio: 0.14 }] },
                { id: 1, cat: "PROTEÄ°N", name: "Tavuk GÃ¶ÄŸsÃ¼ (HaÅŸlama/Izgara)", type: "portion", vals: { cal: 165, prot: 31, carb: 0, fat: 3.6 }, options: [{ label: "KÃ¼Ã§Ã¼k Porsiyon (100g)", ratio: 1 }, { label: "Normal Porsiyon (150g)", ratio: 1.5 }, { label: "Sporcu Porsiyonu (250g)", ratio: 2.5 }] },
                { id: 2, cat: "PROTEÄ°N", name: "Tavuk But (Daha YaÄŸlÄ±)", type: "portion", vals: { cal: 210, prot: 24, carb: 0, fat: 12 }, options: [{ label: "1 Adet But", ratio: 1.5 }, { label: "2 Adet But", ratio: 3 }] },
                { id: 3, cat: "PROTEÄ°N", name: "KÃ¶fte (Ev YapÄ±mÄ±)", type: "piece", vals: { cal: 60, prot: 5, carb: 2, fat: 4 }, unitName: "Adet" },
                { id: 4, cat: "PROTEÄ°N", name: "Ton BalÄ±ÄŸÄ± (YaÄŸlÄ±/SÃ¼zÃ¼lmÃ¼ÅŸ)", type: "portion", vals: { cal: 190, prot: 26, carb: 0, fat: 10 }, options: [{ label: "KÃ¼Ã§Ã¼k Kutu (80g)", ratio: 0.8 }, { label: "BÃ¼yÃ¼k Kutu (160g)", ratio: 1.6 }] },
                { id: 5, cat: "PROTEÄ°N", name: "Yumurta (HaÅŸlanmÄ±ÅŸ)", type: "piece", vals: { cal: 75, prot: 7, carb: 0.6, fat: 5 }, unitName: "Adet" },
                { id: 6, cat: "PROTEÄ°N", name: "Lor Peyniri", type: "portion", vals: { cal: 90, prot: 15, carb: 2, fat: 1 }, options: [{ label: "3-4 KaÅŸÄ±k (100g)", ratio: 1 }, { label: "YarÄ±m Paket (250g)", ratio: 2.5 }] },
                { id: 7, cat: "PROTEÄ°N", name: "KaÅŸar Peyniri", type: "piece", vals: { cal: 70, prot: 5, carb: 0.5, fat: 6 }, unitName: "Dilim" },
                { id: 20, cat: "KARBONHÄ°DRAT", name: "PirinÃ§ PilavÄ±", type: "portion", vals: { cal: 130, prot: 2.7, carb: 28, fat: 0.3 }, options: [{ label: "Az (4-5 KaÅŸÄ±k)", ratio: 1 }, { label: "Tabak (200g)", ratio: 2 }, { label: "Dolu Tabak (300g)", ratio: 3 }] },
                { id: 21, cat: "KARBONHÄ°DRAT", name: "Bulgur PilavÄ±", type: "portion", vals: { cal: 85, prot: 3, carb: 18, fat: 0.2 }, options: [{ label: "Az (4-5 KaÅŸÄ±k)", ratio: 1 }, { label: "Tabak (200g)", ratio: 2 }, { label: "Dolu Tabak (300g)", ratio: 3 }] },
                { id: 22, cat: "KARBONHÄ°DRAT", name: "Makarna (Sade/SalÃ§alÄ±)", type: "portion", vals: { cal: 131, prot: 5, carb: 25, fat: 1 }, options: [{ label: "KÃ¼Ã§Ã¼k Tabak", ratio: 1 }, { label: "Normal Tabak", ratio: 2 }, { label: "Tepeleme Dolu", ratio: 3.5 }, { label: "YarÄ±m Paket (Kuru)", ratio: 9 }] },
                { id: 23, cat: "KARBONHÄ°DRAT", name: "HaÅŸlanmÄ±ÅŸ Patates", type: "piece", vals: { cal: 90, prot: 2, carb: 20, fat: 0.1 }, unitName: "Adet (Orta)" },
                { id: 24, cat: "KARBONHÄ°DRAT", name: "Ekmek (Beyaz/Somun)", type: "portion", vals: { cal: 260, prot: 9, carb: 49, fat: 3 }, options: [{ label: "1 Dilim", ratio: 0.25 }, { label: "Ã‡eyrek Ekmek", ratio: 0.6 }, { label: "YarÄ±m Ekmek", ratio: 1.2 }] },
                { id: 25, cat: "KARBONHÄ°DRAT", name: "LavaÅŸ", type: "piece", vals: { cal: 180, prot: 5, carb: 35, fat: 2 }, unitName: "Adet" },
                { id: 40, cat: "SOKAK", name: "Tavuk DÃ¶ner", type: "portion", vals: { cal: 250, prot: 15, carb: 30, fat: 10 }, options: [{ label: "YarÄ±m Ekmek", ratio: 2 }, { label: "DÃ¼rÃ¼m", ratio: 2.5 }, { label: "Zurna DÃ¼rÃ¼m", ratio: 3.5 }] },
                { id: 41, cat: "SOKAK", name: "Et DÃ¶ner", type: "portion", vals: { cal: 280, prot: 18, carb: 30, fat: 15 }, options: [{ label: "YarÄ±m Ekmek", ratio: 2 }, { label: "DÃ¼rÃ¼m", ratio: 2.5 }, { label: "Porsiyon", ratio: 1.5 }] },
                { id: 42, cat: "SOKAK", name: "Lahmacun", type: "piece", vals: { cal: 180, prot: 10, carb: 25, fat: 5 }, unitName: "Adet" },
                { id: 43, cat: "SOKAK", name: "Ã‡iÄŸ KÃ¶fte", type: "portion", vals: { cal: 250, prot: 5, carb: 40, fat: 10 }, options: [{ label: "DÃ¼rÃ¼m", ratio: 1 }, { label: "Porsiyon (10 SÄ±kÄ±m)", ratio: 1.2 }] },
                { id: 44, cat: "SOKAK", name: "Simit", type: "piece", vals: { cal: 320, prot: 10, carb: 55, fat: 5 }, unitName: "Adet" },
                { id: 45, cat: "SOKAK", name: "KÄ±ymalÄ± Pide", type: "piece", vals: { cal: 500, prot: 20, carb: 60, fat: 20 }, unitName: "Adet (TÃ¼m)" },
                { id: 60, cat: "EV YEMEÄÄ°", name: "Kuru Fasulye / Nohut", type: "portion", vals: { cal: 120, prot: 7, carb: 15, fat: 4 }, options: [{ label: "Az (YarÄ±m Tabak)", ratio: 1 }, { label: "Tam Porsiyon", ratio: 2 }, { label: "Esnaf Porsiyonu (Bol)", ratio: 3 }] },
                { id: 61, cat: "EV YEMEÄÄ°", name: "Taze Fasulye / TÃ¼rlÃ¼", type: "portion", vals: { cal: 70, prot: 2, carb: 8, fat: 4 }, options: [{ label: "Normal Tabak", ratio: 2 }, { label: "Dolu Tabak", ratio: 3 }] },
                { id: 62, cat: "EV YEMEÄÄ°", name: "Mercimek Ã‡orbasÄ±", type: "portion", vals: { cal: 60, prot: 3, carb: 8, fat: 2 }, options: [{ label: "1 Kase", ratio: 2 }, { label: "BÃ¼yÃ¼k Kase", ratio: 3 }] },
                { id: 63, cat: "EV YEMEÄÄ°", name: "Menemen", type: "portion", vals: { cal: 120, prot: 8, carb: 5, fat: 9 }, options: [{ label: "YarÄ±m Tava (Tek KiÅŸilik)", ratio: 2 }, { label: "Tam Tava", ratio: 4 }] },
                { id: 80, cat: "SNACK", name: "Cici Bebe", type: "portion", vals: { cal: 440, prot: 6, carb: 75, fat: 12 }, options: [{ label: "10 Adet", ratio: 0.4 }, { label: "YarÄ±m Paket", ratio: 1 }, { label: "1 Kase SÃ¼tlÃ¼", ratio: 1.5 }] },
                { id: 81, cat: "SNACK", name: "FÄ±stÄ±k Ezmesi", type: "portion", vals: { cal: 590, prot: 25, carb: 20, fat: 50 }, options: [{ label: "1 TatlÄ± KaÅŸÄ±ÄŸÄ±", ratio: 0.1 }, { label: "1 Yemek KaÅŸÄ±ÄŸÄ±", ratio: 0.2 }, { label: "Tepeleme KaÅŸÄ±k", ratio: 0.35 }] },
                { id: 82, cat: "SNACK", name: "Yulaf Ezmesi", type: "portion", vals: { cal: 370, prot: 13, carb: 60, fat: 7 }, options: [{ label: "3-4 KaÅŸÄ±k", ratio: 0.4 }, { label: "1 Su BardaÄŸÄ±", ratio: 1 }, { label: "BÃ¼yÃ¼k Kase", ratio: 1.5 }] },
                { id: 83, cat: "SNACK", name: "Muz", type: "piece", vals: { cal: 105, prot: 1, carb: 27, fat: 0.4 }, unitName: "Adet" },
                { id: 84, cat: "SNACK", name: "SÃ¼t (Tam/YarÄ±m)", type: "portion", vals: { cal: 60, prot: 3, carb: 5, fat: 3 }, options: [{ label: "1 Bardak (200ml)", ratio: 2 }, { label: "BÃ¼yÃ¼k Kupa (300ml)", ratio: 3 }, { label: "YarÄ±m Kutu (500ml)", ratio: 5 }] },
                { id: 85, cat: "SNACK", name: "YoÄŸurt", type: "portion", vals: { cal: 65, prot: 4, carb: 5, fat: 3 }, options: [{ label: "1 Kase", ratio: 2 }, { label: "BÃ¼yÃ¼k Kase", ratio: 3 }] },
                { id: 86, cat: "SNACK", name: "Cips", type: "portion", vals: { cal: 530, prot: 6, carb: 50, fat: 35 }, options: [{ label: "1 AvuÃ§", ratio: 0.2 }, { label: "KÃ¼Ã§Ã¼k Paket", ratio: 0.5 }, { label: "BÃ¼yÃ¼k Paket", ratio: 1.5 }] },
                { id: 87, cat: "SNACK", name: "Kakaolu SÃ¼t (KÃ¼Ã§Ã¼k)", type: "piece", vals: { cal: 150, prot: 6, carb: 20, fat: 4 }, unitName: "Kutu (200ml)" },
                { id: 88, cat: "SNACK", name: "Indomie Noodle", type: "piece", vals: { cal: 350, prot: 8, carb: 45, fat: 15 }, unitName: "Paket" },
                { id: 89, cat: "SNACK", name: "KavrulmuÅŸ FÄ±stÄ±k (Tuzsuz)", type: "portion", vals: { cal: 170, prot: 7, carb: 6, fat: 14 }, options: [{ label: "1 AvuÃ§ (~30g)", ratio: 1 }, { label: "2 AvuÃ§ (~60g)", ratio: 2 }] },
                { id: 90, cat: "SNACK", name: "Kuru KayÄ±sÄ±", type: "piece", vals: { cal: 25, prot: 0.3, carb: 6, fat: 0 }, unitName: "Adet" }
            ],
            MEAL_PLAN_DB: {
                breakfast: [
                    { text: "3 Yumurta (Tavada/Omlet) + 3 Dilim KaÅŸar + Ekmek", kcal: 550 },
                    { text: "3 HaÅŸlanmÄ±ÅŸ Yumurta + 5-6 Zeytin + Bol Ekmek", kcal: 500 },
                    { text: "Menemen (3 YumurtalÄ±) + YarÄ±m Ekmek", kcal: 600 },
                    { text: "Krep (2 Yumurta + 2 Bardak SÃ¼t + Un) + FÄ±stÄ±k Ezmesi", kcal: 700 },
                    { text: "Sucuklu Yumurta (3 Yumurta) + Ekmek", kcal: 650 },
                    { text: "Bal + Kaymak + 2 Dilim Ekmek + 1 Bardak SÃ¼t", kcal: 550 },
                    { text: "Simit (2 Adet) + Beyaz Peynir + Ã‡ay", kcal: 480 },
                    { text: "PoÄŸaÃ§a (2 Adet) + Ayran", kcal: 520 },
                    { text: "Peynir TabaÄŸÄ± (KaÅŸar + Beyaz) + Zeytin + Domates + Ekmek", kcal: 600 },
                    { text: "Mercimek Ã‡orbasÄ± (2 Kase) + Ekmek + Limon", kcal: 450 },
                    { text: "Yulaf LapasÄ± (SÃ¼tle) + Muz + Bal", kcal: 550 },
                    { text: "AÃ§ma (2 Adet) + Nutella + SÃ¼t", kcal: 680 }
                ],
                fuel: [
                    { text: "GAINER SHAKE (Temel: SÃ¼t + Yulaf + Muz)", kcal: 700 },
                    { text: "GAINER SHAKE + 1 Muz (Ekstra)", kcal: 800 },
                    { text: "SHAKE: SÃ¼t + Yulaf + FÄ±stÄ±k Ezmesi + Muz", kcal: 850 },
                    { text: "SHAKE: SÃ¼t + Kakao + Yulaf + Bal", kcal: 750 },
                    { text: "SHAKE: SÃ¼t + Muz + Hurma (3 Adet) + Yulaf", kcal: 780 },
                    { text: "Kakaolu SÃ¼t (500ml) + 2 Muz", kcal: 550 },
                    { text: "SHAKE: SÃ¼t + Cici Bebe + Muz", kcal: 720 },
                    { text: "Ayran (500ml) + FÄ±stÄ±k Ezmeli Ekmek", kcal: 480 }
                ],
                lunch: [
                    { text: "Tavuklu Pilav (1.5 Porsiyon / Bol Tavuklu)", kcal: 750 },
                    { text: "Tavuk DÃ¶ner (Tam Ekmek / Zurna DÃ¼rÃ¼m)", kcal: 800 },
                    { text: "KÄ±ymalÄ± Pide (1.5 Porsiyon)", kcal: 750 },
                    { text: "Makarna (Bol SalÃ§alÄ± ve YaÄŸlÄ±) + YoÄŸurt", kcal: 700 },
                    { text: "Ä°skender (1.5 Porsiyon)", kcal: 900 },
                    { text: "Adana DÃ¼rÃ¼m (2 Adet)", kcal: 850 },
                    { text: "Lahmacun (3 Adet) + Ayran", kcal: 700 },
                    { text: "Kuru Fasulye + Pilav (Dolu Tabak) + TurÅŸu", kcal: 750 },
                    { text: "Tantuni DÃ¼rÃ¼m (2 Adet)", kcal: 720 },
                    { text: "KÃ¶fte Ekmek (2 Adet) + Ayran", kcal: 680 },
                    { text: "Etli Ekmek (1 Porsiyon)", kcal: 780 },
                    { text: "MantÄ± (Dolu Tabak) + YoÄŸurt + TereyaÄŸÄ±", kcal: 820 },
                    { text: "Ã‡iÄŸ KÃ¶fte DÃ¼rÃ¼m (2 Adet) + Åalgam", kcal: 600 },
                    { text: "Mercimek KÃ¶ftesi (10 Adet) + Ayran + Ekmek", kcal: 650 }
                ],
                pre_workout: [
                    { text: "1 Muz + 1 Sade Kahve", kcal: 110 },
                    { text: "2 Dilim FÄ±stÄ±k Ezmeli Ekmek", kcal: 350 },
                    { text: "1 Paket Cici Bebe + SÃ¼t", kcal: 600 },
                    { text: "3-4 Hurma + TÃ¼rk Kahvesi", kcal: 180 },
                    { text: "Kuru KayÄ±sÄ± (5-6 Adet) + 1 AvuÃ§ FÄ±stÄ±k", kcal: 280 },
                    { text: "Muz + 1 KaÅŸÄ±k FÄ±stÄ±k Ezmesi", kcal: 220 },
                    { text: "Yulaf Bar + Kahve", kcal: 250 },
                    { text: "Pekmezli Ekmek (2 Dilim)", kcal: 300 }
                ],
                dinner: [
                    { text: "Ev YemeÄŸi (Bakliyat/Sebze) + 100gr Lor Peyniri", kcal: 500 },
                    { text: "KÄ±ymalÄ± Makarna (Dolu Tabak) + YoÄŸurt", kcal: 650 },
                    { text: "Tavuk Sote + Pilav (Dolu Tabak)", kcal: 700 },
                    { text: "KarnÄ±yarÄ±k (2 Adet) + Pilav", kcal: 750 },
                    { text: "Ä°mam BayÄ±ldÄ± (2 Adet) + Bulgur PilavÄ±", kcal: 680 },
                    { text: "Etli Nohut + Pilav + CacÄ±k", kcal: 720 },
                    { text: "KÃ¶fte (6 Adet) + Patates PÃ¼resi + Salata", kcal: 780 },
                    { text: "Tavuk Izgara (250g) + Makarna", kcal: 700 },
                    { text: "Sebzeli GÃ¼veÃ§ + Ekmek + YoÄŸurt", kcal: 550 },
                    { text: "FÄ±rÄ±n Tavuk But (2 Adet) + Pilav", kcal: 800 },
                    { text: "Mercimek Ã‡orbasÄ± + KaÅŸarlÄ± Tost", kcal: 580 },
                    { text: "ZeytinyaÄŸlÄ± Fasulye + Pilav + CacÄ±k", kcal: 620 }
                ],
                night: [
                    { text: "1 Bardak SÃ¼t + 1 AvuÃ§ KuruyemiÅŸ (FÄ±stÄ±k/Leblebi)", kcal: 300 },
                    { text: "KaÅŸarlÄ± Tost (Ã‡ift KaÅŸarlÄ±)", kcal: 400 },
                    { text: "Kalan Shake (Varsa)", kcal: 300 },
                    { text: "SÃ¼zme YoÄŸurt (200g) + Bal + Ceviz", kcal: 350 },
                    { text: "Ayran (500ml) + 2 Dilim KaÅŸar", kcal: 280 },
                    { text: "Muzlu SÃ¼t (Blender)", kcal: 300 },
                    { text: "Kefir (500ml) + 1 Muz", kcal: 320 },
                    { text: "Lor Peyniri (100g) + Bal", kcal: 200 },
                    { text: "Gevrek + SÃ¼t (1 Kase)", kcal: 380 },
                    { text: "FÄ±stÄ±k Ezmeli Ekmek + SÃ¼t", kcal: 420 }
                ]
            },
            ANATOMY_DB: {
                "chest": { name: "Pectoralis Major", function: "Ä°tme kuvveti.", system: "Ãœst GÃ¶vde Ä°tiÅŸ", action: "Push-up, Floor Press", recovery: "48-72 Saat" },
                "abs": { name: "Rectus Abdominis", function: "Core gÃ¼cÃ¼, cinsel dayanÄ±klÄ±lÄ±k.", system: "Merkezi Denge", action: "Plank, Leg Raise, Vacuum", recovery: "24-48 Saat" },
                "quads": { name: "Quadriceps", function: "VÃ¼cudu taÅŸÄ±ma, piston gÃ¼cÃ¼.", system: "Lokomotor", action: "Squat", recovery: "72 Saat" },
                "biceps": { name: "Biceps Brachii", function: "Ã‡ekme, kavrama.", system: "Ãœst GÃ¶vde Ã‡ekiÅŸ", action: "Hammer Curl", recovery: "48 Saat" },
                "traps": { name: "Trapezius", function: "Omuz stabilizasyonu.", system: "Posterior Zincir", action: "Farmer's Walk", recovery: "48 Saat" },
                "lats": { name: "Latissimus Dorsi", function: "GÃ¶vdeyi yukarÄ± Ã§ekme.", system: "Posterior Zincir", action: "One Arm Row", recovery: "48-72 Saat" },
                "glutes": { name: "Gluteus Maximus", function: "Ä°tiÅŸ gÃ¼cÃ¼ (Thrust).", system: "GÃ¼Ã§ Merkezi", action: "Squat", recovery: "72 Saat" },
                "hamstrings": { name: "Hamstrings", function: "Diz bÃ¼kme.", system: "Lokomotor", action: "Squat", recovery: "48-72 Saat" },
                "lowerback": { name: "Erector Spinae", function: "OmurgayÄ± dik tutma.", system: "Core Destek", action: "Superman", recovery: "48 Saat" },
                "pelvic": { name: "Pelvik Taban", function: "BoÅŸalma kontrolÃ¼.", system: "Ãœreme", action: "Kegel", recovery: "24 Saat" }
            },
            MENTAL_PHASES: [
                {
                    id: 1,
                    title: "FAZ 1: JAGUAR TEORÄ°SÄ°",
                    desc: "AlgÄ± YÃ¶netimi. DÄ±ÅŸarÄ±ya gÃ¼Ã§lÃ¼ gÃ¶rÃ¼n, iÃ§eriÄŸi doldur.",
                    core: "DÄ±ÅŸarÄ±dan bakÄ±ldÄ±ÄŸÄ±nda kÄ±rÄ±lgan, daÄŸÄ±nÄ±k veya Ã§aresiz gÃ¶rÃ¼nmemek. Ã–nce dÄ±ÅŸarÄ±ya soÄŸukkanlÄ±, kontrollÃ¼ ve gÃ¼Ã§lÃ¼ bir â€˜kasaâ€™ kurmak, sonra bu kasanÄ±n iÃ§ini zamanla gerÃ§ek performans ve kapasiteyle doldurmak.",
                    intent: "Ä°maj ile iÃ§ gerÃ§eklik arasÄ±ndaki farkÄ± bilinÃ§li yÃ¶netmek. Åu an eksik olsan bile â€˜kendi kendini ciddiye alanâ€™ bir duruÅŸ inÅŸa etmek.",
                    strategy: ["Kendi hakkÄ±nda sÃ¼rekli ÅŸikÃ¢yet eden, maÄŸdur tonundan Ã§Ä±kmak.", "Ä°nsanlara problemlerini deÄŸil, hareket planÄ±nÄ± ve ilerlemeni gÃ¶stermek.", "Her ortamda minimum ÅŸikÃ¢yet, maksimum Ã§Ã¶zÃ¼m/aksiyon cÃ¼mlesi kullanmak."],
                    practice: ["GÃ¼nlÃ¼k: En az 1 durumda â€˜ÅŸikÃ¢yet etmek yerine aksiyon cÃ¼mlesiâ€™ kur.", "GÃ¼nlÃ¼k: Kendi hakkÄ±nda negatif konuÅŸmalarÄ±nÄ± fark edince durdurup nÃ¶tr/Ã§Ã¶zÃ¼m odaklÄ± cÃ¼mleye Ã§evir."]
                },
                {
                    id: 2,
                    title: "FAZ 2: KARANLIK SANATLAR",
                    desc: "Sistemin aÃ§Ä±klarÄ±nÄ± bul. 48 Yasa oku.",
                    core: "Ä°nsan ve sistem dinamiklerini naiflikten Ã§Ä±kÄ±p daha soÄŸuk ve analitik ÅŸekilde gÃ¶rmek. Sosyal oyunlarÄ±, gÃ¼Ã§ iliÅŸkilerini ve manipÃ¼lasyonlarÄ± fark edip, bunlarÄ± en azÄ±ndan savunma seviyesinde bilmek.",
                    intent: "â€˜Neden bÃ¶yle oldu?â€™ diye safÃ§a kalmak yerine, insanlarÄ±n hareketlerinin arkasÄ±ndaki Ã§Ä±kar, korku ve gÃ¼Ã§ dinamiklerini okumayÄ± Ã¶ÄŸrenmek.",
                    strategy: ["Temel kaynak: 48 Power Laws gibi kitaplarÄ± saha rehberi gibi okumak.", "GÃ¼nlÃ¼k olaylarÄ± â€˜hangi yasa / hangi dinamikâ€™ Ã¼zerinden iÅŸlediÄŸini analiz etmek.", "SaflÄ±k ile aptallÄ±ÄŸÄ± ayÄ±rmayÄ± Ã¶ÄŸrenmek."],
                    practice: ["GÃ¼nlÃ¼k: GÃ¼n iÃ§inde seni etkileyen 1 olayÄ± seÃ§ ve â€˜burada kim ne istiyordu?â€™ diye analiz et.", "HaftalÄ±k: En az 1 kere, birinin davranÄ±ÅŸÄ±nÄ± sadece sÃ¶ylediklerine gÃ¶re deÄŸil, Ã§Ä±karÄ±na gÃ¶re yorumlamaya Ã§alÄ±ÅŸ."]
                },
                {
                    id: 3,
                    title: "FAZ 3: ROBOTÄ°K Ä°CRAAT",
                    desc: "DuygularÄ± kapat. CanÄ±n istemese de yap.",
                    core: "â€˜Ä°Ã§imden gelmiyorâ€™ bahanesini Ã¶ldÃ¼rmek. Duygusal moduna gÃ¶re deÄŸil, protokole gÃ¶re hareket etmek. CanÄ±n istemediÄŸi hÃ¢lde minimum paketi bile olsa iÅŸi yapmayÄ± Ã¶ÄŸrenmek.",
                    intent: "Ruh hÃ¢line gÃ¶re deÄŸiÅŸmeyen, makine gibi Ã§alÄ±ÅŸan kÃ¼Ã§Ã¼k rutinler kurmak.",
                    strategy: ["Her gÃ¼n iÃ§in â€˜duygu baÄŸÄ±msÄ±zâ€™ 2â€“3 zorunlu davranÄ±ÅŸ belirlemek.", "Kendine duygu analizi deÄŸil, metrik sorularÄ± sormak: â€˜YaptÄ±m mÄ± / yapmadÄ±m mÄ±?â€™.", "Minimum versiyonu kabul etmek: 0 yerine 1 birim iÅŸ."],
                    practice: ["GÃ¼nlÃ¼k: Her ne olursa olsun yapacaÄŸÄ±n 2 kÃ¼Ã§Ã¼k rutin belirle.", "GÃ¼nlÃ¼k: â€˜CanÄ±m istemiyorâ€™ dediÄŸin anda, rutini en kÃ¼Ã§Ã¼k versiyonuyla da olsa icra et."]
                },
                {
                    id: 4,
                    title: "FAZ 4: DEBUGGING",
                    desc: "Reddedilmek hatadÄ±r. Analiz et, tekrar dene.",
                    core: "Bir ÅŸey yolunda gitmediÄŸinde bunu kiÅŸisel deÄŸerine saldÄ±rÄ± gibi deÄŸil, sistemdeki bir bug gibi gÃ¶rmek. Reddedilme, baÅŸarÄ±sÄ±zlÄ±k, gÃ¶rmezden gelinme gibi olaylarÄ± soÄŸukkanlÄ± ÅŸekilde dissect etmek.",
                    intent: "â€˜Ben kÃ¶tÃ¼yÃ¼mâ€™ yerine â€˜denemem yanlÄ±ÅŸ kurgulanmÄ±ÅŸâ€™ diyebilecek mesafe kazanmak.",
                    strategy: ["Her baÅŸarÄ±sÄ±z giriÅŸimi 3 soruyla incelemek: Ne denedim? Nerede kÄ±rÄ±ldÄ±? Ne deÄŸiÅŸtirebilirim?", "AynÄ± denemeyi iyileÅŸtirerek tekrar etmek.", "Veri toplamadan debugging yapmamak."],
                    practice: ["GÃ¼nlÃ¼k/HaftalÄ±k: Sende iz bÄ±rakan her â€˜redâ€™ iÃ§in 3 maddelik mini log yaz.", "Her red sonrasÄ± en az 1 tane â€˜revize edilmiÅŸ yeni denemeâ€™ belirle."]
                },
                {
                    id: 5,
                    title: "FAZ 5: ASYNC EXECUTION",
                    desc: "MÃ¼kemmeli bekleme. Aksak ayakla yÃ¼rÃ¼.",
                    core: "Her ÅŸey hazÄ±r olmadan da harekete geÃ§mek. Ekipman, ortam, ruh hÃ¢li, mÃ¼kemmel plan beklemeden â€˜neyle mÃ¼mkÃ¼nse onunlaâ€™ yola Ã§Ä±kmak.",
                    intent: "SÃ¼rekli erteleyen â€˜hazÄ±rlÄ±k moduâ€™ndan Ã§Ä±kÄ±p, kusurlu ama Ã§alÄ±ÅŸan bir yÃ¼rÃ¼yÃ¼ÅŸe geÃ§mek.",
                    strategy: ["Projeleri â€˜mÃ¼kemmel versiyonâ€™ yerine â€˜bugÃ¼n baÅŸlayabileceÄŸim minimum versiyonâ€™la tanÄ±mlamak.", "Mazeret listesini kÄ±saltmak.", "KÃ¼Ã§Ã¼k ama gerÃ§ek ilerleme metriÄŸi tutmak."],
                    practice: ["GÃ¼nlÃ¼k: En az 1 projede â€˜hazÄ±r deÄŸilimâ€™ dediÄŸin noktada 5â€“10 dakikalÄ±k mini icraat yap.", "GÃ¼nlÃ¼k: â€˜BugÃ¼n mÃ¼kemmel deÄŸildi ama ÅŸunlarÄ± yaptÄ±mâ€™ diye liste Ã§Ä±kar."]
                },
                {
                    id: 6,
                    title: "FAZ 6: ÃœRETÄ°CÄ° MODU",
                    desc: "TÃ¼ketici olma. Tool yaz, iÃ§erik Ã¼ret.",
                    core: "SÃ¼rekli izleyen, okuyan, kaydÄ±ran tarafta kalmak yerine bir ÅŸeyler Ã¼reten tarafa geÃ§mek. Bilgiyi sadece depolamak deÄŸil, iÅŸleyip dÄ±ÅŸarÄ± veren sistem olmak.",
                    intent: "Her gÃ¼n seni â€˜izleyiciâ€™ konumundan biraz daha â€˜Ã¼reticiâ€™ konumuna taÅŸÄ±yan bir output bÄ±rakmak.",
                    strategy: ["TÃ¼ketim/Ã¼retim oranÄ±nÄ± gÃ¶rmek iÃ§in basit bir log tutmak.", "Tek bir Ã¼retim formatÄ± seÃ§mek.", "TÃ¼kettiÄŸin her bÃ¼yÃ¼k iÃ§erik iÃ§in en az 1 kÃ¼Ã§Ã¼k Ã¼retim Ã§Ä±ktÄ±sÄ± bÄ±rakmak."],
                    practice: ["GÃ¼nlÃ¼k: En az 1 â€˜Ã§Ä±ktÄ±â€™ bÄ±rak (tweet, kÄ±sa yazÄ±, mini script, repo update vs).", "GÃ¼nlÃ¼k: TÃ¼ketimi belirli bir banda kilitle."]
                },
                {
                    id: 7,
                    title: "FAZ 7: ÅANS MÄ°MARÄ°SÄ°",
                    desc: "Havuzunu kaz. Åans yaÄŸÄ±nca dolacak.",
                    core: "ÅansÄ±, tamamen rastgele bir olay olarak deÄŸil, senin Ã¶nceden kazdÄ±ÄŸÄ±n havuzlara yaÄŸacak bir yaÄŸmur gibi gÃ¶rmek. Ä°nsanlar, beceriler, projeler ve gÃ¶rÃ¼nÃ¼rlÃ¼k Ã¼zerinden ÅŸans yÃ¼zdÃ¼ÄŸÃ¼nde yakalayabileceÄŸin yÃ¼zey alanÄ±nÄ± bÃ¼yÃ¼tmek.",
                    intent: "Gelecekteki fÄ±rsatlara hazÄ±r olacak altyapÄ±yÄ± bugÃ¼nden kurmak.",
                    strategy: ["Skill havuzu oluÅŸturmak.", "Network havuzu oluÅŸturmak.", "GÃ¶rÃ¼nÃ¼rlÃ¼k havuzu oluÅŸturmak."],
                    practice: ["GÃ¼nlÃ¼k/HaftalÄ±k: 1 kiÅŸiyle hafif bir temas kur.", "HaftalÄ±k: Yeni bir â€˜havuz taÅŸÄ±â€™ ekle (kÃ¼Ã§Ã¼k repo, not, proje)."]
                },
                {
                    id: 8,
                    title: "FAZ 8: DÄ°NAMÄ°K ADAPTASYON",
                    desc: "Statik olma. SÃ¼rekli kendini gÃ¼ncelle.",
                    core: "PlanÄ± kutsal deÄŸil, yÃ¶nÃ¼ kutsal gÃ¶rmek. Åartlara, geri bildirimlere ve kendi deÄŸiÅŸen hÃ¢line gÃ¶re sistemi gÃ¼ncelleyebilmek.",
                    intent: "SÃ¼rekli â€˜ben bÃ¶yleyimâ€™ diye takÄ±lÄ± kalmak yerine, versiyon numaranÄ± yÃ¼kselten bir yaklaÅŸÄ±m benimsemek.",
                    strategy: ["HaftalÄ±k review rutinini ciddiye almak.", "Sabit kimlik cÃ¼mleleri yerine, â€˜ÅŸu anâ€™ki versiyonunu tanÄ±mlayan ifadeler kullanmak.", "HatalarÄ± ve saÃ§malÄ±klarÄ± â€˜sÃ¼rÃ¼m notuâ€™ gibi yazmak."],
                    practice: ["HaftalÄ±k: 20â€“30 dakikalÄ±k â€˜sistem reviewâ€™ zamanÄ± ayÄ±r.", "AylÄ±k: Kendine â€˜version logâ€™ yaz (Bu ay ne deÄŸiÅŸti?)."]
                }
            ]
        };

        // --- UTILS ---
        const Utils = {
            dateStr: () => new Date().toLocaleDateString('tr-TR').split('.').reverse().join('-'),
            storage: {
                async get(key) {
                    try {
                        if (typeof window.storage !== 'undefined') {
                            const res = await window.storage.get(key, false);
                            return res ? res.value : null;
                        }
                        return JSON.parse(localStorage.getItem(key));
                    } catch (e) { return null; }
                },
                async set(key, val) {
                    try {
                        if (typeof window.storage !== 'undefined') {
                            await window.storage.set(key, val, false);
                        } else {
                            localStorage.setItem(key, JSON.stringify(val));
                        }
                        return true;
                    } catch (e) { UI.showToast("KayÄ±t HatasÄ±!", "error"); return false; }
                }
            },
            getRandomMeal(category) {
                const options = DB.MEAL_PLAN_DB[category];
                if (!options) return null;
                return options[Math.floor(Math.random() * options.length)];
            }
        };

        // --- STORE ---
        const Store = {
            state: { weight: 45.0, fuelDate: null, customFoods: [], meals: {}, dailyPlan: null, selectedMuscle: null, activeTab: 'dashboard' },
            async init() {
                const w = await Utils.storage.get(CONFIG.KEYS.WEIGHT);
                if (w) this.state.weight = parseFloat(w);
                this.state.fuelDate = await Utils.storage.get(CONFIG.KEYS.FUEL);
                this.state.customFoods = await Utils.storage.get(CONFIG.KEYS.CUSTOM_FOODS) || [];

                // Check or generate daily plan
                const today = Utils.dateStr();
                const savedPlan = await Utils.storage.get(CONFIG.KEYS.DAILY_PLAN);

                if (savedPlan && savedPlan.date === today) {
                    this.state.dailyPlan = savedPlan.plan;
                } else {
                    await this.generateDailyPlan();
                }
            },
            async generateDailyPlan() {
                const plan = {
                    breakfast: Utils.getRandomMeal('breakfast'),
                    fuel: Utils.getRandomMeal('fuel'),
                    lunch: Utils.getRandomMeal('lunch'),
                    pre_workout: Utils.getRandomMeal('pre_workout'),
                    dinner: Utils.getRandomMeal('dinner'),
                    night: Utils.getRandomMeal('night')
                };
                this.state.dailyPlan = plan;
                await Utils.storage.set(CONFIG.KEYS.DAILY_PLAN, { date: Utils.dateStr(), plan: plan });
            },
            async getWorkout(date) { return await Utils.storage.get(CONFIG.KEYS.WORKOUT + date) || []; },
            async toggleTask(id) {
                const date = Utils.dateStr();
                let tasks = await this.getWorkout(date);
                tasks = tasks.includes(id) ? tasks.filter(t => t !== id) : [...tasks, id];
                await Utils.storage.set(CONFIG.KEYS.WORKOUT + date, tasks);
                await this.updateStreak(); // Update streak on task toggle
            },
            async saveWeight(w) {
                this.state.weight = parseFloat(w);
                await Utils.storage.set(CONFIG.KEYS.WEIGHT, this.state.weight);
                let hist = await Utils.storage.get(CONFIG.KEYS.WEIGHT_HISTORY) || {};
                hist[Utils.dateStr()] = this.state.weight;
                await Utils.storage.set(CONFIG.KEYS.WEIGHT_HISTORY, hist);
                return true;
            },
            async saveFuel() {
                this.state.fuelDate = Utils.dateStr();
                await Utils.storage.set(CONFIG.KEYS.FUEL, this.state.fuelDate);
            },
            async addMeal(meal) {
                const date = Utils.dateStr();
                const key = CONFIG.KEYS.MEAL + date;
                let meals = await Utils.storage.get(key) || [];
                meals.push(meal);
                await Utils.storage.set(key, meals);
            },
            async getMeals(date) { return await Utils.storage.get(CONFIG.KEYS.MEAL + date) || []; },
            async deleteMeal(index) {
                const date = Utils.dateStr();
                const key = CONFIG.KEYS.MEAL + date;
                let meals = await Utils.storage.get(key) || [];
                if (index >= 0 && index < meals.length) {
                    meals.splice(index, 1);
                    await Utils.storage.set(key, meals);
                    return true;
                }
                return false;
            },
            async addCustomFood(food) {
                this.state.customFoods.push(food);
                await Utils.storage.set(CONFIG.KEYS.CUSTOM_FOODS, this.state.customFoods);
            },
            getAllFoods() {
                // Sort by category first, then name
                const combined = [...DB.FOODS, ...this.state.customFoods];
                return combined.sort((a, b) => {
                    // Put PROTOKOL first
                    if (a.cat === 'PROTOKOL') return -1;
                    if (b.cat === 'PROTOKOL') return 1;
                    return a.name.localeCompare(b.name);
                });
            },
            async getStats() {
                const data = await Utils.storage.get(CONFIG.KEYS.MEASURE);
                if (!data) return { current: {}, history: [] };
                // Migration: eski format (dÃ¼z obje) ise yeni formata Ã§evir
                if (!data.current && !data.history) {
                    return { current: data, history: [] };
                }
                return data;
            },
            async saveStats(s) {
                const existing = await this.getStats();
                const today = Utils.dateStr();
                const current = existing.current || {};
                const history = existing.history || [];

                // Mevcut deÄŸerler varsa ve bugÃ¼n kaydedilmediyse history'e ekle
                if (Object.keys(current).length > 0 && current.chest) {
                    const lastEntry = history[history.length - 1];
                    const lastDate = lastEntry ? lastEntry.date : null;
                    if (lastDate !== today && current.savedAt !== today) {
                        history.push({
                            date: current.savedAt || today,
                            chest: current.chest,
                            arm: current.arm,
                            waist: current.waist,
                            leg: current.leg
                        });
                    }
                }

                // Yeni current deÄŸerlerini kaydet
                existing.current = { ...s, savedAt: today };
                existing.history = history.slice(-30); // Son 30 kayÄ±t
                await Utils.storage.set(CONFIG.KEYS.MEASURE, existing);
            },

            async getHistory() { return await Utils.storage.get(CONFIG.KEYS.WEIGHT_HISTORY) || {}; },

            // Streak & Progress Tracking
            async getStreak() {
                const streakData = await Utils.storage.get(CONFIG.KEYS.STREAK) || { count: 0, lastDate: null };
                const today = Utils.dateStr();
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toLocaleDateString('tr-TR').split('.').reverse().join('-');

                // If last activity was today, return current streak
                if (streakData.lastDate === today) {
                    return streakData.count;
                }
                // If last activity was yesterday, streak continues but needs update
                if (streakData.lastDate === yesterdayStr) {
                    return streakData.count;
                }
                // Otherwise streak is broken
                return 0;
            },
            async updateStreak() {
                const today = Utils.dateStr();
                const workout = await this.getWorkout(today);
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];

                // Only update streak if at least half of tasks are done
                if (workout.length >= Math.ceil(plan.tasks.length / 2)) {
                    let streakData = await Utils.storage.get(CONFIG.KEYS.STREAK) || { count: 0, lastDate: null };

                    if (streakData.lastDate !== today) {
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yesterdayStr = yesterday.toLocaleDateString('tr-TR').split('.').reverse().join('-');

                        if (streakData.lastDate === yesterdayStr) {
                            streakData.count += 1;
                        } else if (streakData.lastDate !== today) {
                            streakData.count = 1; // Reset streak
                        }
                        streakData.lastDate = today;
                        await Utils.storage.set(CONFIG.KEYS.STREAK, streakData);
                    }
                }
            },

            // --- PHASE 1: DATA SECURITY (BACKUP/RESTORE) ---
            async exportData() {
                const data = {};
                for (const key in CONFIG.KEYS) {
                    const storageKey = CONFIG.KEYS[key];
                    if (storageKey.endsWith('_')) {
                        for (let i = 0; i < localStorage.length; i++) {
                            const lsKey = localStorage.key(i);
                            if (lsKey && lsKey.startsWith(storageKey)) {
                                data[lsKey] = await Utils.storage.get(lsKey);
                            }
                        }
                    } else {
                        data[storageKey] = await Utils.storage.get(storageKey);
                    }
                }
                data.meta = { version: CONFIG.VERSION, date: new Date().toISOString(), user: 'MONK_MODE_USER' };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `monk_mode_backup_${Utils.dateStr()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                await Utils.storage.set(CONFIG.KEYS.BACKUP, Utils.dateStr());
                return true;
            },

            async importData(jsonContent) {
                try {
                    const data = JSON.parse(jsonContent);
                    if (!data.meta) throw new Error("GeÃ§ersiz yedek dosyasÄ±");
                    const prefixes = Object.values(CONFIG.KEYS).map(k => k.replace(/_$/, ''));
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && prefixes.some(p => key.startsWith(p))) keysToRemove.push(key);
                    }
                    keysToRemove.forEach(k => localStorage.removeItem(k));
                    for (const key in data) {
                        if (key !== 'meta') await Utils.storage.set(key, data[key]);
                    }
                    return { success: true, date: data.meta.date };
                } catch (e) {
                    console.error("Import Error:", e);
                    return { success: false, error: e.message };
                }
            },

            async checkBackupStatus() {
                const lastBackup = await Utils.storage.get(CONFIG.KEYS.BACKUP);
                if (!lastBackup) return 'NEVER';
                const today = new Date();
                const last = new Date(lastBackup.split('.').reverse().join('-'));
                const diffDays = Math.ceil(Math.abs(today - last) / (1000 * 60 * 60 * 24));
                if (diffDays > 7) return 'WARNING';
                return 'OK';
            },

            // --- PHASE 2: ACTIVE TRAINING ENGINE ---
            async getWorkoutData(date) {
                return await Utils.storage.get('monk_workout_data_' + date) || {};
            },

            async logSet(taskId, setIndex, weight, reps, isDone) {
                const date = Utils.dateStr();
                const key = 'monk_workout_data_' + date;
                const data = await Utils.storage.get(key) || {};
                if (!data[taskId]) data[taskId] = [];
                const w = parseFloat(weight) || 0;
                const r = parseFloat(reps) || 0;
                data[taskId][setIndex] = {
                    weight: w,
                    reps: r,
                    timestamp: new Date().toISOString(),
                    completed: isDone
                };
                await Utils.storage.set(key, data);

                // Egzersiz geÃ§miÅŸine de kaydet (uzun vadeli takip)
                if (isDone && w > 0 && r > 0) {
                    await this.saveToExerciseHistory(taskId, w, r);
                }

                const hasCompletedSet = data[taskId].some(s => s && s.completed);
                if (hasCompletedSet) await this.setTaskDone(taskId, true);
                return { weight: w, reps: r, volume: w * r };
            },

            // --- YENÄ°: Egzersiz GeÃ§miÅŸi Takibi ---
            async saveToExerciseHistory(exerciseId, weight, reps) {
                const history = await Utils.storage.get(CONFIG.KEYS.EXERCISE_HISTORY) || {};
                if (!history[exerciseId]) history[exerciseId] = [];
                history[exerciseId].push({
                    date: Utils.dateStr(),
                    weight: weight,
                    reps: reps,
                    volume: weight * reps,
                    timestamp: new Date().toISOString()
                });
                // Son 100 kayÄ±t tut
                if (history[exerciseId].length > 100) {
                    history[exerciseId] = history[exerciseId].slice(-100);
                }
                await Utils.storage.set(CONFIG.KEYS.EXERCISE_HISTORY, history);
            },

            async getExerciseHistory(exerciseId) {
                const history = await Utils.storage.get(CONFIG.KEYS.EXERCISE_HISTORY) || {};
                return history[exerciseId] || [];
            },

            async getPersonalBest(exerciseId) {
                const history = await this.getExerciseHistory(exerciseId);
                if (history.length === 0) return null;
                // PR = max volume (aÄŸÄ±rlÄ±k Ã— tekrar)
                let maxVolume = 0;
                let prRecord = null;
                history.forEach(record => {
                    const vol = record.volume || (record.weight * record.reps);
                    if (vol > maxVolume) {
                        maxVolume = vol;
                        prRecord = { ...record, volume: vol };
                    }
                });
                return prRecord;
            },

            async setTaskDone(id, status) {
                const date = Utils.dateStr();
                let tasks = await this.getWorkout(date);
                if (status) {
                    if (!tasks.includes(id)) tasks.push(id);
                } else {
                    tasks = tasks.filter(t => t !== id);
                }
                await Utils.storage.set(CONFIG.KEYS.WORKOUT + date, tasks);
                await this.updateStreak();

                // TÃ¼m gÃ¶revler tamamlandÃ½ mÄ± kontrol et
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];
                if (tasks.length >= plan.tasks.length) {
                    // TÃ¼m gÃ¶revler tamamlandÄ±!
                    const messages = [
                        { emoji: "ğŸ†", text: "GÃœN TAMAMLANDI!", sub: "BugÃ¼nÃ¼ fethetttin. YarÄ±n daha gÃ¼Ã§lÃ¼ dÃ¶n." },
                        { emoji: "ğŸ‘‘", text: "KRAL GÄ°BÄ°!", sub: "Disiplin = Ã–zgÃ¼rlÃ¼k. Bunu kanÄ±tladÄ±n." },
                        { emoji: "ğŸ”¥", text: "YANDIN AMA AYAKTASIN!", sub: "AcÄ± bÃ¼yÃ¼me demek. Tebrikler." },
                        { emoji: "â­", text: "YÄ°LDÄ°Z PERFORMANS!", sub: "BugÃ¼n kendini aÅŸtÄ±n." },
                        { emoji: "ğŸ’ª", text: "CANAVAR MOD!", sub: "HiÃ§bir ÅŸey seni durduramaz." }
                    ];
                    const msg = messages[Math.floor(Math.random() * messages.length)];
                    setTimeout(() => UI.showEpicOverlay(msg.emoji, msg.text, msg.sub, '#00ff41'), 500);
                }
            },

            async getVolumeStats() {
                const today = new Date();
                const stats = { weekly: 0, daily: {} };
                for (let i = 0; i < 7; i++) {
                    const d = new Date(today);
                    d.setDate(d.getDate() - i);
                    const dateStr = d.toLocaleDateString('tr-TR').split('.').reverse().join('-');
                    const data = await this.getWorkoutData(dateStr);
                    let vol = 0;
                    Object.values(data).forEach(sets => {
                        sets.forEach(s => { if (s && s.completed) vol += (s.weight * s.reps); });
                    });
                    stats.daily[dateStr] = vol;
                    stats.weekly += vol;
                }
                return stats;
            },
            async getTodayProgress() {
                const today = Utils.dateStr();
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];
                const workout = await this.getWorkout(today);
                const meals = await this.getMeals(today);

                const totalCal = meals.reduce((sum, m) => sum + m.cal, 0);
                const tasksDone = workout.length;
                const tasksTotal = plan.tasks.length;

                return {
                    tasksDone,
                    tasksTotal,
                    tasksPercent: Math.round((tasksDone / tasksTotal) * 100),
                    calories: totalCal,
                    caloriesTarget: CONFIG.TARGETS.CAL,
                    caloriesPercent: Math.round((totalCal / CONFIG.TARGETS.CAL) * 100)
                };
            },

            // --- v5.8.0: SLEEP TRACKING ---
            async getSleep(date) {
                return await Utils.storage.get(CONFIG.KEYS.SLEEP + date) || 0;
            },
            async setSleep(hours) {
                const date = Utils.dateStr();
                await Utils.storage.set(CONFIG.KEYS.SLEEP + date, parseFloat(hours));
                return true;
            },

            // --- v5.8.0: WATER TRACKING ---
            async getWater(date) {
                return await Utils.storage.get(CONFIG.KEYS.WATER + date) || 0;
            },
            async addWater(cups = 1) {
                const date = Utils.dateStr();
                const current = await this.getWater(date);
                await Utils.storage.set(CONFIG.KEYS.WATER + date, current + cups);
                return current + cups;
            },

            // --- v5.8.0: MILESTONE CHECK ---
            getNextMilestone() {
                const w = this.state.weight;
                for (const m of CONFIG.MILESTONES) {
                    if (w < m.weight) return m;
                }
                return CONFIG.MILESTONES[CONFIG.MILESTONES.length - 1];
            },
            getCompletedMilestones() {
                return CONFIG.MILESTONES.filter(m => this.state.weight >= m.weight);
            },

            // --- v5.8.0: WEEKLY SUMMARY ---
            async getWeeklySummary() {
                const weeks = [];
                const today = new Date();

                for (let w = 0; w < 4; w++) {
                    let totalCal = 0, calDays = 0, workoutDays = 0;
                    let startWeight = null, endWeight = null;

                    for (let d = 0; d < 7; d++) {
                        const date = new Date(today);
                        date.setDate(date.getDate() - (w * 7 + d));
                        const dateStr = date.toLocaleDateString('tr-TR').split('.').reverse().join('-');

                        const meals = await this.getMeals(dateStr);
                        if (meals.length > 0) {
                            totalCal += meals.reduce((sum, m) => sum + m.cal, 0);
                            calDays++;
                        }

                        const workout = await this.getWorkout(dateStr);
                        if (workout.length > 0) workoutDays++;

                        const hist = await this.getHistory();
                        if (hist[dateStr]) {
                            if (!endWeight) endWeight = hist[dateStr];
                            startWeight = hist[dateStr];
                        }
                    }

                    weeks.push({
                        week: w + 1,
                        avgCal: calDays > 0 ? Math.round(totalCal / calDays) : 0,
                        workoutDays,
                        weightChange: (startWeight && endWeight) ? (endWeight - startWeight).toFixed(1) : null
                    });
                }
                return weeks;
            }
        };

        // --- UI ---
        const UI = {
            activeView: 'front',
            init() {
                this.renderTabs();
                this.startClock();
                Actions.switchTab('dashboard');
                Actions.checkSystemAlerts();
            },
            renderTabs() {
                const tabs = [
                    { id: 'dashboard', l: 'DASHBOARD', i: 'fa-chart-line' },
                    { id: 'training', l: 'ANTRENMAN', i: 'fa-dumbbell' },
                    { id: 'nutrition', l: 'BESLENME', i: 'fa-utensils' },
                    { id: 'progress', l: 'GELÄ°ÅÄ°M', i: 'fa-chart-bar' },
                    { id: 'anatomy', l: 'ANATOMÄ° LAB', i: 'fa-dna' },
                    { id: 'mental', l: 'ZÄ°HÄ°NSEL', i: 'fa-brain' }
                ];
                document.getElementById('nav-tabs').innerHTML = tabs.map(t =>
                    `<button onclick="Actions.switchTab('${t.id}')" id="btn-${t.id}" class="tab-btn flex-none px-6 py-3 font-bold text-xs md:text-sm whitespace-nowrap text-gray-500 hover:text-white transition-colors border-b-2 border-transparent relative">
                        <i class="fas ${t.i} mr-2"></i>${t.l}
                        <div id="badge-${t.id}" class="notification-badge hidden"></div>
                    </button>`
                ).join('');
            },
            updateTab(id) {
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active-tab', 'border-neon-green', 'text-neon-green', 'bg-gray-900/50');
                    b.classList.add('text-gray-500', 'border-transparent');
                });
                document.getElementById(`btn-${id}`)?.classList.add('active-tab', 'border-neon-green', 'text-neon-green', 'bg-gray-900/50');
                document.getElementById(`btn-${id}`)?.classList.remove('text-gray-500', 'border-transparent');
            },
            showToast(msg, type = 'success') {
                const c = document.getElementById('toast-container');
                const e = document.createElement('div');
                e.className = `toast mb-3 rounded shadow-lg bg-cyber-dark border-l-4 ${type === 'success' ? 'border-neon-green text-neon-green' : 'border-neon-red text-neon-red'} text-sm font-bold flex items-center gap-3`;
                e.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${msg}`;
                c.appendChild(e);
                setTimeout(() => e.remove(), 3000);
            },
            modal: {
                open(t, c) {
                    document.getElementById('modal-title').innerText = t;
                    document.getElementById('modal-body').innerHTML = c;
                    document.getElementById('universal-modal').classList.add('active');
                },
                close() { document.getElementById('universal-modal').classList.remove('active'); }
            },
            alert: {
                show(msg) {
                    document.getElementById('alert-message').innerHTML = msg;
                    document.getElementById('alert-modal').classList.add('active');
                },
                close() {
                    document.getElementById('alert-modal').classList.remove('active');
                }
            },
            startClock() {
                const el = document.getElementById('clock-display');
                if (!el) return;
                setInterval(() => el.innerText = new Date().toLocaleTimeString('tr-TR'), 1000);
            },
            renderPortionInputs() {
                const select = document.getElementById('m-food');
                const container = document.getElementById('portion-container');
                if (!select || !container) return;

                if (!select.value) return;

                const foods = Store.getAllFoods();
                const selectedFood = foods[select.value];

                if (!selectedFood) return;

                if (selectedFood.type === 'portion') {
                    let html = `<div class="grid grid-cols-1 gap-2 mt-1">`;
                    selectedFood.options.forEach((opt, idx) => {
                        html += `
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="portion_opt" value="${idx}" class="peer sr-only portion-radio" ${idx === 1 ? 'checked' : ''}>
                                <div class="p-3 rounded border border-gray-600 bg-gray-900 text-gray-400 peer-checked:border-neon-green peer-checked:text-white peer-checked:bg-green-900/20 transition-all flex justify-between items-center gap-2 hover:border-gray-400">
                                    <div class="flex items-center gap-3">
                                        <div class="w-4 h-4 rounded-full border border-gray-500 radio-dot flex items-center justify-center"></div>
                                        <span class="text-sm font-bold">${opt.label}</span>
                                    </div>
                                    <span class="text-xs text-gray-500 font-mono">~${Math.round(selectedFood.vals.cal * opt.ratio)} kcal</span>
                                </div>
                            </label>
                        `;
                    });
                    html += `</div>`;
                    container.innerHTML = `<label class="text-[10px] text-gray-500 font-bold block mb-2 tracking-widest">PORSÄ°YON SEÃ‡Ä°MÄ°</label>${html}`;
                } else {
                    const unitName = selectedFood.unitName || 'Adet';
                    container.innerHTML = `
                        <label class="text-[10px] text-gray-500 font-bold block mb-1">MÄ°KTAR (${unitName})</label>
                        <input type="number" id="m-amount" class="${THEME.input}" value="1" placeholder="KaÃ§ ${unitName}?">
                    `;
                }
            },
            filterFoodList() {
                const search = document.getElementById('food-search').value.toLowerCase();
                const select = document.getElementById('m-food');
                const options = select.options;
                let firstVisibleIndex = -1;

                for (let i = 0; i < options.length; i++) {
                    const txt = options[i].text.toLowerCase();
                    if (txt.includes(search)) {
                        options[i].style.display = "";
                        if (firstVisibleIndex === -1) firstVisibleIndex = i;
                    } else {
                        options[i].style.display = "none";
                    }
                }

                if (select.selectedIndex >= 0 && options[select.selectedIndex].style.display === "none") {
                    if (firstVisibleIndex !== -1) {
                        select.selectedIndex = firstVisibleIndex;
                    }
                }

                this.renderPortionInputs();
            },
            // Epik tam ekran overlay gÃ¶sterici
            showEpicOverlay(emoji, text, sub, color = '#00ff41') {
                const overlay = document.createElement('div');
                overlay.id = 'epic-overlay-' + Date.now();
                overlay.innerHTML = `
                    <div style="
                        position: fixed;
                        inset: 0;
                        background: radial-gradient(ellipse at center, ${color}15 0%, rgba(10,10,15,0.98) 70%);
                        z-index: 9999;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        animation: overlayFadeIn 0.3s ease-out;
                    ">
                        <div style="
                            font-size: 120px;
                            animation: emojiPulse 0.5s ease-out;
                            text-shadow: 0 0 60px ${color}80;
                        ">${emoji}</div>
                        <div style="
                            font-family: 'Orbitron', sans-serif;
                            font-size: clamp(28px, 8vw, 64px);
                            font-weight: 900;
                            color: ${color};
                            text-align: center;
                            margin-top: 20px;
                            text-shadow: 0 0 30px ${color}80, 0 0 60px ${color}50;
                            animation: textSlideUp 0.4s ease-out 0.1s both;
                            letter-spacing: 4px;
                        ">${text}</div>
                        <div style="
                            font-size: clamp(14px, 3vw, 20px);
                            color: #6b7280;
                            margin-top: 16px;
                            text-align: center;
                            animation: textSlideUp 0.4s ease-out 0.2s both;
                            max-width: 80%;
                        ">${sub}</div>
                        <div style="
                            margin-top: 40px;
                            width: 200px;
                            height: 4px;
                            background: #333;
                            border-radius: 4px;
                            overflow: hidden;
                            animation: textSlideUp 0.4s ease-out 0.3s both;
                        ">
                            <div style="
                                width: 100%;
                                height: 100%;
                                background: linear-gradient(90deg, ${color}, #00f3ff);
                                animation: progressFill 1.5s ease-out forwards;
                                transform-origin: left;
                            "></div>
                        </div>
                    </div>
                    <style>
                        @keyframes overlayFadeIn { from { opacity: 0; } to { opacity: 1; } }
                        @keyframes emojiPulse { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } }
                        @keyframes textSlideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
                        @keyframes progressFill { from { transform: scaleX(0); } to { transform: scaleX(1); } }
                        @keyframes overlayFadeOut { from { opacity: 1; } to { opacity: 0; } }
                    </style>
                `;
                document.body.appendChild(overlay);
                setTimeout(() => {
                    overlay.firstElementChild.style.animation = 'overlayFadeOut 0.3s ease-out forwards';
                    setTimeout(() => overlay.remove(), 300);
                }, 2000);
            }
        };

        // --- RENDERERS ---
        const Renderers = {
            async dashboard() {
                const p = Math.min(100, Math.max(0, ((Store.state.weight - CONFIG.TARGETS.START) / (CONFIG.TARGETS.GOAL - CONFIG.TARGETS.START)) * 100));
                const fuelDone = Store.state.fuelDate === Utils.dateStr();

                // Get data
                const streak = await Store.getStreak();
                const progress = await Store.getTodayProgress();
                const todaySleep = await Store.getSleep(Utils.dateStr());
                const todayWater = await Store.getWater(Utils.dateStr());
                const nextMilestone = Store.getNextMilestone();
                const completedMilestones = Store.getCompletedMilestones();

                // Milestone progress calculation
                const prevMilestone = completedMilestones.length > 0 ? completedMilestones[completedMilestones.length - 1] : { weight: CONFIG.TARGETS.START };
                const milestoneProgress = nextMilestone ?
                    Math.min(100, Math.max(0, ((Store.state.weight - prevMilestone.weight) / (nextMilestone.weight - prevMilestone.weight)) * 100)) : 100;

                // Sleep status
                const sleepStatus = todaySleep === 0 ? { icon: 'ğŸ˜´', text: 'HenÃ¼z girilmedi', color: 'text-gray-500' } :
                    todaySleep < 6 ? { icon: 'ğŸ˜µ', text: 'Yetersiz', color: 'text-neon-red' } :
                        todaySleep < 7 ? { icon: 'ğŸ˜Š', text: 'Kabul edilebilir', color: 'text-neon-yellow' } :
                            todaySleep <= 8.5 ? { icon: 'ğŸ’ª', text: 'Optimal', color: 'text-neon-green' } :
                                { icon: 'âš ï¸', text: 'Fazla uyku', color: 'text-neon-yellow' };

                // Water status
                const waterPercent = Math.min(100, (todayWater / CONFIG.TARGETS.WATER) * 100);

                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-slide-up">
                        <!-- MILESTONE PROGRESS (NEW) -->
                        <div class="${THEME.card} lg:col-span-3 relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-r from-neon-purple/5 via-transparent to-neon-green/5"></div>
                            <div class="relative">
                                <div class="${THEME.label}">ğŸ† MILESTONE YOLCULUÄU</div>
                                <div class="flex items-center justify-between mt-4 mb-3">
                                    <div class="flex items-center gap-3">
                                        ${completedMilestones.map(m => `<span class="text-2xl" title="${m.title}">${m.icon}</span>`).join('')}
                                        ${completedMilestones.length === 0 ? '<span class="text-gray-500 text-sm">HenÃ¼z milestone yok</span>' : ''}
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-white">${nextMilestone ? nextMilestone.icon : 'ğŸ†'} ${nextMilestone ? nextMilestone.title : 'TAMAMLANDI!'}</div>
                                        <div class="text-sm text-text-muted">${nextMilestone ? `${nextMilestone.weight} kg hedef` : ''}</div>
                                    </div>
                                </div>
                                <div class="w-full bg-surface-raised h-3 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-neon-purple to-neon-green transition-all duration-1000 rounded-full" style="width: ${milestoneProgress}%"></div>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-500 mt-1">
                                    <span>${prevMilestone.weight} kg</span>
                                    <span>${nextMilestone ? nextMilestone.weight : CONFIG.TARGETS.GOAL} kg</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- STREAK CARD -->
                        <div class="${THEME.card} text-center relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-br from-neon-green/5 to-transparent"></div>
                            <div class="relative">
                                <div class="${THEME.label}">ğŸ”¥ STREAK</div>
                                <div class="text-6xl md:text-7xl font-header font-black ${streak > 0 ? 'text-neon-green' : 'text-text-muted'} leading-none">${streak}</div>
                                <div class="text-sm text-text-muted mt-3 uppercase tracking-wider">${streak > 0 ? 'GÃ¼n Ãœst Ãœste' : 'Seri KÄ±rÄ±ldÄ±'}</div>
                            </div>
                        </div>
                        
                        <!-- TODAY'S PROGRESS -->
                        <div class="${THEME.card}">
                            <div class="${THEME.label}">ğŸ“Š BUGÃœNKÃœ DURUM</div>
                            <div class="space-y-4 mt-3">
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-text-muted">GÃ¶revler</span>
                                        <span class="text-neon-green font-bold">${progress.tasksDone}/${progress.tasksTotal}</span>
                                    </div>
                                    <div class="w-full bg-surface-raised h-2 rounded-full overflow-hidden">
                                        <div class="h-full bg-neon-green rounded-full" style="width: ${progress.tasksPercent}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-text-muted">Kalori</span>
                                        <span class="text-accent-orange font-bold">${progress.calories}/${progress.caloriesTarget}</span>
                                    </div>
                                    <div class="w-full bg-surface-raised h-2 rounded-full overflow-hidden">
                                        <div class="h-full bg-accent-orange rounded-full" style="width: ${Math.min(100, progress.caloriesPercent)}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SYSTEM LOAD (WEIGHT) -->
                        <div class="${THEME.card} flex flex-col justify-between">
                            <div>
                                <div class="${THEME.label}">âš–ï¸ SYSTEM LOAD</div>
                                <div class="flex items-baseline gap-2 mt-3">
                                    <input type="number" value="${Store.state.weight}" class="bg-transparent text-5xl font-black text-white w-24 focus:text-neon-green outline-none" onchange="Actions.saveWeight(this.value)">
                                    <span class="text-text-muted text-lg">KG</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-text-muted">Hedefe</span>
                                    <span class="text-neon-green font-bold">${Math.round(p)}%</span>
                                </div>
                                <div class="w-full bg-surface-raised h-3 rounded-full overflow-hidden">
                                    <div class="h-full bg-neon-green progress-shimmer rounded-full" style="width: ${p}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SLEEP TRACKING (NEW) -->
                        <div class="${THEME.card}">
                            <div class="${THEME.label}">ğŸ˜´ UYKU TAKÄ°BÄ°</div>
                            <div class="flex items-center justify-between mt-3">
                                <div>
                                    <div class="text-4xl font-bold ${sleepStatus.color}">${todaySleep > 0 ? todaySleep : '--'} <span class="text-lg text-text-muted">saat</span></div>
                                    <div class="text-sm ${sleepStatus.color} mt-1">${sleepStatus.icon} ${sleepStatus.text}</div>
                                </div>
                                <div class="flex flex-col gap-2">
                                    <input type="number" id="sleep-input" placeholder="Saat" step="0.5" min="0" max="14" 
                                        class="w-20 bg-surface-raised text-white text-center rounded-lg p-2 text-sm" value="${todaySleep || ''}">
                                    <button onclick="Actions.saveSleep()" class="bg-neon-blue/20 hover:bg-neon-blue text-neon-blue hover:text-black px-3 py-1 rounded text-xs font-bold transition">KAYDET</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- WATER TRACKING (NEW) -->
                        <div class="${THEME.card}">
                            <div class="${THEME.label}">ğŸ’§ SU TAKÄ°BÄ°</div>
                            <div class="flex items-center justify-between mt-3">
                                <div>
                                    <div class="text-4xl font-bold ${todayWater >= CONFIG.TARGETS.WATER ? 'text-neon-blue' : 'text-white'}">${todayWater} <span class="text-lg text-text-muted">/ ${CONFIG.TARGETS.WATER}</span></div>
                                    <div class="w-32 bg-surface-raised h-2 rounded-full overflow-hidden mt-2">
                                        <div class="h-full bg-neon-blue rounded-full transition-all" style="width: ${waterPercent}%"></div>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="Actions.addWater(1)" class="bg-neon-blue/20 hover:bg-neon-blue text-neon-blue hover:text-black w-12 h-12 rounded-lg text-xl font-bold transition">+1</button>
                                    <button onclick="Actions.addWater(-1)" class="bg-gray-800 hover:bg-gray-700 text-gray-400 w-12 h-12 rounded-lg text-xl font-bold transition">-1</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FUEL STATUS -->
                        <div class="${THEME.card} ${!fuelDone ? 'ring-2 ring-neon-red/50' : ''} relative">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="${THEME.label}">â›½ FUEL STATUS</div>
                                    <div class="text-xl font-bold text-white mt-2">GAINER SHAKE</div>
                                    <div class="text-text-muted text-sm mt-1">SÃ¼t + Yulaf + FÄ±stÄ±k + Muz</div>
                                </div>
                                <button onclick="Actions.injectFuel()" class="${fuelDone ? 'bg-neon-green text-gunmetal' : 'bg-neon-red text-white'} px-4 py-2 rounded-lg font-bold text-xs uppercase transition-all hover:scale-105">
                                    ${fuelDone ? 'âœ“ OK' : 'âš  BEKLÄ°YOR'}
                                </button>
                            </div>
                        </div>
                    </div>`;
            },
            async training() {
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];
                const done = await Store.getWorkout(Utils.dateStr());
                const workoutData = await Store.getWorkoutData(Utils.dateStr());
                const btnClass = "bg-gray-800 hover:bg-neon-blue hover:text-black text-neon-blue border border-neon-blue font-bold py-3 px-6 rounded transition w-full mb-6 flex items-center justify-center gap-2 shadow-[0_0_15px_rgba(0,243,255,0.2)]";

                return `<div class="animate-slide-up">
                    <div class="flex justify-between items-end mb-6 border-b border-gray-800 pb-4">
                        <div><h2 class="text-3xl font-header font-bold text-white">${plan.name}</h2><div class="text-neon-green tracking-widest text-xs mt-1">${plan.title}</div></div>
                        <div class="text-xl font-mono text-white">0${day}</div>
                    </div>
                    <button onclick="Actions.openWarmup()" class="${btnClass}"><i class="fas fa-fire animate-pulse"></i> SYSTEM BOOT (ISINMA)</button>
                    <div class="space-y-4">
                        ${plan.tasks.map(tid => {
                    const ex = DB.EXERCISES[tid];
                    const isDone = done.includes(tid);
                    const logs = workoutData[tid] || [];

                    // Parse Target Sets from description
                    const targetMatch = ex.desc.match(/(\d+)\s*Set/i);
                    const targetSets = targetMatch ? parseInt(targetMatch[1]) : 3;

                    let setsHtml = '';
                    let completedSets = 0;
                    for (let i = 0; i < targetSets; i++) {
                        const log = logs[i] || {};
                        const isSetDone = !!log.completed;
                        if (isSetDone) completedSets++;
                        setsHtml += `
                            <div class="flex items-center gap-3 p-3 rounded-lg ${isSetDone ? 'bg-neon-green/10 border border-neon-green/30' : 'bg-gray-800/50 border border-gray-700'} transition-all">
                                <div class="flex items-center justify-center w-12 h-10 rounded-lg ${isSetDone ? 'bg-neon-green text-black' : 'bg-gray-700 text-gray-400'} font-bold text-xs">
                                    SET ${i + 1}
                                </div>
                                <div class="flex-1 flex items-center gap-2">
                                    <div class="flex-1">
                                        <label class="text-[9px] text-gray-500 block mb-1">AÄIRLIK</label>
                                        <input type="number" placeholder="0" value="${log.weight || ''}" id="w-${tid}-${i}" 
                                            class="w-full bg-gray-900 text-white rounded-lg p-2 text-center text-lg font-bold border-2 ${isSetDone ? 'border-neon-green text-neon-green' : 'border-gray-600 focus:border-neon-blue'} outline-none transition-all" 
                                            onchange="Actions.saveSet('${tid}', ${i}, false)">
                                    </div>
                                    <div class="text-gray-600 text-lg font-bold">Ã—</div>
                                    <div class="flex-1">
                                        <label class="text-[9px] text-gray-500 block mb-1">TEKRAR</label>
                                        <input type="number" placeholder="0" value="${log.reps || ''}" id="r-${tid}-${i}" 
                                            class="w-full bg-gray-900 text-white rounded-lg p-2 text-center text-lg font-bold border-2 ${isSetDone ? 'border-neon-green text-neon-green' : 'border-gray-600 focus:border-neon-blue'} outline-none transition-all" 
                                            onchange="Actions.saveSet('${tid}', ${i}, false)">
                                    </div>
                                </div>
                                <button onclick="Actions.saveSet('${tid}', ${i}, true)" 
                                    class="w-12 h-12 rounded-xl flex-shrink-0 flex items-center justify-center text-lg ${isSetDone ? 'bg-neon-green text-black shadow-[0_0_15px_rgba(0,255,65,0.3)]' : 'bg-gray-700 text-gray-400 hover:bg-neon-green/20 hover:text-neon-green hover:border-neon-green'} border-2 border-transparent transition-all">
                                    <i class="fas ${isSetDone ? 'fa-check' : 'fa-arrow-right'}"></i>
                                </button>
                            </div>
                        `;
                    }

                    // Ä°lerleme yÃ¼zdesini hesapla
                    const progressPercent = targetSets > 0 ? Math.round((completedSets / targetSets) * 100) : 0;

                    return `
                            <div class="bg-gray-900 border-2 ${isDone ? 'border-neon-green shadow-[0_0_15px_rgba(0,255,65,0.15)]' : 'border-gray-700'} rounded-xl overflow-hidden transition-all">
                                <div class="p-4 cursor-pointer hover:bg-gray-800/50 flex justify-between items-center" onclick="Actions.toggleExerciseBody('${tid}')">
                                    <div class="flex items-center gap-3">
                                        <div class="w-3 h-3 rounded-full ${isDone ? 'bg-neon-green shadow-[0_0_8px_rgba(0,255,65,0.5)]' : 'bg-gray-600'} transition-all"></div>
                                        <div>
                                            <div class="font-bold text-white text-base">${ex.title}</div>
                                            <div class="text-xs text-gray-500 mt-0.5">
                                                <span class="${progressPercent === 100 ? 'text-neon-green' : progressPercent > 0 ? 'text-neon-blue' : ''}">%${progressPercent}</span> | 
                                                ${targetSets} Set | ${ex.tags.join(', ')}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        ${isDone ? '<span class="text-[10px] text-neon-green font-bold bg-neon-green/10 px-2 py-1 rounded">TAMAM</span>' : ''}
                                        <i class="fas fa-chevron-down text-gray-500 transition-transform duration-300" id="icon-${tid}"></i>
                                    </div>
                                </div>
                                <div id="body-${tid}" class="hidden bg-black/30 p-5 border-t border-gray-800">
                                    <div class="flex justify-between items-start mb-5">
                                        <div class="text-sm text-gray-300 p-4 bg-gray-800/70 rounded-xl border-l-4 border-neon-blue flex-1 mr-4 leading-relaxed">${ex.desc}</div>
                                        <button onclick="event.stopPropagation(); Actions.showExercise('${tid}')" class="flex-shrink-0 w-12 h-12 rounded-xl bg-neon-blue/10 hover:bg-neon-blue/30 border-2 border-neon-blue/50 text-neon-blue flex items-center justify-center transition-all hover:scale-105" title="DetaylÄ± Bilgi & PR">
                                            <i class="fas fa-info-circle text-lg"></i>
                                        </button>
                                    </div>
                                    <div class="space-y-3">
                                        ${setsHtml}
                                    </div>
                                </div>
                            </div>`;
                }).join('')}
                    </div>
                </div>`;
            },
            async nutrition() {
                const meals = await Store.getMeals(Utils.dateStr());
                let t = { c: 0, p: 0, carb: 0, f: 0 };
                const list = meals.map((m, idx) => {
                    t.c += m.cal; t.p += m.prot; t.carb += m.carb; t.f += m.fat;
                    let amountDisplay = "";
                    if (m.unit === 'portion') {
                        amountDisplay = `(${m.portionLabel})`;
                    } else {
                        amountDisplay = `(${m.amount} ${m.unit || 'Adet'})`;
                    }
                    return `<div class="meal-item flex justify-between items-center text-xs bg-gray-900 p-3 rounded mb-1 border border-gray-800 group"><div><span class="text-white font-bold">${m.name}</span> <span class="text-gray-500 text-[10px]">${amountDisplay}</span></div><div class="flex items-center gap-3"><span class="text-neon-green font-mono">${m.cal} kcal</span><button onclick="Actions.deleteMeal(${idx})" class="text-red-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition" title="Sil"><i class="fas fa-trash-alt"></i></button></div></div>`;
                }).join('') || '<div class="text-center text-gray-600 py-4 border-2 border-dashed border-gray-800 rounded">HENÃœZ YAKIT GÄ°RÄ°LMEDÄ°<br><span class="text-[10px] text-neon-red">SÄ°STEM ZAYIFLIYOR!</span></div>';

                // BRUTAL REALITY LOGIC
                let feedbackBox = "";
                const targetCal = CONFIG.TARGETS.CAL;

                if (t.c < targetCal) {
                    const threats = [
                        "UYARI: Yetersiz YakÄ±t. Testosteron Ã¼retimi durduruluyor. Libido %0'a iniyor.",
                        "KRÄ°TÄ°K: Kas YÄ±kÄ±mÄ± (Katabolizma) BaÅŸladÄ±. Kendi bacaklarÄ±nÄ± yiyorsun.",
                        "HATA: Beyin Sisi AlgÄ±landÄ±. Kodlama yeteneÄŸin dÃ¼ÅŸÃ¼yor."
                    ];
                    const randomThreat = threats[Math.floor(Math.random() * threats.length)];
                    feedbackBox = `<div class="mt-4 p-4 border-2 border-red-600 bg-red-900/20 rounded text-center animate-pulse-urgent"><div class="text-red-500 font-bold text-lg mb-1"><i class="fas fa-skull"></i> SÄ°STEM TEHLÄ°KEDE</div><div class="text-gray-300 text-xs">${randomThreat}</div></div>`;
                } else {
                    feedbackBox = `<div class="mt-4 p-4 border-2 border-neon-green bg-green-900/20 rounded text-center"><div class="text-neon-green font-bold text-lg mb-1"><i class="fas fa-check-circle"></i> SÄ°STEM OPTÄ°MUM</div><div class="text-gray-300 text-xs">BÃ¼yÃ¼me Hormonu (HGH) Aktif. Ä°nÅŸaat sÃ¼rÃ¼yor.</div></div>`;
                }

                const plan = Store.state.dailyPlan || {};
                let totalPlanCal = 0;
                ['breakfast', 'fuel', 'lunch', 'pre_workout', 'dinner', 'night'].forEach(k => { if (plan[k]) totalPlanCal += plan[k].kcal; });

                return `<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-slide-up"><div class="${THEME.card} h-fit"><span class="text-[10px] text-gray-500 font-bold">GÃœNLÃœK HEDEF</span><div class="text-4xl font-bold text-white mt-2">${t.c} <span class="text-sm text-gray-500">/ ${targetCal}</span></div><div class="h-2 w-full bg-gray-900 rounded-full mt-2 mb-4 overflow-hidden"><div class="h-full bg-neon-green" style="width:${Math.min(100, (t.c / targetCal) * 100)}%"></div></div>${feedbackBox}<div class="grid grid-cols-3 gap-2 text-center text-xs mb-4 mt-6"><div class="bg-gray-900 p-2 rounded"><div class="text-gray-500">PROT</div><div class="text-neon-blue font-bold">${t.p}/${CONFIG.TARGETS.PROT}</div></div><div class="bg-gray-900 p-2 rounded"><div class="text-gray-500">CARB</div><div class="text-neon-orange font-bold">${t.carb}/${CONFIG.TARGETS.CARB}</div></div><div class="bg-gray-900 p-2 rounded"><div class="text-gray-500">FAT</div><div class="text-neon-yellow font-bold">${t.f}/${CONFIG.TARGETS.FAT}</div></div></div><button onclick="Actions.openMealModal()" class="${THEME.btn} w-full">Ã–ÄÃœN EKLE</button></div><div class="col-span-2 ${THEME.card} flex flex-col"><div class="flex justify-between mb-4 items-center"><span class="text-[10px] text-gray-500 font-bold">GÃœNLÃœK PLAN (${totalPlanCal} kcal)</span><div class="flex gap-4 items-center"><button onclick="Actions.rerollPlan()" class="text-xs text-neon-blue hover:text-white font-bold"><i class="fas fa-sync-alt mr-1"></i> MENÃœYÃœ YENÄ°LE</button><span class="text-[10px] text-gray-500">${Utils.dateStr()}</span></div></div>
                <div class="mb-4 bg-gray-900/50 p-3 rounded border border-gray-700 text-xs text-gray-300">
                    <div class="font-bold text-neon-green mb-2">âš¡ OPERASYONEL BESLENME PLANI</div>
                    <ul class="space-y-2">
                        <li class="flex gap-2"><span class="text-gray-500 w-10">08:00</span> <span class="text-white font-bold">${plan.breakfast ? plan.breakfast.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">11:00</span> <span class="text-neon-yellow font-bold">${plan.fuel ? plan.fuel.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">14:00</span> <span class="text-white">${plan.lunch ? plan.lunch.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">17:00</span> <span class="text-white">${plan.pre_workout ? plan.pre_workout.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">19:00</span> <span class="text-white">${plan.dinner ? plan.dinner.text : '...'}</span></li>
                        <li class="flex gap-2"><span class="text-gray-500 w-10">23:00</span> <span class="text-white">${plan.night ? plan.night.text : '...'}</span></li>
                    </ul>
                </div>
                <div class="overflow-y-auto flex-1 h-[200px] custom-scrollbar">${list}</div></div></div>`;
            },

            async progress() {
                const hist = await Store.getHistory();
                const statsData = await Store.getStats();
                const volStats = await Store.getVolumeStats();
                const stats = statsData.current || {};
                const measureHistory = statsData.history || [];
                const dates = Object.keys(hist).sort().slice(-7);
                const volDates = Object.keys(volStats.daily).sort();

                // v5.8.0: Weekly Summary
                const weeklySummary = await Store.getWeeklySummary();

                // Turkish month names
                const months = ['Oca', 'Åub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'AÄŸu', 'Eyl', 'Eki', 'Kas', 'Ara'];

                // Weight history bars with values
                let weightBars = '';
                let dateLabels = '';
                let weightHistoryTable = '';

                if (dates.length > 0) {
                    weightBars = dates.map(d => {
                        const h = ((hist[d] - CONFIG.TARGETS.START) / (CONFIG.TARGETS.GOAL - CONFIG.TARGETS.START)) * 70 + 15;
                        return `<div class="flex-1 flex flex-col items-center">
                            <div class="text-[9px] text-neon-green font-bold mb-1">${hist[d]}</div>
                            <div class="w-full bg-gray-800 hover:bg-neon-green/50 rounded-t transition-all" style="height:${h}%"></div>
                        </div>`;
                    }).join('');

                    dateLabels = dates.map((d, i) => {
                        const parts = d.split('-');
                        const day = parts[2];
                        const monthIdx = parseInt(parts[1]) - 1;
                        const showMonth = (i === 0 || i === dates.length - 1);
                        return `<div class="flex-1 text-center text-[8px] text-gray-500">${day}${showMonth ? ' ' + months[monthIdx] : ''}</div>`;
                    }).join('');

                    const sortedDates = [...dates].reverse();
                    weightHistoryTable = `
                        <div class="mt-3 pt-3 border-t border-gray-800">
                            <div class="text-[9px] text-gray-500 font-bold mb-2">KAYIT GEÃ‡MÄ°ÅÄ°</div>
                            <div class="space-y-1 max-h-20 overflow-y-auto custom-scrollbar">
                                ${sortedDates.map((d, i) => {
                        const weight = hist[d];
                        const prevDate = sortedDates[i + 1];
                        const prevWeight = prevDate ? hist[prevDate] : null;
                        let change = '';
                        if (prevWeight !== null) {
                            const diff = weight - prevWeight;
                            if (diff > 0) change = `<span class="text-neon-green">+${diff.toFixed(1)}</span>`;
                            else if (diff < 0) change = `<span class="text-neon-red">${diff.toFixed(1)}</span>`;
                            else change = `<span class="text-gray-500">=</span>`;
                        }
                        const parts = d.split('-');
                        const dateStr = parts[2] + ' ' + months[parseInt(parts[1]) - 1];
                        return `<div class="flex justify-between text-[10px] bg-gray-900/50 px-2 py-1 rounded">
                                        <span class="text-gray-500">${dateStr}</span>
                                        <span class="text-white font-bold">${weight} kg</span>
                                        <span class="w-10 text-right">${change}</span>
                                    </div>`;
                    }).join('')}
                            </div>
                        </div>
            `;
                } else {
                    weightBars = '<div class="text-gray-600 text-xs w-full text-center self-center flex flex-col items-center justify-center h-full"><i class="fas fa-weight text-3xl mb-2 opacity-30"></i><span>Veri yok</span><span class="text-[10px] text-gray-700 mt-1">Dashboard\'dan kilo girin</span></div>';
                }

                // --- VOLUME CHART (PHASE 2) ---
                let volumeChart = '';
                if (volStats.weekly > 0) {
                    const maxVol = Math.max(...Object.values(volStats.daily), 1);
                    volumeChart = volDates.map(d => {
                        const val = volStats.daily[d] || 0;
                        const h = (val / maxVol) * 80;
                        const parts = d.split('-');
                        const day = parts[2];
                        return `<div class="flex-1 flex flex-col items-center group">
                            <div class="text-[8px] text-neon-blue font-bold mb-1 opacity-0 group-hover:opacity-100 transition">${val > 0 ? Math.round(val) : ''}</div>
                            <div class="w-full bg-gray-800 hover:bg-neon-blue/60 rounded-t transition-all" style="height:${Math.max(5, h)}%"></div>
                            <div class="text-[8px] text-gray-500 mt-1">${day}</div>
                        </div>`;
                    }).join('');
                } else {
                    volumeChart = '<div class="text-gray-600 text-xs w-full text-center flex flex-col items-center justify-center h-full"><i class="fas fa-dumbbell text-3xl mb-2 opacity-30"></i><span>HenÃ¼z antrenman verisi yok</span></div>';
                }

                // Trend helper function
                const getTrend = (key) => {
                    if (measureHistory.length === 0) return { icon: '', color: '', diff: 0 };
                    const last = measureHistory[measureHistory.length - 1];
                    const current = parseFloat(stats[key]) || 0;
                    const prev = parseFloat(last[key]) || 0;
                    if (current === 0 || prev === 0) return { icon: '', color: '', diff: 0 };
                    const diff = current - prev;
                    if (diff > 0) return { icon: 'â†‘', color: key === 'waist' ? 'text-neon-red' : 'text-neon-green', diff: diff.toFixed(1) };
                    if (diff < 0) return { icon: 'â†“', color: key === 'waist' ? 'text-neon-green' : 'text-neon-red', diff: Math.abs(diff).toFixed(1) };
                    return { icon: '=', color: 'text-gray-500', diff: 0 };
                };

                const labels = { chest: 'GÃ–ÄÃœS', arm: 'KOL', waist: 'BEL', leg: 'BACAK' };
                const savedAt = stats.savedAt || null;
                const savedInfo = savedAt ? `<span class="text-neon-green text-[10px]">âœ“ ${savedAt}</span>` : '<span class="text-gray-600 text-[10px]">HenÃ¼z kayÄ±t yok</span>';

                const getMiniChart = (key) => {
                    if (measureHistory.length < 2) return '';
                    const lastFive = measureHistory.slice(-5);
                    const values = lastFive.map(h => parseFloat(h[key]) || 0).filter(v => v > 0);
                    if (values.length < 2) return '';
                    const max = Math.max(...values);
                    const min = Math.min(...values);
                    const range = max - min || 1;
                    const bars = values.map(v => {
                        const height = ((v - min) / range) * 20 + 5;
                        return `<div class="w-1 bg-neon-blue/60 rounded-t" style="height:${height}px"></div>`;
                    }).join('');
                    return `<div class="flex items-end gap-0.5 h-6">${bars}</div>`;
                };

                const measurementInputs = ['chest', 'arm', 'waist', 'leg'].map(k => {
                    const trend = getTrend(k);
                    const miniChart = getMiniChart(k);
                    return `
                        <div class="bg-surface-raised p-3 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-[10px] text-gray-500 font-bold uppercase">${labels[k]}</label>
                                <div class="flex items-center gap-2">
                                    ${miniChart}
                                    ${trend.icon ? `<span class="${trend.color} text-xs font-bold">${trend.icon}${trend.diff > 0 ? trend.diff : ''}</span>` : ''}
                                </div>
                            </div>
                            <input type="number" id="stat-${k}" value="${stats[k] || ''}" placeholder="cm" class="${THEME.input} text-center text-lg font-bold">
                        </div>
                    `;
                }).join('');

                let historySection = '';
                if (measureHistory.length > 0) {
                    const lastThree = measureHistory.slice(-3).reverse();
                    historySection = `
                        <div class="mt-4 pt-4 border-t border-gray-800">
                            <div class="text-[10px] text-gray-500 font-bold mb-2">SON KAYITLAR</div>
                            <div class="space-y-1 text-[10px]">
                                ${lastThree.map(h => `
                                    <div class="flex justify-between text-gray-400 bg-gray-900/50 p-2 rounded">
                                        <span class="text-gray-600">${h.date}</span>
                                        <span>G:${h.chest || '-'} K:${h.arm || '-'} B:${h.waist || '-'} B:${h.leg || '-'}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
            `;
                }

                return `
                <div class="space-y-6 animate-slide-up">
                    <!-- SUMMARY ROW -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="${THEME.card} text-center py-4">
                            <div class="text-[10px] text-gray-500 font-bold">MEVCUT KÄ°LO</div>
                            <div class="text-2xl font-bold text-white mt-1">${Store.state.weight} <span class="text-sm text-neon-green">kg</span></div>
                        </div>
                        <div class="${THEME.card} text-center py-4 border-neon-blue/30">
                            <div class="text-[10px] text-neon-blue font-bold">HAFTALIK HACÄ°M</div>
                            <div class="text-2xl font-bold text-white mt-1">${(volStats.weekly / 1000).toFixed(1)} <span class="text-sm text-gray-500">ton</span></div>
                        </div>
                        <div class="${THEME.card} text-center py-4">
                            <div class="text-[10px] text-gray-500 font-bold">HEDEF</div>
                            <div class="text-2xl font-bold text-neon-green mt-1">${CONFIG.TARGETS.GOAL} <span class="text-sm">kg</span></div>
                        </div>
                        <div class="${THEME.card} text-center py-4">
                            <div class="text-[10px] text-gray-500 font-bold">BUGÃœN TONAJ</div>
                            <div class="text-2xl font-bold text-neon-blue mt-1">${Math.round(volStats.daily[Utils.dateStr()] || 0)} <span class="text-sm text-gray-500">kg</span></div>
                        </div>
                    </div>

                    <!--VOLUME ANALYSIS-- >
                    <div class="${THEME.card}">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <span class="text-neon-blue font-bold text-sm">ANTRENMAN HACMÄ°</span>
                                <span class="text-[10px] text-gray-500 ml-2">Son 7 GÃ¼n</span>
                            </div>
                            <div class="text-xs text-gray-500">${volStats.weekly > 0 ? `Toplam: ${(volStats.weekly / 1000).toFixed(2)} ton` : ''}</div>
                        </div>
                        <div class="flex items-end gap-1 h-28">${volumeChart}</div>
                    </div>
                    
                    <!-- v5.8.0: WEEKLY SUMMARY -->
                    <div class="${THEME.card}">
                        <div class="${THEME.label}">ğŸ“… HAFTALIK Ã–ZET (Son 4 Hafta)</div>
                        <div class="overflow-x-auto mt-4">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="text-gray-500 text-xs border-b border-gray-800">
                                        <th class="text-left py-2">Hafta</th>
                                        <th class="text-center py-2">Ort. Kalori</th>
                                        <th class="text-center py-2">Antrenman</th>
                                        <th class="text-right py-2">Kilo Î”</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${weeklySummary.map((w, i) => `
                                        <tr class="border-b border-gray-800/50 ${i === 0 ? 'bg-gray-800/30' : ''}">
                                            <td class="py-2 ${i === 0 ? 'text-neon-green font-bold' : 'text-gray-400'}">${i === 0 ? 'Bu Hafta' : i === 1 ? 'GeÃ§en Hafta' : `${w.week}. Hafta Ã–nce`}</td>
                                            <td class="text-center py-2 font-mono ${w.avgCal >= CONFIG.TARGETS.CAL ? 'text-neon-green' : w.avgCal > 0 ? 'text-accent-orange' : 'text-gray-600'}">${w.avgCal > 0 ? w.avgCal : '-'}</td>
                                            <td class="text-center py-2">${w.workoutDays > 0 ? `<span class="text-neon-blue font-bold">${w.workoutDays}</span> gÃ¼n` : '<span class="text-gray-600">-</span>'}</td>
                                            <td class="text-right py-2 font-mono ${w.weightChange > 0 ? 'text-neon-green' : w.weightChange < 0 ? 'text-neon-red' : 'text-gray-500'}">${w.weightChange !== null ? (w.weightChange > 0 ? '+' : '') + w.weightChange + ' kg' : '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- WEIGHT HISTORY -->
                        <div class="${THEME.card} flex flex-col">
                            <span class="text-[10px] text-gray-500 font-bold mb-2">AÄIRLIK GEÃ‡MÄ°ÅÄ° (Son 7 GÃ¼n)</span>
                            <div class="flex items-end gap-1 h-32 border-b border-gray-800">${weightBars}</div>
                            <div class="flex gap-1 mt-1">${dateLabels}</div>
                            ${weightHistoryTable}
                        </div>

                        <!-- MEASUREMENTS -->
                        <div class="${THEME.card}">
                            <div class="flex justify-between mb-4 items-center">
                                <div>
                                    <span class="text-[10px] text-gray-500 font-bold block">Ã–LÃ‡ÃœLER (CM)</span>
                                    ${savedInfo}
                                </div>
                                <button onclick="Actions.saveStats()" class="bg-neon-green/20 hover:bg-neon-green text-neon-green hover:text-black text-xs font-bold px-4 py-2 rounded-lg transition-all">
                                    <i class="fas fa-save mr-1"></i>KAYDET
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-3">${measurementInputs}</div>
                            ${historySection}
                        </div>
                    </div>
                </div>`;
            },

            async anatomy() {
                const view = UI.activeView;
                const paths = {
                    front: `<path d="M60,50 Q100,70 140,50 L135,90 Q100,100 65,90 Z" class="muscle-path" onclick="Actions.selectMuscle('chest')"></path><rect x="80" y="95" width="40" height="55" rx="5" class="muscle-path" onclick="Actions.selectMuscle('abs')"></rect><path d="M65,160 L90,160 L85,240 L60,240 Z" class="muscle-path" onclick="Actions.selectMuscle('quads')"></path><path d="M110,160 L135,160 L140,240 L115,240 Z" class="muscle-path" onclick="Actions.selectMuscle('quads')"></path><ellipse cx="45" cy="70" rx="10" ry="20" class="muscle-path" onclick="Actions.selectMuscle('biceps')"></ellipse><ellipse cx="155" cy="70" rx="10" ry="20" class="muscle-path" onclick="Actions.selectMuscle('biceps')"></ellipse><path d="M85,158 L115,158 L100,183 Z" fill="#ff003c" opacity="0.5" onclick="Actions.selectMuscle('pelvic')" class="cursor-pointer hover:opacity-100"></path>`,
                    back: `<path d="M70,40 L100,20 L130,40 L100,60 Z" class="muscle-path" onclick="Actions.selectMuscle('traps')"></path><path d="M60,60 L40,100 L100,125 L160,100 L140,60 L100,60 Z" class="muscle-path" onclick="Actions.selectMuscle('lats')"></path><rect x="85" y="128" width="30" height="22" class="muscle-path" onclick="Actions.selectMuscle('lowerback')"></rect><path d="M70,150 Q100,170 130,150 L130,190 Q100,210 70,190 Z" class="muscle-path" onclick="Actions.selectMuscle('glutes')"></path><rect x="75" y="200" width="20" height="60" class="muscle-path" onclick="Actions.selectMuscle('hamstrings')"></rect><rect x="105" y="200" width="20" height="60" class="muscle-path" onclick="Actions.selectMuscle('hamstrings')"></rect>`
                };
                const sel = Store.state.selectedMuscle ? DB.ANATOMY_DB[Store.state.selectedMuscle] : null;
                return `<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-slide-up h-full"><div class="${THEME.card} flex flex-col items-center justify-center anatomy-grid min-h-[400px] relative"><div class="absolute top-4 left-4 flex gap-2"><button onclick="Actions.setAnatomyView('front')" class="px-4 py-2 text-xs font-bold border ${view === 'front' ? 'border-neon-green text-neon-green bg-neon-green/10' : 'border-gray-700 text-gray-500 hover:border-gray-500'} rounded-lg transition-all">Ã–N</button><button onclick="Actions.setAnatomyView('back')" class="px-4 py-2 text-xs font-bold border ${view === 'back' ? 'border-neon-green text-neon-green bg-neon-green/10' : 'border-gray-700 text-gray-500 hover:border-gray-500'} rounded-lg transition-all">ARKA</button></div><div class="relative w-64 h-96"><svg viewBox="0 0 200 300" class="w-full h-full drop-shadow-[0_0_15px_rgba(0,255,65,0.1)]"><path d="M100,20 L120,25 L130,40 L160,45 L150,100 L160,150 L140,280 L130,290 L100,250 L70,290 L60,280 L40,150 L50,100 L40,45 L70,40 L80,25 Z" fill="#111" stroke="#333" stroke-width="2"/>${paths[view]}</svg></div></div><div class="${THEME.card} relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-neon-blue via-neon-green to-neon-blue"></div><div class="${THEME.label} text-neon-blue mb-6">DIAGNOSTIC PANEL</div>${sel ? `<div class="space-y-6"><div class="mb-6"><h2 class="text-3xl md:text-4xl font-header font-bold text-white mb-2">${sel.name}</h2><div class="text-sm text-gray-400 font-mono tracking-wide">// ${sel.system}</div></div><div class="grid gap-4"><div class="bg-surface-raised p-4 rounded-lg border-l-4 border-neon-green"><div class="${THEME.label} mb-2">GÃ–REV</div><div class="text-base text-gray-200">${sel.function}</div></div><div class="bg-surface-raised p-4 rounded-lg border-l-4 border-accent-orange"><div class="${THEME.label} mb-2">HARDENING PROTOCOL</div><div class="text-lg text-accent-orange font-bold font-mono">${sel.action}</div></div><div class="bg-surface-raised p-4 rounded-lg border border-gray-700/50"><div class="flex justify-between items-center"><div><div class="${THEME.label} mb-1">RECOVERY TIME</div><div class="text-xl text-neon-blue font-bold">${sel.recovery}</div></div><i class="fas fa-clock text-neon-blue/30 text-3xl"></i></div></div></div></div>` : '<div class="h-full flex flex-col items-center justify-center text-gray-600"><i class="fas fa-fingerprint text-6xl mb-6 opacity-30"></i><p class="text-sm uppercase tracking-widest">Kas SeÃ§imi Bekleniyor...</p></div>'}</div></div>`;
            },
            async mental() {
                // Faz ikonlarÄ±
                const phaseIcons = ['ğŸ†', 'ğŸ­', 'ğŸ¤–', 'ğŸ”§', 'âš¡', 'ğŸ¯', 'ğŸ€', 'ğŸ”„'];

                // Mental progress verisini al
                const mentalData = await Utils.storage.get(CONFIG.KEYS.MENTAL_PROGRESS) || {
                    completedPhases: [],
                    dailyPractice: {},
                    lastPracticeDate: null
                };

                // GÃ¼nÃ¼n fazÄ± (sÄ±rayla dÃ¶ner)
                const dayOfYear = Math.floor((Date.now() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
                const todayPhaseIndex = dayOfYear % 8;
                const todayPhase = DB.MENTAL_PHASES[todayPhaseIndex];

                // Ä°lerleme yÃ¼zdesi
                const completedCount = mentalData.completedPhases?.length || 0;
                const progressPercent = Math.round((completedCount / 8) * 100);

                // Rastgele gÃ¼nlÃ¼k pratik
                const allPractices = DB.MENTAL_PHASES.flatMap((p, idx) =>
                    p.practice.map(pr => ({ text: pr, phaseId: p.id, icon: phaseIcons[idx] }))
                );
                const dailyPractice = allPractices[dayOfYear % allPractices.length];
                const practiceKey = Utils.dateStr();
                const isPracticeDone = mentalData.dailyPractice?.[practiceKey] === true;

                // Faz kartlarÄ±
                const phaseCards = DB.MENTAL_PHASES.map((p, idx) => {
                    const icon = phaseIcons[idx];
                    const isCompleted = mentalData.completedPhases?.includes(p.id);
                    const isToday = idx === todayPhaseIndex;

                    return `
                        <div class="group relative bg-gradient-to-br ${isToday ? 'from-purple-900/40 to-gray-900' : 'from-gray-900 to-gray-800'} 
                            border-2 ${isToday ? 'border-neon-purple shadow-[0_0_20px_rgba(168,85,247,0.2)]' : isCompleted ? 'border-neon-green/50' : 'border-gray-700'} 
                            rounded-2xl p-5 transition-all hover:border-neon-purple/80 hover:shadow-[0_0_15px_rgba(168,85,247,0.15)] cursor-pointer"
                            onclick="Actions.showPhase(${p.id})">
                            
                            ${isToday ? '<div class="absolute -top-2 -right-2 bg-neon-purple text-black text-[9px] font-bold px-2 py-0.5 rounded-full animate-pulse">BUGÃœN</div>' : ''}
                            ${isCompleted ? '<div class="absolute top-3 right-3 text-neon-green text-lg">âœ“</div>' : ''}
                            
                            <div class="flex items-start gap-4">
                                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-600/20 to-blue-600/20 border border-purple-500/30 
                                    flex items-center justify-center text-3xl ${isToday ? 'animate-pulse' : ''} 
                                    group-hover:scale-110 transition-transform">
                                    ${icon}
                                </div>
                                <div class="flex-1">
                                    <div class="text-[10px] text-purple-400 font-mono mb-1">FAZ ${p.id}</div>
                                    <div class="font-bold text-white text-base group-hover:text-purple-200 transition">${p.title.replace(/FAZ \d+: /, '')}</div>
                                    <div class="text-xs text-gray-400 mt-2 leading-relaxed">${p.desc}</div>
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t border-gray-700/50 flex justify-between items-center">
                                <div class="text-[10px] text-gray-500">
                                    <i class="fas fa-list-check mr-1"></i>${p.strategy.length} Strateji â€¢ ${p.practice.length} Pratik
                                </div>
                                <div class="text-neon-purple text-xs font-bold flex items-center gap-1 opacity-0 group-hover:opacity-100 transition">
                                    DETAY <i class="fas fa-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="animate-slide-up space-y-6">
                        <!-- Header -->
                        <div class="flex items-center justify-between border-b border-gray-800 pb-4">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center">
                                    <i class="fas fa-brain text-white text-xl"></i>
                                </div>
                                <div>
                                    <h2 class="font-header font-bold text-white text-xl">ZÄ°HÄ°NSEL SAVAÅ</h2>
                                    <div class="text-xs text-gray-500">Mental Hardening ProtokolÃ¼ v5.9.4</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${progressPercent === 100 ? 'text-neon-green' : 'text-neon-purple'}">${progressPercent}%</div>
                                <div class="text-[10px] text-gray-500">${completedCount}/8 Faz</div>
                            </div>
                        </div>
                        
                        <!-- GÃ¼nÃ¼n FazÄ± Spotlight -->
                        <div class="bg-gradient-to-r from-purple-900/30 via-gray-900 to-pink-900/30 rounded-2xl p-6 border border-purple-500/30 relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl"></div>
                            <div class="relative z-10">
                                <div class="text-[10px] text-purple-400 font-bold tracking-widest mb-3">
                                    <i class="fas fa-star mr-1"></i>GÃœNÃœN FAZI
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="text-5xl">${phaseIcons[todayPhaseIndex]}</div>
                                    <div>
                                        <div class="text-xl font-bold text-white">${todayPhase.title}</div>
                                        <div class="text-sm text-gray-400 mt-1">${todayPhase.desc}</div>
                                    </div>
                                </div>
                                <button onclick="Actions.showPhase(${todayPhase.id})" 
                                    class="mt-4 px-4 py-2 bg-purple-600/20 border border-purple-500/50 rounded-lg text-purple-300 text-sm font-bold hover:bg-purple-600/40 transition">
                                    <i class="fas fa-book-open mr-2"></i>FazÄ± Ä°ncele
                                </button>
                            </div>
                        </div>
                        
                        <!-- GÃ¼nlÃ¼k Pratik -->
                        <div class="bg-gray-900 rounded-xl p-5 border ${isPracticeDone ? 'border-neon-green' : 'border-gray-700'}">
                            <div class="flex items-center justify-between mb-3">
                                <div class="text-[10px] text-gray-500 font-bold tracking-widest">
                                    <i class="fas fa-bolt text-neon-yellow mr-1"></i>GÃœNLÃœK PRATÄ°K
                                </div>
                                ${isPracticeDone ? '<span class="text-neon-green text-xs font-bold">âœ“ TAMAMLANDI</span>' : ''}
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="text-2xl">${dailyPractice.icon}</div>
                                <div class="flex-1">
                                    <div class="text-sm text-gray-300 leading-relaxed">${dailyPractice.text}</div>
                                    <div class="text-[10px] text-gray-600 mt-2">Faz ${dailyPractice.phaseId}</div>
                                </div>
                            </div>
                            ${!isPracticeDone ? `
                                <button onclick="Actions.completeDailyPractice()" 
                                    class="mt-4 w-full py-3 bg-neon-green/10 border-2 border-neon-green text-neon-green font-bold rounded-xl hover:bg-neon-green hover:text-black transition-all">
                                    <i class="fas fa-check mr-2"></i>Bunu YaptÄ±m!
                                </button>
                            ` : ''}
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="bg-gray-800/50 rounded-full h-3 overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-purple-600 to-pink-500 transition-all duration-500" 
                                style="width: ${progressPercent}%"></div>
                        </div>
                        
                        <!-- Faz KartlarÄ± Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${phaseCards}
                        </div>
                    </div>
                `;
            }
        };

        // --- ACTIONS ---
        const Actions = {
            async switchTab(id) {
                Store.state.activeTab = id;
                UI.updateTab(id);
                document.getElementById('view-container').innerHTML = await Renderers[id]();
                if (id === 'nutrition') {
                    // Nutrition specific listeners could go here
                }
            },
            async saveWeight(v) { const num = parseFloat(v); if (isNaN(num) || num <= 0 || num > 300) { UI.showToast("GeÃ§ersiz kilo!", "error"); return; } if (await Store.saveWeight(num)) { UI.showToast("Kilo gÃ¼ncellendi."); this.switchTab('dashboard'); } },
            async injectFuel() {
                await Store.saveFuel();
                // Epik gainer shake overlay
                const messages = [
                    { emoji: "â›½", text: "YAKIT ALINDI!", sub: "Motor Ã§alÄ±ÅŸÄ±yor. Kaslar bÃ¼yÃ¼yor." },
                    { emoji: "ğŸ¼", text: "SHAKE Ä°Ã‡Ä°LDÄ°!", sub: "Protein sÄ±zÄ±yor. Anabolizma aktif." },
                    { emoji: "ğŸš€", text: "GÃœÃ‡ YÃœKLENDÄ°!", sub: "Enerji deposu %100. HazÄ±rsÄ±n." },
                    { emoji: "ğŸ’ª", text: "KAS YAPIMI BAÅLADI!", sub: "Her yudum seni gÃ¼Ã§lendiriyor." },
                    { emoji: "ğŸ¥¤", text: "GAINER TAMAM!", sub: "Bulk sezonunda Ã¶nemli adÄ±m." }
                ];
                const msg = messages[Math.floor(Math.random() * messages.length)];
                UI.showEpicOverlay(msg.emoji, msg.text, msg.sub, '#ff6b35');
                setTimeout(() => this.switchTab('dashboard'), 2300);
            },

            // --- v5.8.0: SLEEP & WATER ACTIONS ---
            async saveSleep() {
                const input = document.getElementById('sleep-input');
                if (!input || !input.value) { UI.showToast("Uyku saati girin!", "error"); return; }
                const hours = parseFloat(input.value);
                if (hours < 0 || hours > 14) { UI.showToast("GeÃ§ersiz deÄŸer (0-14)", "error"); return; }
                await Store.setSleep(hours);
                UI.showToast(`Uyku kaydedildi: ${hours} saat`);
                this.switchTab('dashboard');
            },
            async addWater(cups) {
                const current = await Store.getWater(Utils.dateStr());
                const newVal = Math.max(0, current + cups);
                await Utils.storage.set(CONFIG.KEYS.WATER + Utils.dateStr(), newVal);
                if (cups > 0) UI.showToast(`+${cups} bardak ğŸ’§`);
                this.switchTab('dashboard');
            },

            async toggleTask(id) { await Store.toggleTask(id); this.switchTab('training'); },
            // ROBOT MODE (EMOTION OVERRIDE) SYSTEM
            overrideState: { active: false, startTime: null, timerInterval: null },

            async toggleOverride() {
                if (this.overrideState.active) {
                    this.exitOverride();
                    return;
                }

                // ACTIVATE ROBOT MODE
                this.overrideState.active = true;
                this.overrideState.startTime = Date.now();
                document.body.classList.add('override-mode');

                const btn = document.getElementById('btn-override');
                btn.innerHTML = '<i class="fas fa-skull mr-1"></i> ROBOT MODE';
                btn.classList.add('bg-red-900', 'animate-pulse');

                // Start timer
                this.overrideState.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.overrideState.startTime) / 1000);
                    const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const secs = (elapsed % 60).toString().padStart(2, '0');
                    document.getElementById('override-timer').textContent = `${mins}:${secs} `;
                }, 1000);

                // Generate mission based on incomplete tasks
                const mission = await this.generateOverrideMission();
                document.getElementById('override-mission').textContent = mission;

                // Show brutal command
                const commands = [
                    "DUYGULAR Ã–NEMSÄ°Z. GÃ–REV KUTSAL.",
                    "CANIM Ä°STEMÄ°YOR DEME. YAP.",
                    "AKSAK AYAKLA YÃœRÃœ, AMA YÃœRÃœ.",
                    "ÅÄ°MDÄ° YAPMAZSAN KÄ°M YAPACAK?",
                    "BU SENÄ°N SEÃ‡Ä°MÄ°N. ROBOT GÄ°BÄ° Ã‡ALIÅ."
                ];
                UI.showToast(commands[Math.floor(Math.random() * commands.length)], "warning");

                // Lock to current tab or training
                const currentTab = Store.state.activeTab || 'training';
                this.switchTab(currentTab);

                // ESC key listener
                document.addEventListener('keydown', this.handleOverrideEsc);
            },

            handleOverrideEsc(e) {
                if (e.key === 'Escape' && Actions.overrideState.active) {
                    Actions.exitOverride();
                }
            },

            exitOverride() {
                this.overrideState.active = false;
                document.body.classList.remove('override-mode');

                const btn = document.getElementById('btn-override');
                btn.innerHTML = '<i class="fas fa-power-off mr-1"></i> EMOTION OVERRIDE';
                btn.classList.remove('bg-red-900', 'animate-pulse');

                if (this.overrideState.timerInterval) {
                    clearInterval(this.overrideState.timerInterval);
                }

                const elapsed = Math.floor((Date.now() - this.overrideState.startTime) / 1000);
                const mins = Math.floor(elapsed / 60);
                UI.showToast(`Robot Modu: ${mins} dakika odaklandÄ±n.`);

                document.removeEventListener('keydown', this.handleOverrideEsc);
            },

            async generateOverrideMission() {
                const today = Utils.dateStr();
                const workout = await Store.getWorkout(today);
                const meals = await Store.getMeals(today);
                const day = new Date().getDay();
                const plan = DB.WEEKLY_PLAN[day];

                const incompleteTasks = plan.tasks.filter(t => !workout.includes(t)).length;
                const totalCal = meals.reduce((sum, m) => sum + m.cal, 0);
                const calDeficit = CONFIG.TARGETS.CAL - totalCal;

                if (incompleteTasks > 0) {
                    return `GÃ–REV: ${incompleteTasks} ANTRENMAN KALDI`;
                } else if (calDeficit > 500) {
                    return `GÃ–REV: ${calDeficit} KALORÄ° EKSÄ°K`;
                } else if (calDeficit > 0) {
                    return `GÃ–REV: ${calDeficit} KAL EKSÄ°K - BÄ°TÄ°RE GEL`;
                } else {
                    return "TÃœM GÃ–REVLER TAMAM. KAZANDIN.";
                }
            },
            async rerollPlan() {
                await Store.generateDailyPlan();
                UI.showToast("GÃ¼nlÃ¼k menÃ¼ yenilendi.");
                this.switchTab('nutrition');
            },
            async deleteMeal(index) {
                if (await Store.deleteMeal(index)) {
                    UI.showToast("Ã–ÄŸÃ¼n silindi.");
                    this.switchTab('nutrition');
                }
            },
            openMealModal() {
                const foods = Store.getAllFoods();
                UI.modal.open("YAKIT EKLE", `
            <div class="flex gap-2 mb-4 border-b border-gray-800 pb-2">
                        <button onclick="document.getElementById('tab-exist').style.display='block';document.getElementById('tab-new').style.display='none'" class="text-xs text-neon-green font-bold hover:underline">LÄ°STEDEN SEÃ‡</button>
                        <button onclick="document.getElementById('tab-exist').style.display='none';document.getElementById('tab-new').style.display='block'" class="text-xs text-gray-500 font-bold hover:text-white hover:underline">YENÄ° TANIMLA</button>
                    </div>
                    <div id="tab-exist">
                        <div class="space-y-4">
                            <div>
                                <input type="text" id="food-search" placeholder="Besin Ara (Ã¶rn: DÃ¶ner, Pilav)" class="${THEME.input} mb-2 border-neon-blue/30 text-sm" onkeyup="UI.filterFoodList()">
                                <select id="m-food" class="${THEME.input} custom-scrollbar" onchange="UI.renderPortionInputs()" size="5">
                                    ${foods.map((f, i) => `<option value="${i}">${f.name}</option>`).join('')}
                                </select>
                            </div>
                            <div id="portion-container">
                                <!-- Dynamic Inputs Here -->
                            </div>
                            <button onclick="Actions.submitMeal()" class="${THEME.btn} w-full mt-2">EKLE</button>
                        </div>
                    </div>
                    <div id="tab-new" style="display:none">
                        <div class="space-y-3">
                            <input type="text" id="new-name" placeholder="Besin AdÄ± (Ã–rn: Ã‡iÄŸ KÃ¶fte)" class="${THEME.input}">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="new-cal" placeholder="Kalori (100g veya Adet)" class="${THEME.input}">
                                <input type="number" id="new-prot" placeholder="Protein" class="${THEME.input}">
                                <input type="number" id="new-carb" placeholder="Karbonhidrat" class="${THEME.input}">
                                <input type="number" id="new-fat" placeholder="YaÄŸ" class="${THEME.input}">
                            </div>
                             <div>
                                <label class="text-[10px] text-gray-500 font-bold block mb-1">BÄ°RÄ°M TÃœRÃœ</label>
                                <select id="new-unit" class="${THEME.input}">
                                    <option value="gr">Gram (100g Ã¼zerinden)</option>
                                    <option value="ad">Adet/Porsiyon</option>
                                </select>
                            </div>
                            <button onclick="Actions.createCustomFood()" class="${THEME.btn} w-full border-neon-blue text-neon-blue hover:bg-neon-blue hover:text-black">VERÄ°TABANINA KAYDET</button>
                        </div>
                    </div>
                `);
                // Trigger initial render for first item
                setTimeout(() => {
                    const select = document.getElementById('m-food');
                    if (select && select.options.length > 0) {
                        select.selectedIndex = 0; // Force selection
                        UI.renderPortionInputs();
                    }
                }, 100);
            },
            async submitMeal() {
                const idx = document.getElementById('m-food').value;
                const f = Store.getAllFoods()[idx];
                let amt = 0;
                let ratio = 0;
                let unitLabel = "";

                // Logic Branching for Portion vs Piece vs Legacy Grams
                if (f.type === 'portion') {
                    // Get selected radio
                    const radios = document.getElementsByName('portion_opt');
                    let selectedOptIdx = 0;
                    for (const r of radios) { if (r.checked) { selectedOptIdx = parseInt(r.value); break; } }

                    const opt = f.options[selectedOptIdx];
                    ratio = opt.ratio; // Multiplier of base 100g values
                    amt = 1; // Logically 1 portion
                    unitLabel = opt.label;

                } else if (f.type === 'piece') {
                    // Standard Piece logic
                    amt = parseFloat(document.getElementById('m-amount').value);
                    if (!amt) return;
                    ratio = amt; // 1 banana * 1
                    unitLabel = f.unitName || 'Adet';

                } else {
                    // Legacy/Custom Grams logic (Default)
                    amt = parseFloat(document.getElementById('m-amount').value);
                    if (!amt) return;
                    // If custom food was saved with 'ad' unit, ratio is amt. If 'gr', ratio is amt/100.
                    // Current custom food logic saves 'unit' property.
                    if (f.unit === 'ad') {
                        ratio = amt;
                        unitLabel = 'Adet';
                    } else {
                        ratio = amt / 100;
                        unitLabel = 'Gr';
                    }
                }

                await Store.addMeal({
                    name: f.name,
                    amount: amt,
                    unit: f.type || 'custom', // Storing type for reference
                    portionLabel: unitLabel, // For display
                    cal: Math.round(f.vals.cal * ratio),
                    prot: Math.round(f.vals.prot * ratio),
                    carb: Math.round(f.vals.carb * ratio),
                    fat: Math.round(f.vals.fat * ratio)
                });

                UI.modal.close();
                UI.showToast("Ã–ÄŸÃ¼n eklendi.");
                this.switchTab('nutrition');
            },
            async createCustomFood() {
                const n = document.getElementById('new-name').value;
                const c = parseFloat(document.getElementById('new-cal').value);
                const p = parseFloat(document.getElementById('new-prot').value);
                const carb = parseFloat(document.getElementById('new-carb').value);
                const f = parseFloat(document.getElementById('new-fat').value);
                const u = document.getElementById('new-unit').value;

                if (!n || !c) { UI.showToast("Eksik bilgi!", "error"); return; }

                // Custom foods use 'vals' structure now to match new DB schema
                await Store.addCustomFood({
                    name: n,
                    type: 'custom', // Custom types handled by unit
                    unit: u,
                    vals: {
                        cal: c,
                        prot: p || 0,
                        carb: carb || 0,
                        fat: f || 0
                    }
                });

                UI.modal.close();
                UI.showToast("VeritabanÄ± gÃ¼ncellendi.");
                setTimeout(() => this.openMealModal(), 500);
            },
            async saveStats() {
                const newStats = {
                    chest: document.getElementById('stat-chest').value,
                    arm: document.getElementById('stat-arm').value,
                    waist: document.getElementById('stat-waist').value,
                    leg: document.getElementById('stat-leg').value
                };
                await Store.saveStats(newStats);
                UI.showToast("Ã–lÃ§Ã¼ler kaydedildi âœ“");
                this.switchTab('progress'); // UI'Ä± yenile
            },

            async showExercise(id) {
                const ex = DB.EXERCISES[id];
                const history = await Store.getExerciseHistory(id);
                const pr = await Store.getPersonalBest(id);

                // Hedef set/tekrar parse
                const targetMatch = ex.desc.match(/(\d+)\s*Set\s*x\s*(\d+)/i);
                const targetSets = targetMatch ? targetMatch[1] : '3-4';
                const targetReps = targetMatch ? targetMatch[2] : '12';

                // Son 5 antrenman iÃ§in mini grafik
                const last5 = history.slice(-5);
                const maxVol = Math.max(...last5.map(h => h.volume || 0), 1);
                const miniChart = last5.length > 0
                    ? last5.map(h => {
                        const height = Math.max(8, ((h.volume || 0) / maxVol) * 60);
                        return `<div class="flex-1 flex flex-col items-center gap-1">
                            <div class="w-full bg-neon-blue/60 rounded-t transition-all" style="height:${height}px"></div>
                            <div class="text-[8px] text-gray-600">${h.date ? h.date.split('-')[2] : ''}</div>
                        </div>`;
                    }).join('')
                    : '<div class="text-gray-600 text-xs text-center w-full">HenÃ¼z veri yok</div>';

                // AdÄ±mlarÄ± numaralÄ± gÃ¶ster
                const stepsHtml = ex.steps.map((s, i) => `
                    <div class="flex items-start gap-3 p-2 bg-gray-800/50 rounded-lg">
                        <div class="w-6 h-6 rounded-full bg-neon-green/20 border border-neon-green/50 flex items-center justify-center text-neon-green font-bold text-xs flex-shrink-0">${i + 1}</div>
                        <span class="text-gray-200 text-sm">${s}</span>
                    </div>
                `).join('');

                const modalContent = `
                    <div class="space-y-5">
                        <!-- BaÅŸlÄ±k ve Etiketler -->
                        <div class="flex items-center gap-3 pb-4 border-b border-gray-800">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-neon-green/20 to-neon-blue/20 flex items-center justify-center text-2xl">
                                <i class="fas fa-dumbbell text-neon-green"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex flex-wrap gap-2">
                                    ${ex.tags.map(t => `<span class="text-[10px] px-2 py-1 rounded-full bg-gray-800 text-gray-400 border border-gray-700">${t}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- AÃ§Ä±klama -->
                        <div class="text-sm text-gray-300 leading-relaxed p-3 bg-gray-900/50 rounded-lg border-l-3 border-neon-blue">
                            ${ex.desc}
                        </div>
                        
                        <!-- Operasyon AdÄ±mlarÄ± -->
                        <div>
                            <div class="text-[10px] text-gray-500 font-bold tracking-widest mb-3">
                                <i class="fas fa-list-ol mr-2 text-neon-green"></i>OPERASYON ADIMLARI
                            </div>
                            <div class="space-y-2">
                                ${stepsHtml}
                            </div>
                        </div>
                        
                        <!-- PR ve GeÃ§miÅŸ Grid -->
                        <div class="grid grid-cols-2 gap-4">
                            <!-- PR KartÄ± -->
                            <div class="bg-gradient-to-br from-gray-900 to-gray-800 p-4 rounded-xl border border-gray-700">
                                <div class="text-[10px] text-gray-500 font-bold mb-2">
                                    <i class="fas fa-trophy text-neon-yellow mr-1"></i>KÄ°ÅÄ°SEL REKOR (PR)
                                </div>
                                ${pr
                        ? `<div class="text-2xl font-bold text-white">${pr.volume} <span class="text-sm text-gray-500">vol</span></div>
                                       <div class="text-xs text-gray-500 mt-1">${pr.weight}kg Ã— ${pr.reps} tekrar</div>
                                       <div class="text-[10px] text-gray-600 mt-2">${pr.date || ''}</div>`
                        : `<div class="text-gray-600 text-sm">HenÃ¼z kayÄ±t yok</div>
                                       <div class="text-[10px] text-gray-700 mt-1">Ä°lk setini tamamla!</div>`
                    }
                            </div>
                            
                            <!-- Mini Grafik -->
                            <div class="bg-gradient-to-br from-gray-900 to-gray-800 p-4 rounded-xl border border-gray-700">
                                <div class="text-[10px] text-gray-500 font-bold mb-2">
                                    <i class="fas fa-chart-bar text-neon-blue mr-1"></i>SON 5 ANTRENMAN
                                </div>
                                <div class="flex items-end gap-1 h-16">
                                    ${miniChart}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hedef -->
                        <div class="text-center p-4 bg-neon-green/10 rounded-xl border border-neon-green/30">
                            <div class="text-[10px] text-gray-500 font-bold mb-1">ğŸ¯ HEDEF</div>
                            <div class="text-xl font-bold text-neon-green">${targetSets} Set Ã— ${targetReps} Tekrar</div>
                        </div>
                    </div>
                `;

                UI.modal.open(ex.title, modalContent);
            },
            async showPhase(id) {
                const phaseIcons = ['ğŸ†', 'ğŸ­', 'ğŸ¤–', 'ğŸ”§', 'âš¡', 'ğŸ¯', 'ğŸ€', 'ğŸ”„'];
                const p = DB.MENTAL_PHASES.find(x => x.id == id);
                const idx = DB.MENTAL_PHASES.findIndex(x => x.id == id);
                const icon = phaseIcons[idx] || 'ğŸ§ ';

                // Mental progress'i kontrol et
                const mentalData = await Utils.storage.get(CONFIG.KEYS.MENTAL_PROGRESS) || { completedPhases: [] };
                const isCompleted = mentalData.completedPhases?.includes(id);

                const modalContent = `
                    <div class="space-y-5">
                        <!-- Header -->
                        <div class="flex items-center gap-4 pb-4 border-b border-gray-800">
                            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-600/30 to-pink-600/30 border border-purple-500/40 
                                flex items-center justify-center text-4xl">
                                ${icon}
                            </div>
                            <div class="flex-1">
                                <div class="text-xs text-purple-400 font-mono mb-1">FAZ ${p.id} / 8</div>
                                <div class="text-lg font-bold text-white">${p.title.replace(/FAZ \d+: /, '')}</div>
                                <div class="text-xs text-gray-500 mt-1">${p.desc}</div>
                            </div>
                            ${isCompleted ? '<div class="text-neon-green text-2xl">âœ“</div>' : ''}
                        </div>
                        
                        <!-- Ã‡ekirdek Fikir -->
                        <div class="bg-gradient-to-br from-purple-900/20 to-gray-900 p-4 rounded-xl border border-purple-500/20">
                            <div class="text-[10px] text-purple-400 font-bold tracking-widest mb-2">
                                <i class="fas fa-lightbulb mr-1"></i>Ã‡EKÄ°RDEK FÄ°KÄ°R
                            </div>
                            <p class="text-sm text-gray-300 leading-relaxed">${p.core}</p>
                        </div>
                        
                        <!-- Niyet -->
                        <div class="bg-gray-900/50 p-4 rounded-xl border border-gray-800">
                            <div class="text-[10px] text-gray-500 font-bold tracking-widest mb-2">
                                <i class="fas fa-bullseye mr-1"></i>NÄ°YET / AMAÃ‡
                            </div>
                            <p class="text-sm text-gray-400 leading-relaxed">${p.intent}</p>
                        </div>
                        
                        <!-- Strateji ve Pratik -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-900 p-4 rounded-xl border-l-4 border-purple-500">
                                <div class="text-[10px] text-purple-400 font-bold tracking-widest mb-3">
                                    <i class="fas fa-chess mr-1"></i>STRATEJÄ°
                                </div>
                                <ul class="space-y-2">
                                    ${p.strategy.map(s => `
                                        <li class="flex gap-2 text-xs text-gray-300">
                                            <i class="fas fa-caret-right text-purple-400 mt-0.5"></i>
                                            <span>${s}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            <div class="bg-gray-900 p-4 rounded-xl border-l-4 border-neon-green">
                                <div class="text-[10px] text-neon-green font-bold tracking-widest mb-3">
                                    <i class="fas fa-bolt mr-1"></i>PRATÄ°K UYGULAMALAR
                                </div>
                                <ul class="space-y-2">
                                    ${p.practice.map(s => `
                                        <li class="flex gap-2 text-xs text-gray-300">
                                            <i class="fas fa-check text-neon-green mt-0.5"></i>
                                            <span>${s}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex gap-3 pt-4 border-t border-gray-800">
                            ${!isCompleted ? `
                                <button onclick="Actions.markPhaseComplete(${p.id})" 
                                    class="flex-1 py-3 bg-neon-green/10 border-2 border-neon-green text-neon-green font-bold rounded-xl hover:bg-neon-green hover:text-black transition-all">
                                    <i class="fas fa-check-double mr-2"></i>Bu FazÄ± AnladÄ±m
                                </button>
                            ` : `
                                <div class="flex-1 py-3 bg-neon-green/10 border border-neon-green/30 text-neon-green text-center font-bold rounded-xl">
                                    <i class="fas fa-trophy mr-2"></i>Faz TamamlandÄ±!
                                </div>
                            `}
                            <button onclick="UI.modal.close()" 
                                class="px-6 py-3 bg-gray-800 border border-gray-700 text-gray-400 font-bold rounded-xl hover:bg-gray-700 hover:text-white transition-all">
                                Kapat
                            </button>
                        </div>
                    </div>
                `;

                UI.modal.open(p.title, modalContent);
            },

            // Mental progress actions
            async completeDailyPractice() {
                const mentalData = await Utils.storage.get(CONFIG.KEYS.MENTAL_PROGRESS) || {
                    completedPhases: [],
                    dailyPractice: {}
                };
                const today = Utils.dateStr();
                mentalData.dailyPractice = mentalData.dailyPractice || {};
                mentalData.dailyPractice[today] = true;
                await Utils.storage.set(CONFIG.KEYS.MENTAL_PROGRESS, mentalData);

                // Epik overlay gÃ¶ster
                UI.showEpicOverlay('ğŸ§ ', 'ZÄ°HÄ°N GÃœÃ‡LENDÄ°!', 'GÃ¼nlÃ¼k pratik tamamlandÄ±. Bir adÄ±m daha ileridesin.', '#a855f7');

                setTimeout(() => this.switchTab('mental'), 2300);
            },

            async markPhaseComplete(phaseId) {
                const mentalData = await Utils.storage.get(CONFIG.KEYS.MENTAL_PROGRESS) || {
                    completedPhases: [],
                    dailyPractice: {}
                };
                mentalData.completedPhases = mentalData.completedPhases || [];

                if (!mentalData.completedPhases.includes(phaseId)) {
                    mentalData.completedPhases.push(phaseId);
                    await Utils.storage.set(CONFIG.KEYS.MENTAL_PROGRESS, mentalData);

                    UI.modal.close();

                    // TÃ¼m fazlar tamamlandÄ± mÄ± kontrol et
                    if (mentalData.completedPhases.length >= 8) {
                        UI.showEpicOverlay('ğŸ‘‘', 'MENTAL MASTER!', 'TÃ¼m fazlarÄ± tamamladÄ±n. Zihinsel savaÅŸÄ± kazandÄ±n!', '#fbbf24');
                    } else {
                        UI.showEpicOverlay('â­', 'FAZ TAMAMLANDI!', `${mentalData.completedPhases.length}/8 faz tamamlandÄ±.`, '#a855f7');
                    }

                    setTimeout(() => this.switchTab('mental'), 2300);
                }
            },

            setAnatomyView(v) { UI.activeView = v; Store.state.selectedMuscle = null; this.switchTab('anatomy'); },
            selectMuscle(id) { Store.state.selectedMuscle = id; this.switchTab('anatomy'); },

            // --- ALERT SYSTEM ---
            async checkSystemAlerts() {
                const shakeDone = Store.state.fuelDate === Utils.dateStr();
                const meals = await Store.getMeals(Utils.dateStr()) || [];
                let alertMsg = "";

                if (!shakeDone) {
                    alertMsg += "<div class='mb-4'><span class='text-neon-yellow font-bold'>âš ï¸ KRÄ°TÄ°K UYARI:</span><br>GÃ¼nlÃ¼k Gainer Shake henÃ¼z sisteme girilmedi! YakÄ±t seviyesi kritik.</div>";
                }

                if (meals.length === 0) {
                    alertMsg += "<div><span class='text-neon-red font-bold'>âš ï¸ BESLENME HATASI:</span><br>BugÃ¼n hiÃ§bir Ã¶ÄŸÃ¼n kaydÄ± yapÄ±lmadÄ±. Sistem aÃ§ Ã§alÄ±ÅŸamaz!</div>";
                }

                if (alertMsg !== "") {
                    UI.alert.show(alertMsg);
                    const nutBtn = document.getElementById('badge-nutrition');
                    if (nutBtn && meals.length === 0) nutBtn.classList.remove('hidden');
                }
            },

            openWarmup() {
                const warmupRoutine = `
                    <div class="space-y-4 text-sm text-gray-300">
                        <div class="bg-gray-900 p-4 rounded-xl border border-neon-blue">
                            <h4 class="text-neon-blue font-bold mb-2 flex items-center gap-2">
                                <i class="fas fa-fire animate-pulse"></i>
                                SÄ°STEM BAÅLATILIYOR (ISINMA)
                            </h4>
                            <p class="text-sm text-gray-400 mb-4">Motor soÄŸukken gazlama. Sakatlanmamak iÃ§in bu 3 dakilkalÄ±k rutini her antrenmandan Ã¶nce yap.</p>
                            
                            <ul class="space-y-3">
                                <li class="flex gap-3 items-center p-2 bg-gray-800/50 rounded-lg">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Boyun Ã‡evirme</span>
                                        <div class="text-xs text-gray-500">SaÄŸa, sola, Ã¶ne, arkaya yavaÅŸÃ§a (30sn)</div>
                                    </div>
                                </li>
                                <li class="flex gap-3 items-center p-2 bg-gray-800/50 rounded-lg">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Kol Ã‡evirme</span>
                                        <div class="text-xs text-gray-500">KollarÄ±nÄ± pervane gibi Ã¶ne ve arkaya Ã§evir (30sn)</div>
                                    </div>
                                </li>
                                <li class="flex gap-3 items-center p-2 bg-gray-800/50 rounded-lg">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Bel Dairesi</span>
                                        <div class="text-xs text-gray-500">Eller belde, geniÅŸ daireler Ã§iz (30sn)</div>
                                    </div>
                                </li>
                                <li class="flex gap-3 items-center p-2 bg-gray-800/50 rounded-lg">
                                    <i class="fas fa-check-circle text-neon-blue"></i>
                                    <div>
                                        <span class="font-bold text-white">Hafif KoÅŸu</span>
                                        <div class="text-xs text-gray-500">OlduÄŸun yerde sekerek nabzÄ±nÄ± yÃ¼kselt (1dk)</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="text-center">
                            <button onclick="Actions.startWorkout()" class="${THEME.btn} w-full bg-neon-green/20 border-2 border-neon-green text-neon-green hover:bg-neon-green hover:text-black font-bold text-lg py-4 rounded-xl transition-all hover:scale-[1.02] hover:shadow-[0_0_30px_rgba(0,255,65,0.3)]">
                                <i class="fas fa-rocket mr-2"></i>HAZIRIM, BAÅLAT!
                            </button>
                        </div>
                    </div>
                `;
                UI.modal.open("SYSTEM BOOT (ISINMA)", warmupRoutine);
            },

            startWorkout() {
                // Motive edici mesajlar
                const messages = [
                    { emoji: "ğŸ”¥", text: "YANMAYA HAZIR OL!", sub: "AcÄ± geÃ§ici, gurur kalÄ±cÄ±." },
                    { emoji: "ğŸ’ª", text: "GÃœÃ‡ SENDÄ°R!", sub: "Limitler zihninde, kÄ±r onlarÄ±." },
                    { emoji: "âš¡", text: "SÄ°STEM AKTÄ°F!", sub: "Her rep seni daha gÃ¼Ã§lÃ¼ yapÄ±yor." },
                    { emoji: "ğŸ¯", text: "HEDEF KÄ°LÄ°TLÄ°!", sub: "BugÃ¼n dÃ¼nden daha iyi ol." },
                    { emoji: "ğŸš€", text: "KALKIÅ BAÅARILI!", sub: "BaÅŸlamak bitirmenin yarÄ±sÄ±." },
                    { emoji: "ğŸ‘Š", text: "SAVAÅ ZAMANI!", sub: "Bahaneler zayÄ±flar iÃ§indir." },
                    { emoji: "ğŸ¦", text: "ASLAN GÄ°BÄ°!", sub: "Korku ile cesaret aynÄ± yerde yaÅŸar." }
                ];
                const msg = messages[Math.floor(Math.random() * messages.length)];

                // ModalÄ± kapat
                UI.modal.close();

                // Tam ekran overlay oluÅŸtur
                const overlay = document.createElement('div');
                overlay.id = 'workout-start-overlay';
                overlay.innerHTML = `
                    <div style="
                        position: fixed;
                        inset: 0;
                        background: radial-gradient(ellipse at center, rgba(0,255,65,0.15) 0%, rgba(10,10,15,0.98) 70%);
                        z-index: 9999;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        animation: overlayFadeIn 0.3s ease-out;
                    ">
                        <div style="
                            font-size: 120px;
                            animation: emojiPulse 0.5s ease-out;
                            text-shadow: 0 0 60px rgba(0,255,65,0.5);
                        ">${msg.emoji}</div>
                        <div style="
                            font-family: 'Orbitron', sans-serif;
                            font-size: clamp(28px, 8vw, 64px);
                            font-weight: 900;
                            color: #00ff41;
                            text-align: center;
                            margin-top: 20px;
                            text-shadow: 0 0 30px rgba(0,255,65,0.5), 0 0 60px rgba(0,255,65,0.3);
                            animation: textSlideUp 0.4s ease-out 0.1s both;
                            letter-spacing: 4px;
                        ">${msg.text}</div>
                        <div style="
                            font-size: clamp(14px, 3vw, 20px);
                            color: #6b7280;
                            margin-top: 16px;
                            text-align: center;
                            animation: textSlideUp 0.4s ease-out 0.2s both;
                            max-width: 80%;
                        ">${msg.sub}</div>
                        <div style="
                            margin-top: 40px;
                            width: 200px;
                            height: 4px;
                            background: #333;
                            border-radius: 4px;
                            overflow: hidden;
                            animation: textSlideUp 0.4s ease-out 0.3s both;
                        ">
                            <div style="
                                width: 100%;
                                height: 100%;
                                background: linear-gradient(90deg, #00ff41, #00f3ff);
                                animation: progressFill 1.5s ease-out forwards;
                                transform-origin: left;
                            "></div>
                        </div>
                    </div>
                    <style>
                        @keyframes overlayFadeIn {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                        @keyframes emojiPulse {
                            0% { transform: scale(0.3); opacity: 0; }
                            50% { transform: scale(1.2); }
                            100% { transform: scale(1); opacity: 1; }
                        }
                        @keyframes textSlideUp {
                            from { transform: translateY(30px); opacity: 0; }
                            to { transform: translateY(0); opacity: 1; }
                        }
                        @keyframes progressFill {
                            from { transform: scaleX(0); }
                            to { transform: scaleX(1); }
                        }
                        @keyframes overlayFadeOut {
                            from { opacity: 1; }
                            to { opacity: 0; }
                        }
                    </style>
                `;
                document.body.appendChild(overlay);

                // 2 saniye sonra kapat
                setTimeout(() => {
                    overlay.firstElementChild.style.animation = 'overlayFadeOut 0.3s ease-out forwards';
                    setTimeout(() => overlay.remove(), 300);
                }, 2000);
            },

            // --- PHASE 1: SETTINGS & DATA ---
            openSettings() {
                UI.modal.open("VERÄ° YÃ–NETÄ°MÄ°", `
                    <div class="space-y-6">
                        <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 rounded-full bg-neon-green/20 flex items-center justify-center text-neon-green">
                                    <i class="fas fa-download"></i>
                                </div>
                                <div>
                                    <h4 class="text-white font-bold text-sm">YEDEKLE (EXPORT)</h4>
                                    <p class="text-[10px] text-gray-500">TÃ¼m verilerini cihazÄ±na indir (.json)</p>
                                </div>
                            </div>
                            <button onclick="Actions.exportData()" class="${THEME.btn} w-full text-xs">YEDEÄÄ° Ä°NDÄ°R</button>
                        </div>

                        <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 rounded-full bg-neon-red/20 flex items-center justify-center text-neon-red">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <div>
                                    <h4 class="text-white font-bold text-sm">GERÄ° YÃœKLE (IMPORT)</h4>
                                    <p class="text-[10px] text-gray-500">Dikkat: Mevcut veriler silinir!</p>
                                </div>
                            </div>
                            <input type="file" id="import-file" accept=".json" class="hidden" onchange="Actions.startImport(this)">
                            <button onclick="document.getElementById('import-file').click()" class="w-full bg-gray-800 text-gray-400 hover:text-white hover:bg-gray-700 font-bold py-3 px-6 rounded-lg transition text-xs border border-dashed border-gray-600">DOSYA SEÃ‡ VE YÃœKLE</button>
                        </div>
                    </div>
                `);
            },

            async exportData() {
                if (confirm("TÃ¼m veri yedeÄŸi indirilsin mi?")) {
                    await Store.exportData();
                    UI.showToast("Yedekleme baÅŸarÄ±lÄ± âœ“");
                    UI.modal.close();
                }
            },

            async startImport(input) {
                if (input.files && input.files[0]) {
                    if (confirm("DÄ°KKAT: Bu iÅŸlem mevcut tÃ¼m verileri silecek ve yedeÄŸi yÃ¼kleyecektir. Emin misin?")) {
                        const reader = new FileReader();
                        reader.onload = async function (e) {
                            const result = await Store.importData(e.target.result);
                            if (result.success) {
                                alert(`Yedek baÅŸarÄ±yla yÃ¼klendi! (Tarih: ${result.date})\nSayfa yenileniyor...`);
                                location.reload();
                            } else {
                                alert("Hata: " + result.error);
                            }
                        };
                        reader.readAsText(input.files[0]);
                    } else {
                        input.value = '';
                    }
                }
            },

            // --- PHASE 2: ACTIVE TRAINING ACTIONS ---
            toggleExerciseBody(id) {
                const el = document.getElementById(`body-${id}`);
                const icon = document.getElementById(`icon-${id}`);
                if (el.classList.contains('hidden')) {
                    el.classList.remove('hidden');
                    el.classList.add('animate-slide-down');
                    icon.style.transform = 'rotate(180deg)';
                } else {
                    el.classList.add('hidden');
                    el.classList.remove('animate-slide-down');
                    icon.style.transform = 'rotate(0deg)';
                }
            },

            async saveSet(taskId, setIdx, isDoneBtn) {
                const wInput = document.getElementById(`w-${taskId}-${setIdx}`);
                const rInput = document.getElementById(`r-${taskId}-${setIdx}`);
                const weight = wInput ? wInput.value : 0;
                const reps = rInput ? rInput.value : 0;

                if (isDoneBtn && (!weight || !reps)) {
                    UI.showToast("Kilo ve Tekrar girin!", "error");
                    return;
                }

                // Ã–nceki PR'Ä± al
                const oldPR = await Store.getPersonalBest(taskId);
                const oldPRVolume = oldPR ? oldPR.volume : 0;

                const result = await Store.logSet(taskId, setIdx, weight, reps, isDoneBtn);

                if (isDoneBtn) {
                    const btn = event.currentTarget || event.target.closest('button');
                    if (btn) {
                        btn.classList.remove('bg-gray-700', 'text-gray-400', 'hover:bg-gray-600');
                        btn.classList.add('bg-neon-green', 'text-black');
                        btn.innerHTML = '<i class="fas fa-check"></i>';
                    }
                    if (wInput) {
                        wInput.classList.replace('border-gray-600', 'border-neon-green');
                        wInput.classList.add('text-neon-green');
                    }
                    if (rInput) {
                        rInput.classList.replace('border-gray-600', 'border-neon-green');
                        rInput.classList.add('text-neon-green');
                    }

                    // PR kontrolÃ¼ ve anlamlÄ± geri bildirim
                    const newVolume = result.volume;
                    if (newVolume > oldPRVolume && oldPRVolume > 0) {
                        UI.showToast(`ğŸ‰ YENÄ° REKOR! ${newVolume} volume (${result.weight}kg Ã— ${result.reps})`, "success");
                    } else {
                        UI.showToast(`Set ${setIdx + 1} âœ“ | ${newVolume} volume`, "success");
                    }
                }
            }
        };

        // --- BOOT ---
        (async function () {
            console.log("SYSTEM BOOT...");
            await Store.init();
            UI.init();

            // Auto Backup Reminder
            const backupStatus = await Store.checkBackupStatus();
            if (backupStatus !== 'OK') {
                setTimeout(() => {
                    const msg = backupStatus === 'NEVER' ? "Verilerinizi yedeklemeniz Ã¶nerilir (Ayarlar)" : "âš ï¸ Yedekleme zamanÄ± geldi! (>7 GÃ¼n)";
                    const type = backupStatus === 'NEVER' ? "warning" : "error";
                    UI.showToast(msg, type);
                }, 3000);
            }
        })();
    </script>
</body>

</html>